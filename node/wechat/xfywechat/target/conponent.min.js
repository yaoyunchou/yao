!function(){"use strict";var e;e="undefined"==typeof exports?window:module.exports;var t="http://localhost/wx/";if(e.location){var a=window.location.pathname.split("/");a.length=a.length-2,t=window.location.protocol+"//"+window.location.hostname+a.join("/")+"/"}e.globals={basAppRoot:t,basAppRoute:t+"app/",basFilePath:"http://192.168.4.160:8080/",basImagePath:"http://weixindev.51yxwz.com/",basImageDomain:"weixindev.51yxwz.com",cmsImagePath:"http://obdt9tuqa.bkt.clouddn.com/",defaultImg:t+"app/components/content/images/nsw.png",imageUrl:"material/image/upload?appId=@appId",menuSrc:"user/menu",debug:!0,spaMode:!0},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e}}(),function(e){"use strict";e.module("app",["platform","account","menu","materials","autoReply","member","massMessage","message","qrCode","messageTemplate"]).config(["$stateProvider","$urlRouterProvider","$httpProvider",function(e,t,a){t.when("","/wechat"),e.state("wechat",{url:"/wechat",templateProvider:["$http","$q","platformModalSvc","platformNswAuthSvc",function(e,t,a,n){var r=t.defer(),o=a.showLoadingTip("页面加载中...."),i=n.loadAuthData();return e.get(globals.basAppRoute+"main/partials/main-view.html").then(function(e){r.resolve(e.data)}),t.all(i,r.promise).then(function(){o.close()}),r.promise}]}).state("wechat.switchProject",{url:"/switchProject",controller:"switchProjectCtrl",templateUrl:globals.basAppRoute+"main/partials/switch-project-view.html"})}]);var t=$(".c-header").outerHeight(),a=$(window).outerHeight(),n=$(".c-footer").outerHeight();$(".c-container,.c-menu-container").css("minHeight",a-t-n+"px")}(angular),function(e){"use strict";e.module("app").factory("mainMenuSvc",["platformMenuDataSvc","basDataSvc","accountDataSvc",function(e,t,a){var n={requireAppId:!1,list:{enableSearch:!0,listUri:"user/loginUser",selectionMode:"single"}},r=t.createInstance(n),o={groups:[]};return r.setMenus=function(e){o=e},r.buildNavigation=function(e,t){var a=[],n=o.groups[0];if(n)return n.state!==e.state?e!==t?(a.push(n),a.push(t),a.push(e)):(a.push(n),a.push(t)):a.push(n),a},r.loadData(),e.registerMenuLoaded(function(e){r.setMenus(e)}),r}])}(angular),function(e){"use strict";e.module("app").factory("switchProjectSvc",["$http","$q",function(e,t){var a={};return a.getProjects=function(){var t=globals.basAppRoot+"cms/getProjects";return e.get(t).then(function(e){return e.data.isSuccess?e.data.data.projects:[]},function(e){console.error(e)})},a}])}(angular),function(e){"use strict";e.module("app").factory("wechatSvc",[function(){}])}(angular),function(e){"use strict";e.module("app").controller("switchProjectCtrl",["$scope","switchProjectSvc",function(e,t){e.hideMenu(),e.$parent.enableSwitchProject=!1,e.breadNavs=[{state:"wechat.switchProject",name:"我的服务"}];var a=function(){e.hideMenu(),t.getProjects().then(function(t){e.projects=t||[]})};e.getIconClass=function(e){switch(e.projectType){case 4:return"pc";case 5:return"phone";case 9:return"responsive";case 7:return"wechat"}},e.selectProject=function(e){window.self.location.href=e.url},e.$on("$destroy",function(){e.showMenu()}),a()}])}(angular),function(e){"use strict";e.module("app").controller("wechatCtrl",["$scope","$state","mainMenuSvc","platformNavigationSvc","platformMenuDataSvc","nswGlobals","basListCtrlSvc","accountDataSvc","platformNswAuthSvc",function(e,t,a,n,r,o,i,s,l){i.createInstance(e,a),e.isWelcome=!0,e.leftEdit=!1,e.showMenus=!0,e.enableSwitchProject=!0;var c=function(t){e.currentWechtInfo=t};e.goMaterials=function(){t.go("wechat.materialsAdd")},r.registerMenuLoaded(function(t){e.menuOptions=t,a.setMenus(t),e.breadNavs=a.buildNavigation(r.getCurrentMenu(),r.getCurrentMenuGroup())}),n.registerRouteUpdated(function(t){e.isWelcome="welcome"===t.key}),e.exit=function(t){o.setValue("accountId",null,!0),o.setValue("appId",null,!0),o.setValue("platform_menus_selectedMenu",null,!0),o.setValue("platform_menus_selectedMenuGroup",null,!0),e.$broadcast("app.exit"),window.location=t},e.$on("$stateChangeStart",function(t,a){e.isWelcome="wechat.account"===a.name||"wechat.authorizeMain.explain"===a.name||"wechat.authorizeMain.mode"===a.name||"wechat.authorizeMain.success"===a.name||"wechat.authorizeUrl"===a.name||"wechat.authorizeAbout"===a.name,e.leftEdit=!("wechat.accountAdd"===a.name||"wechat.accountEdit"===a.name)}),e.$on("$stateChangeSuccess",function(e,t){r.selectMenu(t.name,!1)}),e.editAccount=function(){r.selectMenu("公众号管理"),e.leftEdit=!0},e.hideMenu=function(){e.showMenus=!1},e.showMenu=function(){e.showMenus=!0},e.switchProject=function(){e.goState("wechat.switchProject")},e.checkAuthed=function(e){return l.getAuth(e)};var u=function(t,n){s.setEidtHistory(t.name),e.breadNavs=a.buildNavigation(t,n),e.currentGroup=n};s.registerCurrentItemChanged(function(e){c(e)}),r.registerMenuSelected(u),e.$on("$destroy",function(){n.unregisterMenuSelected(u),s.unregisterCurrentItemChanged()})}])}(angular),function(e){"use strict";e.module("platform",["ng","ui.router","ui.bootstrap","ngStorage"])}(angular),function(e){"use strict";e.module("platform").factory("platformDateSvc",[function(){var e={};return e.dateRange=function(e){var t={start:(new Date).valueOf(),range:7},a=$.extend({},t,e);return new Date(a.start-864e5*a.range).format("yyyy-MM-dd")},e}])}(angular),function(e){"use strict";e.module("platform").service("platformDomainSvc"[function(){var e={fastEdit:{},text:{},url:{regexp:"(http[s]{0,1}|ftp)://[a-zA-Z0-9\\.\\-]+\\.([a-zA-Z]{2,4})(:\\d+)?(/[a-zA-Z0-9\\.\\-~!@#$%^&*+?:_/=<>]*)?"},email:{},qq:{},mobile:{},skype:{},title:{},shortTitle:{},status:{},check:{},radio:{},money:{},number:{},date:{},datetime:{},year:{}};return function(){this.domainTypes=e}}])}(angular),function(e){"use strict";e.module("platform").service("platformFormDomainSvc",[function(){var e={},t={text:{template:"input",type:"text",size:5},textarea:{template:"textarea",rows:3,size:5},htmleditor:{template:"htmleditor",isSimple:!0,size:5},select:{template:"select",key:"id",display:"name",size:5},name:{template:"input",type:"text",maxLength:32,required:!0,size:5},description:{template:"input",maxLength:32,type:"text",required:!0,size:5},email:{template:"input",type:"email",size:5,validates:[{type:"email",message:"请填写正确的邮件地址!"}]},url:{template:"input",type:"url",size:5,validates:[{type:"url",message:"请填写正确的链接地址(http://)!"}]},radio:{template:"radio",key:"id",display:"name",size:5},checkbox:{template:"checkbox",key:"id",display:"name",size:5},singleimage:{template:"singleimage",key:"id",display:"name",size:5},adlib:{template:"adlib",key:"id",display:"name",size:5}};return e.getDomainConfig=function(e){return t[e]},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformHttpInterceptor",["$injector","$location",function(e,t){var a=function(){var t=e.get("platformModalSvc");t.showErrorMessage("登陆超时","温馨提示").then(function(){window.location="/pccms/j_spring_cas_security_logout"})},n={request:function(e){return e},response:function(e){return e.data.isSuccess===!1&&401===e.data.state&&a(),"string"==typeof e.data&&e.data.indexOf instanceof Function&&e.data.indexOf('<div id="login_wrap" style="height: 775px;">')!==-1&&a(),e},requestError:function(e){return e},responseError:function(e){return 401===e.status&&a(),e}};return n}])}(angular),function(e){"use strict";e.module("platform").factory("platformImgUploaderSvc",["$rootScope","platformUploaderSvc","platformModalSvc","platformMessenger",function(e,t,a,n){var r={},o={filters:{max_file_size:"2mb",nsw_prevent_duplicates:!0,mime_types:[{title:"图片文件",extensions:"jpg,gif,jpeg,bmp,png"}]},uploadCompleted:new n},i=function(e){return(e||"").replace(/(^[^.]+).\s{2,4}/,"$1")},s=function(e,t){switch(console.error(t.message),t.code){case-600:a.showWarmingMessage("图片大小不能超过2MB！","提示");break;default:a.showWarmingMessage(t.message,"提示")}},l=function(t){return function(a,n){_.forEach(n,function(e){return e.fileName=i(e.name),e});var r=_.filter(n,{status:plupload.DONE}),o=_.map(r,function(e){({uploadId:e.id,name:i(e.name),url:"http://"+globals.basImageDomain+"/"+e.target_name})});t.uploadCompleted.fire(o),e.$apply()}};return r.createUploader=function(e){var a={};_.extend(a,o,e);var n=t.createUploader(a);return n.bind("Error",s).bind("UploadComplete",l(a)),n},r}])}(angular),function(e){"use strict";e.module("platform").factory("platformJsBeautiferSvc",[function(){function t(e){var a="",n="",r="",o=!1;do o=!1,/^\s*\/\*/.test(e)?(o=!0,n=e.substr(0,e.indexOf("*/")+2),e=e.substr(n.length).replace(/^\s+/,""),a+=n+"\n"):/^\s*\/\//.test(e)&&(o=!0,n=e.match(/^\s*\/\/.*/)[0],e=e.substr(n.length).replace(/^\s+/,""),a+=n+"\n");while(o);for(var i=[P_A_C_K_E_R,Urlencoded,MyObfuscate],s=0;s<i.length;s++)i[s].detect(e)&&(r=i[s].unpack(e),r!==e&&(e=t(r)));return a+e}function a(e){var t=e.replace(/^[ \t\n\r]+/,""),a="<!--";return t&&"<"===t.substring(0,1)&&t.substring(0,4)!==a}var n={},r={};n.setOptions=function(t){e.extend(r,t)};var o={use_codemirror:!window.location.href.match(/without-codemirror/),beautify_in_progress:!1,editor:null},i=function(e){if(!o.beautify_in_progress){o.beautify_in_progress=!0;var n,r={};return a(e)?n=html_beautify(e,r):($("#detect-packers").prop("checked")&&(e=t(e)),n=js_beautify(e,r)),n=n.replace(/\s*\}\s*\]\s*\]/g,"}]]").replace(/\[\s*\[\s*\$\s*\{\s*/g,"[[${"),o.beautify_in_progress=!1,n}};return n.beautify=function(t,a){return e.extend(r,a),i(t)},n}])}(angular),function(e){"use strict";e.module("platform").factory("platformKindEditorDataSvc",["nswmultiimagePluginSvc","spechartsPluginSvc","selectmodularPluginSvc","nswPreviewPluginSvc","reformatPluginSvc","nswPreviewPhonePluginSvc","nswimagePluginSvc",function(e,t,a,n,r,o,i){var s={},l=0;return s.wcItems=["source","emoticons","undo","redo","plainpaste","wordpaste","clearhtml","reformat","selectall","fullscreen","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","hr","removeformat","|","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist","|","nswimage","link","unlink"],s.simpleItems=["source","|","undo","redo","|","bold","italic","underline","|","forecolor","hilitecolor","fontname","fontsize","|","justifyleft","justifycenter","justifyright","justifyfull","link","fullscreen","|","clearhtml","reformat"],s.complexItems=["source","|","selectmodular","|","undo","redo","|","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","subscript","superscript","clearhtml","reformat","selectall","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","nswmultiimage","flash","media","insertfile","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","spechars","|","nswpreview","nswpreviewphone"],s.htmlTags={font:["color","size","face",".background-color","class"],span:["style","class","id","onclick"],div:["class","align","style","id","data-src","fn"],table:["class","border","cellspacing","cellpadding","width","height","align","style","align","bgcolor","id","frame","rules","summary"],"td,th":["class","align","valign","width","height","colspan","rowspan","bgcolor","style","id"],a:["class","href","target","name","style","title","id","onclick"],"img,section":["src","width","height","id","border","alt","title","align","style","class","templocation","sid","columns","cssname","orderby","sqlwhere","columnname","columnnameurl","selectcount","controltype","datatype","controid","cwidth","cheight","oid","/","onclick"],hr:["class","/"],br:["/"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["align","style","class","id","onclick"],"strong,b,sub,sup,em,i,u,strike,tr":["style","class","id"],dl:["class","style","id"],dt:["class","style","id"],dd:["class","style","id"],ul:["class","style","id","data-src","fn"],li:["class","style","id"],iframe:["src","width","height","style","frameborder","data-ke-src","class"],style:["type","oid"],script:["src","type","oid"],object:["codebase","classid","width","height"],param:["name","value"],embed:["src","allowfullscreen","loop","style","autostart","flashvars","quality","pluginspage","type","width","height","wmode","align","allowscriptaccess"]},s.colorTable=[["#000000","#E56600","#64451D","#DFC5A4","#FFE500","#009900","#006600","#99BB00"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE","#666666","#6666ff"],["#E53333","#993300","#333300","#003300","#003366","#000080","#333399","#333333"],["#800000","#FF6600","#808000","#008080","#0000FF","#666699","#CCFFFF","#CCFFCC"],["#FF0000","#FF9900","#99CC00","#339966","#33CCCC","#3366FF","#800080","#99CCFF"],["#FF00FF","#FFCC00","#FFFF00","#00FF00","#00FFFF","#00CCFF","#993366","#CC99FF"],["#FF99CC","#FFCC99","#FFFF99","#808080","#999999","#C0C0C0","#CCCCCC","#FFFFFF"]],s.layout='<div class="container">       <div class="other container_top dn"></div>       <div class="tab container_top dn"></div>       <div class="reversals dn"></div>       <div class="toolbar"></div>       <div class="edit"></div>       <div class="position container_bottom"></div>       <div class="btns container_bottom dn"></div>       <div class="statusbar"></div>   </div>',s.getUUID=function(){return String((new Date).getTime())+l++},e.init(),t.init(),a.init(),n.init(),r.init(),o.init(),i.init(),s}])}(angular),function(e){"use strict";e.module("platform").factory("platformMessenger",[function(){return function(){var t=this||{},a=[];t.register=function(e){a.push(e)},t.unregister=function(e){var t=a.indexOf(e);t>=0&&a.splice(t,1)},t.fire=function(){var t=arguments;e.forEach(a,function(e){e.apply(this,t)})}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.factory("mobilePreviewSvc",[function(){var e={};return e.mobilePreview=function(e,t,a){t=t||"view",a=!!_.isUndefined(a)||a,window.open(globals.basAppRoot+"js/template/index.html#/template-setting?pageid="+e+"&state="+t+"&isPubTpl="+a)},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformModalSvc",["$modal","$rootScope","$q",function(t,a,n){var r={},o={animation:!0,backdrop:"static",keyboard:!1},i=function(e){var t=a.$new(!0);return e&&(t.modalOptions=e.options,t.userTemplate=e.userTemplate),t},s=function(e){var a=n.defer();e.scope=i(e),e.scope.closeModal=function(e,t){e?a.resolve(t):a.reject(t),_.isFunction(this.$close)&&this.$close(e)};var r=t.open(e),o=($('[ng-controller="desktopMainCtrl"]')[0]||$(window)[0]).clientHeight>$(window).height(),s=$("html").css("padding-right");return r.result.then(function(){o&&!e.isTip&&($("html").css("padding-right",s),$("html").css("overflow-y","auto"))},function(){o&&!e.isTip&&($("html").css("padding-right",s),$("html").css("overflow-y","auto"))}),o&&!e.isTip&&($("html").css("overflow-y","hidden"),$("html").css("padding-right","17px")),setTimeout(function(){o&&$(".nsw.modal").css("padding-right","17px"),e.isTip||e.disableDrag||$(".modal-dialog").draggable({cancel:".modal-body,.modal-footer"})},100),a.promise},l=function(t){e.forEach(o,function(e){t.hasOwnProperty(e)||(t[e]=o[e])}),t.title=t.title||"标题栏",t.size=t.size||"md";var a;"sm"===t.size?a=496:"md"===t.size?a=600:"xs"===t.size&&(a=300)},c=function(e){return e?'<div class="wrapInfo">'+e+"</div>":""},u=function(e){return e?'<div class="wrapMessage">'+e+"</div>":""};r.showErrorMessage=function(e,t,a){var n={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(a),commitIcon:"checkforward",cancelIcon:"",commitText:"确 定",cancelText:"",type:"error"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return r.showModal(n)},r.showWarmingMessage=function(e,t,a){var n={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(a),commitIcon:"checkforward",commitText:"确 定",type:"warming"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return r.showModal(n)},r.showConfirmMessage=function(e,t,a){var n={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(a),commitIcon:"checkforward",cancelIcon:"checkcance",commitText:"确 定",cancelText:"取 消",type:"confirm"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return r.showModal(n)},r.showSuccessMessage=function(e,t,a){var n={size:"sm",userTemplate:!0,options:{title:t,message:u(e),info:c(a),commitIcon:"checkforward",cancelIcon:"checkcance",commitText:"确 定",type:"success"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-message.html"};return r.showModal(n)},r.showWarmingTip=function(e){var t={size:"xs",backdrop:!1,userTemplate:!0,isTip:!0,options:{message:e,type:"warming"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-tip.html"};return r.show(t)},r.showSuccessTip=function(e){var t={size:"xs",backdrop:!1,userTemplate:!0,isTip:!0,options:{message:e,type:"success"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-tip.html"};return r.show(t)};var d=0,p=!1,m={size:"xs",backdrop:!1,userTemplate:!0,isTip:!0,options:{message:"正在加载中",type:"loading"},templateUrl:globals.basAppRoute+"components/templates/modals/platform-modal-loading-tip.html"};return r.showLoadingTip=function(e){d++;var t={};return m.options.message=e,p||(t.promise=r.show(m),p=!0),t.close=function(e){e&&e["finally"]?e.then(t.close,t.close):(d--,d=d<0?0:d,setTimeout(function(){m&&!d&&p&&m.options.closeModal&&(m.options.closeModal(),p=!1)},100))},setTimeout(function(){t.close()},15e3),t},r.showModal=function(e){return l(e),e.backdrop="static",s(e)},r.show=function(e){return l(e),e.backdrop=!1,s(e)},r}]),e.module("template/modal/window.html",[]).run(["$templateCache",function(e){e.put("template/modal/window.html",'<div tabindex="-1" role="dialog" class="nsw modal fade " ng-class="{in: animate}" style="display: block;\tposition: fixed" ng-style="{\'z-index\': 811214 + index*10, display: \'block\'}">\n'+"    <div class=\"nsw modal-dialog nsw-modal-dialog\" ng-class=\"{'nsw-modal-sm': size == 'sm', 'nsw-modal-md': size == 'md','nsw-modal-lg': size == 'lg','nsw-modal-sg': size == 'sg','nsw-modal-xs': size == 'xs'}\">       <div class=\"modal-content {{modalOptions.modalClass}}\" modal-transclude></div>   </div>\n</div>"),e.put("template/modal/backdrop.html",'<div style="display: block;width: 100%; position: absolute;left: 0px;top: 0px;" class="modal-backdrop  fade {{ backdropClass }}"\n     ng-class="{in: animate}"\n     ng-style="{\'z-index\': 811213 + (index && 1 || 0) + index*10}"\n></div>\n')}])}(angular),function(e){"use strict";e.module("platform").factory("platformNavigationSvc",["$state","platformMenuDataSvc","platformMessenger","nswGlobals",function(e,t,a,n){var r={},o=new a,i=new a,s=new a;r.routes=[];var l=function(t){e.current.name===t?s.fire(t):(s.fire(t),e.go(t))},c=function(e,t){t&&t.promise?t.promise.then(function(){l(e)}):_.isFunction(t)?(t.apply(this,e),l(e)):l(e)};r.goState=function(e,a){var r={state:e};o.fire(r);var i=t.getCurrentMenu()||{};r.confirm&&r.confirm.then?r.confirm.then(function(){r.stop?i.name&&t.selectMenu(i.name,!1):c(e,a)}):(n.setValue("platform_menus_defaultState",{stop:!0},!0),c(e,a))};var u=function(e,t,a){var o,s=n.getValue("platform_menus_defaultState");if(n.setValue("platform_menus_defaultState",null,!0),t=t||{},a){if(_.isString(s))o=s;else{if(_.isObject(s)&&s.stop)return;if(o=t!==e&&t.state?t.state+"."+e.state:e.state,!o&&(o=(_.find(e.menus,{isDefault:!0})||{}).state,!o))return;/^wechat\./.test(o)||(o="wechat."+o)}r.goState(o),i.fire(e)}};return t.registerMenuSelected(u),r.registerRouteUpdated=function(e){i.register(e)},r.unregisterRouteUpdated=function(e){i.unregister(e)},r.registerStateUpdated=function(e){s.register(e)},r.unregisterStateUpdated=function(e){s.unregister(e)},r.registerRouteWillUpdated=function(e){o.register(e)},r.unregisterRouteWillUpdated=function(e){o.unregister(e)},r}])}(angular),function(e){"use strict";e.module("platform").factory("platformPreviewSvc",["platformModalSvc","nswGlobals","$http","platformMessenger","$q",function(e,t,a,n,r){var o,i={},s=new n;return i.showPreveivModal=function(t,a){return e.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"components/templates/materials/platform-preview-dir.html",controller:"platformPreviewCtrl",size:"lg",windowClass:"preview-bg",options:{information:t,type:a}}).then(function(e){return e},function(){return!1})},i.showPreveivSendModal=function(t){return e.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"components/templates/materials/platform-preview-send-dir.html",controller:"platformPreviewSendCtrl",size:"sm",options:{information:t}}).then(function(e){return e},function(){return!1})},i.loadArticle=function(e){var t=globals.basAppRoot+"material/materialInfo",n=r.defer();return a({method:"get",url:t,params:{type:"news",id:e}}).then(function(e){e.data.isSuccess?n.resolve(e.data.data):n.reject(e.data.data)}),n.promise},i.loadFans=function(){var e=globals.basAppRoot+"fans/fansList",n=r.defer();return a({method:"get",url:e,params:{appId:t.getValue("appId"),pageNum:1,pageSize:1e5}}).then(function(e){if(e.data.isSuccess){var t=[];_.forEach(e.data.data.dataList,function(e){t.push({id:e.openid,name:e.nickname})}),n.resolve(t)}else n.reject(e.data.data)}),n.promise},i.sendMassMsg=function(e){var n=globals.basAppRoot+"massmsg/sendMassMsg",o=r.defer();return a({method:"post",url:n,params:{appId:t.getValue("appId")},data:e}).then(function(e){e.data.isSuccess?o.resolve(e.data.data):o.reject(e.data.data)}),o.promise},i.mobilePreview=function(e){var n=globals.basAppRoot+"massmsg/preViewNews";e.appId=t.getValue("appId");var o=r.defer();return a({method:"post",url:n,data:e}).then(function(e){e.data.isSuccess?o.resolve(e.data.data):o.reject(e.data.data)}),o.promise},i.setCurrentItem=function(e){e.content&&(e.content=i.transformCmsArticle(e.content)),o=e},i.getCurrentItem=function(){return s.fire(),o},i.omitAttr=function(e){var t=_.toArray(arguments);e=t.shift(),_.forEach(t,function(t){e&&e.hasOwnProperty(t)&&delete e[t]})},i.transformCmsArticle=function(e){var t=/(src\S*=\S*")((?!http|https|ftp)\S+)"/gi;return e.replace(t,"$1"+globals.cmsImagePath+'$2"')},i.registerSwichShow=function(e){s.register(e)},i.unregisterSwichShow=function(e){s.unregister(e)},i}])}(angular),function(e){"use strict";var t=e.module("platform");t.factory("platformTemplatePreviewSvc",["desktopMainSvc",function(){var e={};return e.devices={pc:4,phone:5,reposive:9},e.preview=function(e,t,a,n){n?window.open(globals.basAppRoot+"js/template/index.html#/template-setting?state="+t+"&isPubTpl="+a+"&pageid="+e+"&device="+n):window.open(globals.basAppRoot+"js/template/index.html#/template-setting?state="+t+"&isPubTpl="+a+"&pageid="+e)},e.previewDetail=function(e,t){window.open(globals.basAppRoot+"js/template/index.html#/template-setting?&pageid="+t+"&template="+e+"&state=preview")},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformUploaderSvc",["$http","$q","platformModalSvc",function(t,a,n){var r,o={},i={unique_names:!0,runtimes:"html5,flash,html4",max_file_size:"2mb",chunk_size:"4mb",multi_selection:!("ios"===mOxie.Env.OS.toLowerCase()),uptoken_url:globals.basAppRoot+"file/getUpToken",domain:globals.basImageDomain,get_new_uptoken:!1,auto_start:!0,log_level:3,init:{}},s=1,l=[],c="images",u=function(){t.get(globals.basAppRoot+"file/getFileName").then(function(e){e.data.isSuccess?r=e.data.data:n.showWarmingMessage("生成图片库命名规则失败！","错误")})},d=function(){return r+"_"+s++};plupload.guid=function(){return"resource/"+c+"/"+d()},o.setResourceType=function(e){c=e||"images"},window.plupload.addFileFilter("max_count",function(e,t,a){var r=e.maxCount,o=e.listedCount();return r&&r<=o?void n.showWarmingMessage(e.errorTip,"提示"):void a(!0)}),plupload.addFileFilter("nsw_prevent_duplicates",function(e,t,a){if(e)for(var r=this.files.length;r--;)if(t.name===this.files[r].name&&t.size===this.files[r].size){var o=plupload.translate("Duplicate file error.")+"\r\n       '"+t.name+"'";return void n.showWarmingMessage(o,"提示").then(function(){a(!1)},function(){a(!1)})}a(!0)});var p=function(t){var a,n=this,r={},o={};return t=t||{},e.extend(o,i,t),n.nswHash=o.nswHash=d(),l.push(n),n.checkUploader=function(e){return o.nswHash===e},n.getOptions=function(){return o},n.runUploader=function(e){return o.browse_button=e||o.browse_button,a=Qiniu.uploader(o),_.forEach(r,function(e,t){_.forEach(e,function(e){e&&a.bind(t,e)})}),a},n.unbind=function(e,t){if(a)a.unbind(e,t);else{var o=r[e];_.forEach(r[e],function(e,a){if(t===e)return o[a]=null,!1})}return n},n.bind=function(e,t){return r[e]=r[e]||[],r[e].push(t),a&&a.bind(e,t),n},n.start=function(){a.start()},n.removeItem=function(e){a.removeFile(e)},n.remove=function(){a.unbindAll(),r=null,a.destroy()},n};return o.getUploaderSvc=function(e){return _.find(l,{nswHash:e})},o.createUploader=function(e){return new p(e)},o.resolveBase64=function(e){var t=a.defer();if(!/image\/\w+/.test(e.type))return n.showWarmingTip("请确保文件为图像类型"),!1;var r=new FileReader;return r.onload=function(){t.resolve(this.result)},r.readAsDataURL(e.getSource().getSource()),t.promise},o.resolveBaseFile=function(e){var t=a.defer();return t.resolve(e.getSource()),t.promise},u(),o}])}(angular),function(e){"use strict";e.module("platform").factory("platformWechatEmotionSvc",[function(){function e(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")}var t={},a=[{code:"/微笑",desc:"微笑",img:0},{code:"/撇嘴",desc:"撇嘴",img:1},{code:"/色",desc:"色",img:2},{code:"/发呆",desc:"发呆",img:3},{code:"/得意",desc:"得意",img:4},{code:"/流泪",desc:"哭",img:5},{code:"/害羞",desc:"羞",img:6},{code:"/闭嘴",desc:"哑",img:7},{code:"/睡",desc:"睡",img:8},{code:"/大哭",desc:"哭",img:9},{code:"/尴尬",desc:"囧",img:10},{code:"/发怒",desc:"怒",img:11},{code:"/调皮",desc:"调皮",img:12},{code:"/呲牙",desc:"笑",img:13},{code:"/惊讶",desc:"惊讶",img:14},{code:"/难过",desc:"难过",img:15},{code:"/酷",desc:"酷",img:16},{code:"/冷汗",desc:"汗",img:17},{code:"/抓狂",desc:"抓狂",img:18},{code:"/吐",desc:"吐",img:19},{code:"/偷笑",desc:"笑",img:20},{code:"/:,@-D",desc:"愉快",img:21},{code:"/白眼",desc:"奇",img:22},{code:"/傲慢",desc:"傲",img:23},{code:"/饥饿",desc:"饿",img:24},{code:"/困",desc:"累",img:25},{code:"/惊恐",desc:"吓",img:26},{code:"/流汗",desc:"汗",img:27},{code:"/憨笑",desc:"高兴",img:28},{code:"/::,@",desc:"闲",img:29},{code:"/奋斗",desc:"努力",img:30},{code:"/咒骂",desc:"骂",img:31},{code:"/疑问",desc:"疑问",img:32},{code:"/嘘",desc:"秘密",img:33},{code:"/晕",desc:"乱",img:34},{code:"/::8",desc:"疯",img:35},{code:"/:,@!",desc:"哀",img:36},{code:"/骷髅",desc:"鬼",img:37},{code:"/敲打",desc:"打击",img:38},{code:"/再见",desc:"bye",img:39},{code:"/擦汗",desc:"汗",img:40},{code:"/抠鼻",desc:"抠",img:41},{code:"/鼓掌",desc:"鼓掌",img:42},{code:"/糗大了",desc:"糟糕",img:43},{code:"/坏笑",desc:"恶搞",img:44},{code:"/左哼哼",desc:"什么",img:45},{code:"/右哼哼",desc:"什么",img:46},{code:"/哈欠",desc:"累",img:47},{code:"/鄙视",desc:"看",img:48},{code:"/委屈",desc:"难过",img:49},{code:"/快哭了",desc:"快哭了",img:50},{code:"/阴险",desc:"坏",img:51},{code:"/亲亲",desc:"亲",img:52},{code:"/吓",desc:"吓",img:53},{code:"/可怜",desc:"可怜",img:54},{code:"/菜刀",desc:"刀",img:55},{code:"/西瓜",desc:"水果",img:56},{code:"/啤酒",desc:"酒",img:57},{code:"/篮球",desc:"篮球",img:58},{code:"/乒乓",desc:"乒乓",img:59},{code:"/咖啡",desc:"咖啡",img:60},{code:"/饭",desc:"美食",img:61},{code:"/猪头",desc:"动物",img:62},{code:"/玫瑰",desc:"鲜花",img:63},{code:"/凋谢",desc:"枯",img:64},{code:"/:showlove",desc:"唇",img:65},{code:"/爱心",desc:"爱",img:66},{code:"/心碎",desc:"分手",img:67},{code:"/蛋糕",desc:"生日",img:68},{code:"/闪电",desc:"电",img:69},{code:"/炸弹",desc:"炸弹",img:70},{code:"/刀",desc:"刀",img:71},{code:"/足球",desc:"足球",img:72},{code:"/瓢虫",desc:"虫",img:73},{code:"/便便",desc:"臭",img:74},{code:"/月亮",desc:"月亮",img:75},{code:"/太阳",desc:"太阳",img:76},{code:"/礼物",desc:"礼物",img:77},{code:"/拥抱",desc:"伙伴",img:78},{code:"/强",desc:"赞",img:79},{code:"/弱",desc:"差",img:80},{code:"/握手",desc:"握手",img:81},{code:"/胜利",desc:"优",img:82},{code:"/抱拳",desc:"恭",img:83},{code:"/勾引",desc:"勾",img:84},{code:"/拳头",desc:"顶",img:85},{code:"/差劲",desc:"坏",img:86},{code:"/爱你",desc:"爱",img:87},{code:"/NO",desc:"不",img:88},{code:"/OK",desc:"好的",img:89},{code:"/爱情",desc:"爱",img:90},{code:"/飞吻",desc:"吻",img:91},{code:"/跳跳",desc:"跳",img:92},{code:"/发抖",desc:"怕",img:93},{code:"/怄火",desc:"尖叫",img:94},{code:"/转圈",desc:"圈",img:95},{code:"/磕头",desc:"拜",img:96},{code:"/回头",desc:"回头",img:97},{code:"/跳绳",desc:"跳",img:98},{code:"/:oY",desc:"天使",img:99},{code:"/激动",desc:"激动",img:100},{code:"/:hiphot",desc:"跳舞",img:101},{code:"/献吻",desc:"吻",img:102},{code:"/左太极",desc:"瑜伽",img:103},{code:"/右太极",desc:"太极",img:104}],n=/\.*([|\*|\.|\?|\+|\$|\^|\[|\]|\(|\)|\{|\}|\||\\|\/])\.*/gi;return t.getImagePath=function(e){return globals.basAppRoot+"plugins/kindeditor/plugins/emoticons/images/"+e+".gif"},t.imgToCode=function(t){return t=t.replace(/<img[^>]+src\s*=\s*['\"][^'\"]+\/(\d+).gif?[^'\"]+['\"][^>]*>/gi,function(e,t){return(_.find(a,{img:parseInt(t)})||{}).code}),t=t.replace(/[\n|\r\n]/gi,""),t=t.replace(/(<a[^<]+)(<br\s+\/>)([^<]{0,}<\/a>)/gi,"$1$3\n"),t=t.replace(/<br\s*[\/?]>/gi,"\n").replace(/&nbsp;/gi," "),t=e(t),t=_.trimRight(t,"\n")},t.codeToImg=function(e){return _.forEach(a,function(a){var r=a.code.replace(n,"\\$1"),o=new RegExp(r,"ig");o.test(e)&&(e=e.replace(o,'<img src="'+t.getImagePath(a.img)+'" alt="'+a.desc+'"/>'))}),e=e.replace(/\n/gi,"<br />")},t.getEmotions=function(){return a},t}])}(angular),function(e){"use strict";e.module("platform").factory("platformWordCountSvc",[function(){var e={};return e.count=function(e){var t=0;e=e||"";for(var a=0;a<e.length;a++){var n=e.charCodeAt(a);n>=1&&n<=126||65376<=n&&n<=65439?t++:t+=2}return t},e.slice=function(e,t,a){var n="",r=0;e=e||"";for(var o=0;o<e.length;o++){var i=e.charCodeAt(o);i>=1&&i<=126||65376<=i&&i<=65439?r++:r+=2,r>=t&&r<=t+a&&(n+=e[o])}return n},e.getSize=function(e){return e.replace(/<\/?a[^>]*>/gi,"").length},e}])}(angular),function(e){"use strict";e.module("platform").factory("platformImgLibSvc",["$q","platformModalSvc","nswGlobals","$http","platformMessenger",function(t,a,n,r,o){var i={},s=new o;return i.showImgLibModal=function(t,n,r){return a.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"components/templates/platform-image-lib-dir.html",controller:"imglibWinCtrl",size:"lg",options:{showAlign:r,imgConfig:t,selectedItem:e.copy(n)}}).then(function(e){return e},function(){return!1})},i.loadWechatData=function(){var e={method:"get",url:globals.basAppRoot+"material/materialInfoImage",params:{appId:n.getValue("appId"),pageNum:1,pageSize:8}};return r(e).then(function(e){return e.data.isSuccess?s.fire(e.data.data):a.showWarmingMessage(e.data.data,"获取数据失败"),e.data})},i.registerdataload=function(e){s.register(e)},i.unregisterdataload=function(e){s.unregister(e)},i}])}(angular),function(e){"use strict";e.module("platform").factory("platformMenuDataSvc",["$http","platformMessenger","nswGlobals",function(e,t,a){var n,r,o,i={},s="platform_menus_selectedMenu",l="platform_menus_selectedMenuGroup",c={groups:[]},u=new t,d=new t,p=function(e){n=m((n||a.getValue(s)||{}).name),r=h(n)||a.getValue(l)||{},r=f(r.name),n=n||r,_.forEach(e,function(e){_.has(e,"selected")&&delete e.selected,e.defaultSelected&&!r&&(r=e),_.forEach(e.menus,function(e){_.has(e,"selected")&&delete e.selected,e.defaultSelected&&!n&&(n=e)}),n=n||r,n.defaultSelected=!0}),u.fire(n,r)},m=function(e){var t;return _.forEach(c.groups,function(a){return a.name===e?(t=a,!1):void(a.menus&&_.forEach(a.menus,function(a){if(a.name===e)return t=a,!1}))}),t},f=function(e){return _.find(c.groups,{name:e})};i.getMenuByState=function(e){var t;return e=e.replace(/^wechat./,""),_.forEach(c.groups,function(a){
return a.state===e||(e||"").slice(0,(a.state||"").length)===a.state?(t=a,!1):(a.menus&&_.forEach(a.menus,function(n){if(n.state===e||a.state+"."+n.state===e)return t=n,!1}),!t&&void 0)}),t||{name:""}};var g=function(){if(!o||o!==a.getValue("appId"))return o=a.getValue("appId"),e({method:"get",url:globals.basAppRoot+globals.menuSrc,params:{appId:o}}).then(function(e){if(e.data.isSuccess){if(c=e.data.data||{groups:[]},c.groups.push({name:"公众号管理",state:"accountEdit",hide:!0}),n&&n.updateState){var t=m(n.name);a.setValue(s,t,!0),t&&i.fireMenuSelected(t)}p(c.groups),d.fire(c)}})},h=function(e){var t;return _.forEach(c.groups,function(a){return a!==e&&(_.forEach(a.menus,function(n){if(n===e)return t=a,!1}),!t)}),t||e};return i.getMenus=function(){return c},i.fireMenuSelected=function(e,t){t=!_.isBoolean(t)||t;var o=m(e.name)||"",i=h(e);o?(a.setValue("platform_menus_defaultState",null,!0),u.fire(o,i,t),a.setValue(s,{name:o.name},!0),a.setValue(l,{name:i.name},!0)):(a.setValue("platform_menus_defaultState",!0,!0),a.setValue(s,{name:e.name},!0),a.setValue(l,{name:e.name},!0)),n=m(e.name)||"",r=h(e)},i.getCurrentMenu=function(){return n},i.getCurrentMenuGroup=function(){return r},i.selectMenu=function(e,t){if(e){var r=m(e)||i.getMenuByState(e);r&&r.name?i.fireMenuSelected(r,t):(n={name:e,updateState:!0},a.setValue(s,n,!0))}},i.registerMenuLoaded=function(e){c&&c.groups.length&&e.apply(this,c),d.register(e)},i.unregisterMenuLoaded=function(e){d.unregister(e)},i.registerMenuSelected=function(e){n&&c.groups.length&&e.apply(this,n,h(n)),u.register(e)},i.unregisterMenuSelected=function(e){u.unregister(e)},i.reloadSystemMenus=function(){return g()},i}])}(angular),function(e){"use strict";e.module("platform").filter("nswDate",["$filter",function(e){return function(t,a){if(t){var n=t.replace(/-/g,"/"),r=new Date(n);return e("date")(r,a)}}}])}(angular),function(e){"use strict";e.module("platform").filter("nswDesc",["platformWordCountSvc",function(e){return function(t,a,n){t=t||"";var r=n?e.count(t):t.length;if(a=a||r,r&&r>a)if(n)t=e.slice(t,0,a)+"...";else{var o=t.match(/<\/?a[^>]*>/gi).join("").length;t=t.slice(0,a+o)+"..."}return t}}])}(angular),function(e){"use strict";e.module("platform").filter("nswEmoji",[function(){return function(e,t,a){return e=e||"",Emoji.trans(e)}}])}(angular),function(e){"use strict";e.module("platform").filter("nswEmotions",["$sce","platformWechatEmotionSvc",function(e,t){return function(e){return e=e||"",e="<p>"+t.codeToImg(e)+"</p>"}}])}(angular),function(e){"use strict";e.module("platform").filter("nswTrusted",["$sce",function(e){return function(t){return t=t||"",e.trustAsHtml(t)}}])}(angular),function(e){"use strict";e.module("platform").controller("imgLibCtrlx",["$scope","$modalInstance","platformImgLibSvc","platformModalSvc","nswGlobals",function(e,t,a,n,r){e.imgurl="material/image/upload?appId="+r.getValue("appId"),a.loadWechatData(),a.registerdataload(function(t){e.dataList=t}),e.setCurrentItem=function(t){e.currentItem=t},e.changeFile=function(t){e.currentItem=t,e.closeModal("true",e.currentItem)},e.ok=function(){e.closeModal("true",e.currentItem)}}])}(angular),function(e){"use strict";e.module("platform").controller("imglibWinCtrl",["$scope","platformImageLibSvc","basListCtrlSvc",function(e,t,a){a.createInstance(e,t,{}),e.modalOptions.selectedItem?e.setCurrentItem(e.modalOptions.selectedItem):e.setCurrentItem({});var n=function(){t.loadImageSize().then(function(t){e.phoneImg="手机网站图片("+t.cmsImageSize+")",e.myImg="微信管家图片("+t.wxImageSize+")"}),"wechat"!==t.getFilterType()?e.searchType("wechat",1):e.searchData()};e.searchType=function(a,n){e.tab=n,t.setFilterType(a),e.searchOptions&&(e.searchOptions.pageNum=1,e.searchOptions.filter=""),e.searchData().then(function(a){t.loadImageSize().then(function(t){e.phoneImg="手机网站图片("+t.cmsImageSize+")",e.myImg="微信管家图片("+t.wxImageSize+")"});var n=_.find(t.getDataList(),{fileId:t.getCurrentItem().fileId});t.setCurrentItem(n)})},e.changeFile=function(t){e.searchOptions.filter="",e.searchOptions.pageNum=1,e.setCurrentItem(t),e.searchType("wechat",1)},e.searchOptions.pageNum=1,e.searchOptions.filter="",n()}])}(angular),function(e){"use strict";e.module("platform").controller("platformModalMessageCtrl",["$scope","$timeout",function(e,t){}])}(angular),function(e){"use strict";e.module("platform").controller("platformModalTipCtrl",["$scope","$timeout",function(e,t){var a=($('[ng-controller="desktopMainCtrl"]')[0]||$(window)[0]).clientHeight>$(window).height();e.modalOptions.closeModal=function(){e.closeModal()},e.getTipIcon=function(){switch(e.modalOptions.type){case"success":return"icon-success";case"warming":return"icon-warming";default:return"icon-loading"}},$(".tip-box").closest(".modal-content").css("border",0).css("box-shadow","0 0 0").css("background-color","#C4C5CA").closest(".modal-dialog").css("box-shadow","0 0 0").css("opacity",.6),"loading"!==e.modalOptions.type&&(a&&$("html").css("overflow-y","auto"),$(".tip-box").closest(".modal-backdrop").css("display","none"),$(".tip-box").closest(".nsw.modal-dialog").css("margin",0),$(".tip-box").closest(".nsw.modal").css("width",$(".modal-content").width).css("height","59px").css("overflow","hidden").css("margin-top","150px").css("width","300px").css("margin-left","40%"),t(function(){e.closeModal(!0)},2e3))}])}(angular),function(e){"use strict";e.module("platform").controller("platformPreviewCtrl",["$scope","$timeout","platformPreviewSvc","accountDataSvc","platformModalSvc",function(t,a,n,r,o){t.isPreview=!0,t.option=e.noop,t.option.material={},t.option.tab="material","news"===t.modalOptions.type?(n.loadArticle(t.modalOptions.information.mediaId).then(function(e){t.option.material=e,t.option.create_time=e.create_time,n.setCurrentItem(e.articles[0])}),t.mobilePreviewItem={appId:t.option.material.appId,massType:"news",mediaId:t.option.material.id}):(t.option.material=e.copy(t.modalOptions.information),t.option.create_time=t.option.material.create_time,n.setCurrentItem(t.option.material.articles[0]),t.mobilePreviewItem={articles:t.option.material.articles,appId:t.option.material.appId});var i=function(e){t.currentWechtInfo=e};t.selectTab=function(e){t.option.tab=e,"article"===e&&(t.option.currentItem=n.getCurrentItem(),_.has(t.option.currentItem,"isArticle")&&t.option.currentItem.isArticle&&n.omitAttr(t.option.currentItem,"otherUrl"))},t.option.create_time||(t.option.create_time=(new Date).format("yyyy-MM-dd hh:mm:ss")),t.previewArticle=function(e){e&&n.setCurrentItem(e),t.selectTab("article")},r.registerCurrentItemChanged(function(e){i(e)}),n.registerSwichShow(function(){$(".nsw-article").animate({scrollTop:"0px"},300)}),t.$on("$destroy",function(){r.unregisterCurrentItemChanged(),n.unregisterSwichShow()})}])}(angular),function(e){"use strict";e.module("platform").controller("platformPreviewSendCtrl",["$scope","platformPreviewSvc","platformModalSvc",function(e,t,a){t.loadFans().then(function(t){e.groupTypes=t}),e.send=function(){e.formpreview.$dirty=!1,e.modalOptions.information.openId=e.options.groupType,e.modalOptions.information.mediaId||e.modalOptions.information.massType?t.sendMassMsg(e.modalOptions.information).then(function(){a.showSuccessTip("发送成功"),e.closeModal(!0)},function(){a.showWarmingTip("消息发送失败"),e.closeModal(!0)}):t.mobilePreview(e.modalOptions.information).then(function(){a.showSuccessTip("发送成功"),e.closeModal(!0)},function(){a.showWarmingTip("消息发送失败"),e.closeModal(!0)})}}])}(angular),function(e){"use strict";e.module("platform").directive("nswAuthEnable",["platformNswAuthSvc",function(e){return{link:function(t,a,n){var r=n.nswAuthEnable,o=t.$new(!1);o.hasCode=function(t){return e.getAuth(t)};var i=function(){a.attr("disabled","disabled"),a.css("readonly","true"),a.addClass("not-authed"),"a"===a[0].tagName.toLowerCase()&&n.href&&(a.attr("data-nsw-href",n.href),a.attr("href","javascript:void(0)"))},s=function(){a.removeClass("not-authed"),a.attr("data-nsw-href",a.attr("data-nsw-href"))};e.getAuth(r)?s():i();var l=t.$watch(function(){var t=/^\${1}/;return t.test(r)?o.$eval(r.replace(t,"")):e.getAuth(r)},function(e){e?s():i()});t.$on("$destroy",function(){l()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswAuthIf",["platformNswAuthSvc",function(e){return{link:function(t,a,n){var r=n.nswAuthIf,o=t.$new(!1);o.hasCode=function(t){return e.getAuth(t)};var i=function(){a.addClass("not-authed-hide")},s=function(){a.removeClass("not-authed-hide")};e.getAuth(r)||i();var l=t.$watch(function(){var t=/^\${1}/;return t.test(r)?o.$eval(r.replace(t,"")):e.getAuth(r)},function(e){e?s():i()});t.$on("$destroy",function(){l()})}}}])}(angular),function(e){"use strict";e.module("platform").factory("platformNswAuthSvc",["$http","$q","platformModalSvc","$localStorage",function(e,t,a,n){var r={};return r.getAuth=function(e){var t=n.nswAuths||[];return!!_.find(t,{authority:e})},r.loadAuthData=function(){var r=globals.basAppRoot+"/user/getAuthoritiesCode",o=t.defer();return e.get(r).then(function(e){e.data.isSuccess?(n.nswAuths=_.map(e.data.data,function(e){return{authority:e}}),o.resolve(n.nswAuths)):(a.showWarmingMessage("权限数据获取失败","提示"),o.reject("权限数据获取失败"))},function(e){console.error(e),a.showWarmingMessage("权限数据获取失败","提示"),o.reject("权限数据获取失败")}),o.promise},r}])}(angular),function(e){"use strict";e.module("platform").directive("dateRangePicker",["platformDateSvc",function(t){return{restrict:"A",scope:{options:"=",afterSelect:"&",range:"="},template:'<div class="col-sm-4 range-picke"><input type="text" class="form-control"><i data-ng-click="deleteTime()" data-ng-if="showDelete" class="glyphicon glyphicon glyphicon-remove"></i><i class="glyphicon glyphicon-calendar fa fa-calendar" ng-class = {\'has-remove\':!showDelete} ></i></div>',replace:!0,link:function(a,n){a.showDelete=!1,a.backData={};var r=function(){var r={minDate:t.dateRange({range:365}),maxDate:(new Date).format("yyyy-MM-dd"),startDate:a.range&&a.range.start?a.range.start:t.dateRange({range:30}),endDate:a.range&&a.range.end?a.range.end:(new Date).format("yyyy-MM-dd"),locale:{format:"YYYY-MM-DD",language:"zh-CN",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十月","十二月"],applyLabel:"确认",cancelLabel:"取消"}};a.options&&a.options.showDelete&&(a.showDelete=a.options.showDelete);var o=e.extend({},r,a.options);a.options&&a.options.locale&&(o.locale=e.extend({},r.locale,a.options.locale)),n.find(".glyphicon-calendar").click(function(){n.find("input").click()}),n.find("input").daterangepicker(o,function(e,t){a.options&&a.options.locale&&a.options.locale.format?(a.backData.start=e.format(o.locale.format),a.backData.end=t.format(o.locale.format),a.afterSelect({data:a.backData})):(a.backData.start=e.format("YYYY-MM-DD"),a.backData.end=t.format("YYYY-MM-DD"),a.afterSelect({data:a.backData}))})};a.deleteTime=function(){n.find("input").val(""),a.backData.start="",a.backData.end="",a.afterSelect({data:a.backData})},a.$evalAsync(function(){r()});var o=a.$watch("range",function(e){e&&r()});a.$on("$detory",function(){o()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("dateTimePicker",["platformDateSvc",function(t){return{restrict:"A",require:"ngModel",templateUrl:globals.basAppRoute+"components/templates/date/platform-date-time-picker.html",scope:{},link:function(t,a,n,r){var o;t.showDelete="false"===!n.showDelete,t.backData={};var i=function(){var i={locale:{format:n.format||"YYYY-MM-DD HH:mm:ss",language:"zh-CN",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十月","十二月"],applyLabel:"确认",cancelLabel:"取消"},singleDatePicker:!0,timePicker:!0,timePicker24Hour:!0,timePickerSeconds:!0,maxDate:"2100-12-30",minDate:(new Date).format("yyyy-MM-dd hh:mm:ss"),startDate:r.$viewValue,showDelete:t.showDelete};t.options&&t.options.showDelete&&(t.showDelete=t.options.showDelete);var s=e.extend({},i,t.options);t.options&&t.options.locale&&(s.locale=e.extend({},i.locale,t.options.locale)),a.find(".glyphicon-calendar").click(function(){o.click()}),o=a.find("input").daterangepicker(s,function(e){r.$setViewValue(e.format(s.locale.format))}),o.val(r.$viewValue)},s=function(){a.find("input").val("")};t.deleteTime=function(){t.backData.start="",s()},r.$render=function(){var e=r.$viewValue;e||s(),o&&o.val(e)},t.$evalAsync(function(){i()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswDropdown",[function(){return{restrict:"A",scope:{items:"=",afterSelect:"&",dir:"@",filter:"=",reject:"="},templateUrl:globals.basAppRoute+"components/directives/dropdown/platform-nsw-dropdown-dir.html",require:"ngModel",link:function(t,a,n,r){var o=!1;t.display=n.nswDisplay,t.value=n.nswValue;var i=function(e){e=e||{},t.selected=e,e.id===-9999?t.displayText=e.name:t.displayText=_.get(e,t.display)};t.select=function(a){if(a=a||{},a.id!==-9999){var n=_.get(a,t.value);e.isDefined(n)&&(r.$setViewValue(n),i(a)),t.afterSelect({value:n,selected:a})}};var s=function(e){return e=e||t.items,t.filter&&(e=_.filter(e,t.filter)),t.reject&&(e=_.reject(e,t.reject)),e};t.execFilter=function(e){e=e||t.items,e=s(e),t.displayItems=_.filter(e,function(e){var a=_.get(e,t.display);return!t.displayText||a.indexOf(t.displayText)>=0}),o=!0},t.displaySelect=function(n,r){"up"===t.dir&&a.find(".dropmenu").css("position","inherit"),e.isUndefined(n)&&(n=!a.find(".dropmenu").hasClass("open"));var o=a.find(".dropmenu").hasClass("open");n=!!n,o=!!o,n!==o&&a.find(".nsw-dropdown-menu").dropdown("toggle"),r&&(t.displayItems=s(t.items))},r.$render=function(){var e=r.$viewValue,a={};_.set(a,t.value,e);var n=_.find(t.items,a);i(n)},a.on("click",function(e){e.stopPropagation()}),a.on("keyup",function(){t.displaySelect(!0),t.execFilter(),t.$apply()}),$("body").on("click",function(){setTimeout(function(){t.$apply()},500)}),t.$watchCollection("items",function(e,a){a&&a.length&&o?t.execFilter(e):(e=s(e),t.displayItems=e),t.displayItems=t.displayItems||[],t.displayItems.length||t.displayItems.push({name:"【无】",id:-9999});var n={};n[t.value]=r.$viewValue,i(_.find(e,n))}),t.$watch(function(){return a.find(".dropmenu").hasClass("open")},function(e){e||i(t.selected)})}}}])}(angular),angular.module("platform").directive("platformEcharts",[function(){"use strict";return{link:function(e,t){function a(){var a=e.config&&e.config.theme?e.config.theme:"default",n=echarts.init(t[0],a);e.config&&e.config.dataLoaded===!1&&n.showLoading(),e.config&&e.config.dataLoaded&&(n.setOption(e.option),n.resize(),n.hideLoading()),e.config&&e.config.event&&angular.isArray(e.config.event)&&angular.forEach(e.config.event,function(e){for(var t in e)n.on(t,e[t])})}e.$watch(function(){return e.config},function(e){e&&a()},!0),e.$watch(function(){return e.option},function(e){e&&a()},!0)},scope:{option:"=ecOption",config:"=ecConfig"},restrict:"A"}}]),function(e){"use strict";e.module("platform").factory("platformFormBuilderSvc",["$templateCache","$compile","rowBuilderSvc","platformFormDomainSvc",function(t,a,n,r){var o={},i=function(e){var a="form-"+e+".html";return t.get(a)||""},s=function(t,a){var n=r.getDomainConfig(a.domain)||{};a=e.extend(n,a);var o=!_.isBoolean(a.hasLabel)||a.hasLabel;a.label=a.label||"";var s,l,c=i("row"),u=i("required"),d=o?i("label"):"",p=i(a.template),m=i("errorContainer"),f=(a.model||"").replace(/\./g,""),g=[],h=[],v="";a.required&&(v+="required ",s=i("error"),s=s.replace(/%errorMessage%/g,"请填写"+a.label).replace(/%formName%/g,t).replace(/%name%/g,f).replace(/%error%/g,"required"),g.push(s)),a.maxLength&&(v+='ng-maxlength="'+a.maxLength+'" ',p=p.replace(/%maxLengthCount%/g,a.maxLength),s=i("error"),s=s.replace(/%errorMessage%/g,a.label+"长度为0~"+a.maxLength+"字符").replace(/%formName%/g,t).replace(/%name%/g,f).replace(/%error%/g,"maxlength"),g.push(s),l=i("maxLengthValidateTip"),l=l.replace(/%maxLength%/g,a.maxLength),h.push(l)),a.maxWord&&(v+='data-max-word="'+a.maxWord+'" ',s=i("error"),s=s.replace(/%errorMessage%/g,a.label+"使用逗号、空格和分隔符，并不能超过"+a.maxWord+"个关键字").replace(/%formName%/g,t).replace(/%name%/g,f).replace(/%error%/g,"maxword"),g.push(s)),d=d.replace(/%required%/g,a.required?u:"").replace(/%label%/g,a.label),c=c.replace(/%label%/g,d);var b=a.size||5,w="col-md-%s% col-lg-%s% col-sm-%s% col-xs-%s%";return m=g.length?m.replace(/%content%/g,g.join("\r\n")):"",m=m.replace(/%formName%/g,t).replace(/%name%/g,f),p=p.replace(/%size%/,w.replace(/%s%/g,b)),p=p.replace(/%type%/g,a.type||"text"),p=p.replace(/%model%/g,"data."+a.model||""),p=p.replace(/%name%/g,f||""),p=p.replace(/%validators%/g,v),p=p.replace(/%errors%/g,m),p=p.replace(/%validateTip%/g,a.hasValidateTip&&h.length?h.join(" "):""),p=p.replace(/%rows%/g,a.textRows||""),p=p.replace(/%directive%/g,a.directive||""),p=p.replace(/%options%/g,a.directive?"options":""),c=c.replace(/%content%/g,p)};return o.buildFormTemplate=function(e){if(!e)return"";e.hasLabel=!_.isBoolean(e.hasLabel)||e.hasLabel,e.hasValidateTip=!_.isBoolean(e.hasValidateTip)||e.hasValidateTip;var t=e.name,a=[];return _.forEach(e.rows,function(n){n.hasLabel=_.isBoolean(n.hasLabel)?n.hasLabel:e.hasLabel,n.hasValidateTip=_.isBoolean(n.hasValidateTip)?n.hasValidateTip:e.hasValidateTip,a.push(s(t,n))}),a.join("\r\n")},o.buildTemplate=function(e,t){return n.init(e,t),n.build()},o.buildForm=function(t){if(!t)return"";t.hasLabel=!_.isBoolean(t.hasLabel)||t.hasLabel,t.hasValidateTip=!_.isBoolean(t.hasValidateTip)||t.hasValidateTip;var a=[];return _.forEach(t.rows,function(n){var i=r.getDomainConfig(n.domain)||{};n=e.extend(i,n),n.label=n.label||"",n.name=n.name||(n.model||"").replace(/\./g,""),n.hasLabel=_.isBoolean(n.hasLabel)?n.hasLabel:t.hasLabel,n.hasValidateTip=_.isBoolean(n.hasValidateTip)?n.hasValidateTip:t.hasValidateTip,n.maxLength&&(n.validateTip=n.validateTip||"maxLength"),a.push(o.buildTemplate(t,n))}),a.join("\r\n")},o}])}(angular),function(e){"use strict";e.module("platform").directive("platformForm",["$compile","platformFormBuilderSvc",function(t,a){return{restrict:"A",required:"ngModel",replace:!0,link:function(n,r,o){n._formOptions=n.$eval(o.options)||{},n.onPropertyChanged=n.$eval(o.onPropertyChanged)||e.noop,o.$observe("onPropertyChanged",function(){n.onPropertyChanged=n.$eval(o.onPropertyChanged)||e.noop});var i=function(){if(n._formOptions){n.lookups=n._formOptions.lookups;var e=$(a.buildForm(n._formOptions));r.html(""),r.append(e),t(e)(n)}};n.$watch(n._formOptions.name+".$invalid",function(e){n._formOptions.$invalid=e}),n.onChange=function(){n.onPropertyChanged.apply(this,arguments),n._formOptions.isDirty=!0};var s=function(){n._formOptions.setData=function(e){n._formOptions.name=n._formOptions.name||"",n.data=e,n._formOptions.data=e,n[n._formOptions.name]&&n[n._formOptions.name].$setPristine(!0)},n._formOptions.setData(n._formOptions.data)},l=function(){var e,t,a=function(){e=n.$watch("_formOptions.rows",function(){i()}),t=n.$watch("_formOptions.data",function(e){n._formOptions.setData(e)})},r=function(){_.isFunction(e)&&e(),_.isFunction(t)&&t()};if(n._formOptions&&n._formOptions.name){var l=n.$watch(function(){return n.$eval(o.options)},function(e){n._formOptions=e||{},s(),i(),r(),a()});a(),n.$on("$destroy",function(){l(),r()})}};n.$evalAsync(function(){l()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformInputAutofocus",[function(){return{restrict:"A",link:function(e,t,a){t.focus()}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.service("platformImageLibSvc",["$q","$http","basDataSvc","nswGlobals","platformModalSvc",function(e,t,a,n,r){var o="wechat",i={uri:"material/materialInfoImage",list:{listUri:function(){return"wechat"===o?"material/materialInfoImage":"cms/listFiles"},enableSearch:!0,enablePaging:!0,pageSize:8,prepareSearchParam:function(e){e.appId=n.getValue("appId"),e.projId=s.projectId},selectionMode:"single"}},s=a.createInstance(i);return s.registerListLoaded(function(e){_.forEach(e,function(e){e.name=e.name||e.fileName})}),s.getProjectId=function(){t.get(globals.basAppRoot+"/cms/getProjectLists").then(function(e){e.data.isSuccess&&(s.projectId=e.data.data,s.getSearchOptions().projectId=s.projectId)})},s.loadImageSize=function(){var a=e.defer(),o={method:"get",url:globals.basAppRoot+"cms/listImageSize",params:{appId:n.getValue("appId")}};return t(o).then(function(e){return e.data.isSuccess?a.resolve(e.data.data):(a.reject(e.data.data),r.showWarmingMessage(e.data.data,"获取数据失败")),a.promise})},s.saveFile=function(a,n){var o=e.defer(),i={method:"post",url:globals.basAppRoot+a+"/saveFile",data:n};return t(i).then(function(e){return e.data.isSuccess?o.resolve(e.data.data):(o.reject(e.data.data),r.showWarmingMessage(e.data.data,"图片保存失败！")),o.promise})},s.setFilterType=function(e){o=e},s.getFilterType=function(){return o},s.getProjectId(),s.loadData(),s}])}(angular),function(e){"use strict";e.module("platform").directive("platformImgUpload",["platformModalSvc","platformImgUploaderSvc","nswGlobals","platformImageLibSvc",function(e,t,a,n){return{restrict:"A",require:"ngModel",transclude:!0,scope:{imgUrl:"=",changeFile:"&",fileUploaded:"&",module:"@"},template:'<div><div class="container" style="display: none"></div><div class="el" ng-transclude></div></div>',link:function(r,o,i,s){var l,c,u=null,d=function(){l=t.createUploader(),c=l.getOptions(),o.attr("id",c.nswHash),l.bind("StateChanged",function(){this.state===plupload.STARTED&&(u=e.showLoadingTip("正在上传图片!"))}).bind("UploadComplete",function(e,t){var o=_.map(t,function(e){var t={appId:a.getValue("appId"),originName:e.fileName,fileName:e.target_name,fileId:e.target_name};return l.removeItem(e),t});n.saveFile(r.module||"file",o).then(function(){u&&u.close(),r.changeFile({file:o[0],files:o})},function(){u&&u.close()})}),l.runUploader(c.nswHash)};r.$evalAsync(function(){d()}),s.$render=function(){r.file=s.$viewValue},r.$on("$destroy",function(){l.remove()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("imgLib",["$modal","$parse","platformImgLibSvc","platformImageLibSvc",function(e,t,a,n){return{restrict:"A",require:"?ngModel",scope:{imgConfig:"=",imgSize:"@",imgWidth:"@",imgHeight:"@",ext:"@",nswAlt:"@",afterSelect:"&"},link:function(e,n,r,o){r.imgLib=r.imgLib||"image";var i=r.imgConfig?t(e.imgConfig)(e):{count:1,size:parseInt(e.imgSize||"300"),width:parseInt(e.imgWidth||"800"),height:parseInt(e.imgHeight||"800"),ext:e.ext||"gif,jpg,jpeg,bmp,png"};"url"!==r.imgLib&&"image"!==r.imgLib||(i.count=1),o&&(o.$render=function(){"url"===r.imgLib?e.image={url:o.$viewValue,alt:e.nswAlt,fileName:e.nswAlt}:e.image=o.$viewValue}),n.bind("click",function(t){t.stopPropagation(),a.showImgLibModal(i,e.image).then(function(t){t&&(o&&o.$setViewValue("url"===r.imgLib?t.fileId:t),e.afterSelect({image:t}))})})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswImg",["platformImgLibSvc",function(e){return{restrict:"A",scope:!0,transclude:!0,template:'<div class="nsw-img-dir">           <i class="fa fa-times nsw-img-icon remove" ng-show="enableRemove" ng-click="_removeImg();"></i>           <i class="fa fa-eye nsw-img-icon preview" ng-show="enablePreview" ng-click="_imgPreview(url,$event)"></i>\t           <i class="edit-icon nsw-img-icon" ng-show="nswImgEnableEdit" ng-click="_editImage()"></i>\t           <a href="javascript:void(0);">                   <img nsw-src="{{_src}}" data-ng-click="_selectImage()" class="img"></a>           <input type="text" placeholder="请写图片描述" ng-disabled="hasProgress" class="form-control alt" autocomplete="off" ng-change="_altChanged(_alt)"  ng-model="_alt" ng-show="!altReadonly"  /></li>           <span class="form-control alt" ng-show="altReadonly"  ng-bind="_alt" /></li>           <span class="c-ready-up" ng-hide="!isUpload||hasProgress">{{img.state}}</span>           <div class="progress progress-mini" ng-show="isUpload && hasProgress">               <div style="width:{{img.progress}}%;" class="progress-bar progress-bar-success"></div>           </div></div>',link:function(t,a,n){t.enableRemove=!!n.nswImgRemove,t.enablePreview="true"===n.enablePreview,t.enableAlt=!!n.nswImgAlt,t.altReadonly="true"===n.altReadonly,t.nswImgEnableEdit="true"===n.nswImgEnableEdit,t.isUpload="true"===n.isUpload,t.hasProgress="true"===n.hasProgress,t.process=parseInt(n.progress),t._alt=t.$eval(n.nswImgAlt),t._src=t.$eval(n.nswImgSrc),n.$observe("nswImgAlt",function(){t.lockAlt||(t._alt=t.$eval(n.nswImgAlt))}),n.$observe("isUpload",function(){t.isUpload="true"===n.isUpload}),n.$observe("hasProgress",function(){t.hasProgress="true"===n.hasProgress}),n.$observe("process",function(){t.process=parseInt(n.progress)}),n.$observe("nswImgAlt",function(){t.lockAlt||(t._alt=t.$eval(n.nswImgAlt))}),t._altChanged=function(e){t.lockAlt=!0,_.set(t,n.nswImgAlt,e),t._alt=e,t.setModelDirty&&t.setModelDirty(),t.lockAlt=!1},n.$observe("nswImgSrc",function(){t._src=t.$eval(n.nswImgSrc)}),t._srcChanged=function(e){_.set(t,n.nswImgSrc,e),t.setModelDirty&&t.setModelDirty()},t._editImage=function(){var a={count:1,size:300,width:800,height:800,ext:"gif,jpg,jpeg,bmp,png"};e.showImgLibModal(a,{url:t._src}).then(function(e){t._src=e.url,!_.get(t,n.nswImgAlt)&&e.fileName&&(t._alt=e.fileName,t._altChanged(e.fileName.split(".")[0])),t._srcChanged(e.url)})},t._removeImg=function(){_.set(t,n.nswImgSrc,null),n.nswImgRemove&&t.$eval(n.nswImgRemove),t.$emit("itemremove",t._src)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswImgGroup",["$timeout",function(e){return{restrict:"A",template:'<span class = "glyphicon glyphicon-menu-left loopleft" ng-show = "imgs.length>maxItems"  ng-click = "back()"></span>               <div class="loopbox col-sm-11 nsw-img-group">                   <ul>                       <li ng-repeat = "(key,img) in imgs" class="img-container">                           <div nsw-img ng-if="showAlt" nsw-img-src="{{nswImgSrc}}" data-is-upload="{{img.isUpload}}" data-has-progress="{{img.hasProgress}}" data-process="{{img.process}}" data-alt-readonly="{{altReadonly}}" nsw-img-alt="{{nswImgAlt}}" nsw-img-enable-edit="{{nswImgEnableEdit}}" nsw-img-remove="{{imgRemoveAttr}}">                           </div>                           <div nsw-img ng-if="!showAlt" nsw-img-src="{{nswImgSrc}}"data-is-upload="{{img.isUpload}}" data-has-progress="{{img.hasProgress}}" data-process="{{img.process}}" nsw-img-remove="{{imgRemoveAttr}}"></div>                       </li>                   </ul>               </div>         <span  class = "glyphicon glyphicon-menu-right loopright" ng-show = "imgs.length>maxItems"  ng-click = "mov()"></span>',scope:!0,transclude:!0,require:"ngModel",link:function(t,a,n,r){t.enableSort="true"===n.enableSort,t.maxItems=parseInt(n.maxItems||"1"),t.showAlt="true"===n.showAlt,t.altReadonly="true"===n.altReadonly,t.nswImgSrc=n.nswImgSrc||"img.url",t.nswImgAlt=n.nswImgAlt||"img.alt",t.imgRemoveAttr=n.nswImgRemove,t.nswImgEnableEdit=n.nswImgEnableEdit;var o=function(){var e=null;n.nswHeight&&a.find(".loopbox").height(n.nswHeight),n.nswWidth&&a.find(".loopbox").width(n.nswWidth),$("li.img-container",a).draggable({axis:"x",appendTo:"body",containment:"parent",revert:"invalid",helper:"clone",create:function(){$(this).css("list-style","none")},drag:function(t,a){e=$(this).scope().img,$(a.helper).css("list-style","none"),$(a.helper).css("z-index","911215")},stop:function(){e=null}}),$("li.img-container",a).droppable({accept:"li.img-container",drop:function(){var n=$(this).scope().img;if(e&&n&&e!==n){var r,o,i=_.findIndex(t.imgs,e);_.remove(t.imgs,e);var s=_.findIndex(t.imgs,n);i>s?(r=t.imgs.slice(0,s),o=t.imgs.slice(s)):(r=t.imgs.slice(0,s+1),o=t.imgs.slice(s+1)),r.push(e);var l=r.concat(o);t.imgs.length=0,_.forEach(l,function(e){t.imgs.push(e)}),t.$digest()}$(".drop-active",a).removeClass("drop-active")},over:function(){$(".nsw-img-dir",this).addClass("drop-active")},out:function(){$(".nsw-img-dir",this).removeClass("drop-active")}}),$(".loopleft").droppable({accept:"li.img-container",over:function(){t.$apply(function(){t.back()})},drop:function(){alert(1)}}),$(".loopright").droppable({accept:"li.img-container",over:function(){t.$apply(function(){t.mov()})}})};t.setModelDirty=function(){r.$setViewValue(t.imgs)},r.$render=function(){t.imgs=r.$viewValue||[],e(function(){o()})},t.$watch("imgs.length",function(){o()}),t.$on("itemremove",function(){$(".loopbox ul",a).hasClass("mov")&&t.imgs.length%t.maxItems===0&&t.back()}),t.mov=function(){$(".loopbox ul",a).addClass("mov").removeClass("back")},t.back=function(){$(".loopbox ul",a).addClass("back").removeClass("mov")}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformEmotionEditor",["$compile","platformKindEditorDataSvc","platformWechatEmotionSvc",function(t,a,n){return{restrict:"A",scope:{turnDesign:"="},require:"ngModel",templateUrl:globals.basAppRoute+"components/directives/kindeeditor/templates/emotion-editor.html",link:function(t,r,o,i){var s,l={},c=r.find("textarea");t.options=t.$parent.$eval(o.options)||{},t.options.maximumWords=t.options.maximumWords||parseInt(o.kMaximumWords),t.name="keditor-"+a.getUUID(),t.emotions=n.getEmotions(),t.resolveImage=function(e){return n.getImagePath(e)},t.addLink=function(){l.clickToolbar("link")};var u='textarea[name="'+t.name+'"]';c.attr("name",t.name);var d=e.copy(t.options);d.items=["wxemotions"],d.width=o.width||"100%",d.height=o.height||"100%",o.width&&(r.width(o.width),d.width=o.width),o.height&&(r.height(o.height),d.height=o.height),d=_.extend({},{resizeType:1,newlineTag:"br",allowPreviewEmoticons:!1,allowImageUpload:!1,cssPath:globals.basAppRoute+"components/content/css/kindeditor/kind-editor-emotion-reset.css",colorTable:a.colorTable,htmlTags:a.htmlTags,layout:a.layout,basePath:globals.basAppRoot+"plugins/kindeditor/",emoticonsPath:globals.basAppRoot+"plugins/kindeditor/plugins/emoticons/images/",isEmotion:!0},d),d.afterCreate=function(){l=this,l.toolbar.div.css("display","none"),l.statusbar.css("display","none"),f(),$(l.statusbar[0]).find(".emoticons").length||(l.statusbar.append('<span class="ke-inline-block emoticons"></span>'),l.statusbar.append('<span class="ke-inline-block counter"></span>'),$(".emoticons").on("click",function(){l.clickToolbar("emoticons")}))},d.filterEmotionNodes=function(e){var t="li|table|tr|blockquote|center|div|h1|h2|h3|h4|h5|h6|p",a=new RegExp("<("+t+"){1}[s+[^/]{0,}/>|/>]|</("+t+"){1}s*>","ig"),n=/<(?!a|\/a|img|\/img|br).*?>/gi,r=/alt=\"[^\"]+\"|style=\"[^\"]+\"|target=\"[^\"]+\"|data-ke-src=\"[^\"]+\"|class=\"[^\"]+\"/gi;return e.replace(a,"<br/>").replace(n,"").replace(r,"").replace(/\n/,"<br/>")},d.afterChange=function(){if(t.options.maximumWords&&l.count){var e=l.html();e=e.replace(/<img[^>]+[^>]*>/gi,"0");var a=window.deletHtmlTag(e||"").replace(/\s{2}/g,"").replace(/&nbsp;/g,"x").length;t.maxLengthError=t.options.maximumWords<a,i.$setValidity("nswmaxlength",!t.maxLengthError),t.wordCount=a+"/"+t.options.maximumWords,l.statusbar&&l.statusbar[0]&&$(l.statusbar[0]).find(".counter").html(t.wordCount)}else t.wordCount="";return g(),t.$root.$$phase||t.$apply(),this};var p=function(){var e=_.find(t.emotions,{img:$(this).data("code")});l.insertHtml('<img src="'+n.getImagePath(e.img)+'" border="0" alt="'+e.desc+'" data-mo="'+e.code+'" />').focus()},m=function(){$(".icon-emotions",r).popover({html:!0,placement:"right",content:$(".emotions",r)}).on("shown.bs.popover",function(){}),$(".icon-emotions",r).on("click",function(e){r.find(".popover").popover("show"),$(".emotion-item").on("click",p),e.stopPropagation()}),$("body").on("click",function(){r.find(".popover").popover("hide"),$(".emotion-item").off("click",p)})};t.$evalAsync(function(){KindEditor.create(u,d),r.find(".word-count").width(d.width),r.find(".ke-container").width(d.width),f(),$(".ke-edit-textarea",r).on("keyup",function(){g()}),m()});var f=function(){l&&l.isCreated&&(l.container.css("width","100%"),s=i.$viewValue,l.html(n.codeToImg(i.$viewValue||"")))},g=function(){if(l&&l.html){var e=l.html()||"",t=n.imgToCode(e||"");t!==(i.$viewValue||"")&&i.$setViewValue(t);
}};i.$render=function(){f()}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformKindeditor",["platformKindEditorDataSvc",function(t){return{restrict:"A",scope:{turnDesign:"="},require:"ngModel",template:'<div class="kind-editor">                <textarea style="visibility:hidden;"></textarea>               <div class="word-count" >                   <span class="err" data-ng-show="maxLengthError" style="text-align: left">录入字数不能超过<span data-ng-bind="options.maximumWords"></span>个字符</span>                    <span data-ng-bind="wordCount" style="min-width: 200px;float: right; text-align: right"></span>               </div>           </div>',link:function(a,n,r,o){var i,s={},l=n.find("textarea"),c=KindEditor.toMap("8,9,13,32,46,48..57,59,61,65..90,106,109..111,188,190..192,219..222"),u=KindEditor.toMap("33..40"),d={},p=navigator.userAgent.toLowerCase();p.indexOf("gecko")>-1&&p.indexOf("khtml")===-1;KindEditor.each(c,function(e,t){d[e]=t}),KindEditor.each(u,function(e,t){d[e]=t}),a.options=a.$parent.$eval(r.options)||{simpleMode:"false"!==r.isSimple},a.options.maximumWords=a.options.maximumWords||parseInt(r.kMaximumWords),a.name="keditor-"+t.getUUID();var m='textarea[name="'+a.name+'"]';l.attr("name",a.name);var f=e.copy(a.options);f.items=t.wcItems,f.width=r.width||"100%",f.height=r.height||"100%",r.width&&(n.width(r.width),f.width=r.width),r.height&&(n.height(r.height),f.height=r.height),f=_.extend({},{resizeType:1,allowPreviewEmoticons:!1,allowImageUpload:!1,cssPath:globals.basAppRoute+"components/content/css/kindeditor/kind-editor-reset.css",colorTable:t.colorTable,htmlTags:t.htmlTags,layout:t.layout,basePath:globals.basAppRoot+"plugins/kindeditor/",emoticonsPath:globals.basAppRoot+"plugins/kindeditor/plugins/emoticons/images/",SimpleMode:!1},f),f.afterCreate=function(){s=this,g(),$(s.statusbar[0]).find(".emoticons").length||(s.statusbar.append('<span class="ke-inline-block emoticons"></span>'),s.statusbar.append('<span class="ke-inline-block counter"></span>'),$(".emoticons").on("click",function(){s.clickToolbar("emoticons")}))},f.afterChange=function(){if(a.options.maximumWords&&s.count){var e=window.deletHtmlTag(s.html()||"").replace(/\s{2}/g,"").replace(/&nbsp;/g,"x").length;a.maxLengthError=a.options.maximumWords<e,o.$setValidity("nswmaxlength",!a.maxLengthError),a.wordCount="("+e+"/"+a.options.maximumWords+")",s.statusbar&&s.statusbar[0]&&$(s.statusbar[0]).find(".counter").html(a.wordCount)}else a.wordCount="";return h(),a.$root.$$phase||a.$apply(),this},a.$evalAsync(function(){KindEditor.create(m,f),n.find(".word-count").width(f.width),n.find(".ke-container").width(f.width),g(),$(".ke-edit-textarea",n).on("keyup",function(){h()})});var g=function(){s&&s.isCreated&&(s.container.css("width","100%"),i=o.$viewValue,s.html(o.$viewValue||""))},h=function(){if(s&&s.html){var e=s.html()||"",t=o.$viewValue||"";e!==t&&o.$setViewValue(e)}};o.$render=function(){g()}}}}])}(angular),function(e){"use strict";e.module("platform").factory("platformArticleMaterialDataSvc",["materialsDataSvc","$state","$timeout","platformMenuDataSvc",function(e,t,a,n){var r={},o=function(){var n,r,o=this;o.createArticle=function(a,r){n=t.current.name,e.setCreateType(a,!0,r),e.createNew(),e.checkAuthed("phoneProj")?t.go("wechat.materials.apply"):t.go("wechat.materials.add")};var i=function(e){if(n){var o=n;r=e,a(function(){t.go(o)}),n=null}};o.getCreated=function(){var e=r;return r=null,e},e.registerItemCreated(i),o.clear=function(){if(!n)return e.unregisterItemCreated(i),!0}},i=function(e){if(r[e])return r[e];var t=new o;return r[e]=t,t},s=function(e){r[e]&&r[e].clear()&&delete r[e]};return{create:i,clear:s}}])}(angular),function(e){"use strict";e.module("platform").directive("platformArticleMaterialSelector",["$http","nswGlobals","platformModalSvc","platformArticleMaterialDataSvc",function(e,t,a,n){return{restrict:"A",require:"ngModel",scope:{remove:"&",afterSelect:"&",key:"@",srcModuleName:"@"},templateUrl:globals.basAppRoute+"components/templates/materials/platform-article-material-selector-dir.html",link:function(r,o,i,s){var l;r.key||console.error("key is required : platformArticleMaterialSelector"),r.imageUrl=globals.imageUrl.replace(/@appId/,t.getValue("appId")),r.afterImageSelected=function(e){r.material=e,r.materialId=e.id,s.$setViewValue(r.materialId),r.afterSelect({material:e})},r.switchToArticle=function(){r.createState=!0},r.createArticle=function(e){l.createArticle(e,r.srcModuleName)},r.showArtcileLib=function(){a.showModal({controller:"articleLibCtrl",templateUrl:globals.basAppRoute+"materials/templates/articles-lib.html",size:"lg",options:{selected:{id:r.materialId},srcModuleName:r.srcModuleName}}).then(function(e){r.afterImageSelected(e)})},r.doRemove=function(){r.material={},r.materialId="",s.$setViewValue(r.materialId),r.remove()};var c=function(t){var a=globals.basAppRoot+"material/materialInfo";e({method:"get",url:a,params:{type:"news",id:t}}).then(function(e){e.data.isSuccess?(r.material=e.data.data,r.loadImageFaild=!1):r.loadImageFaild=!0})};if(s.$render=function(){var e=s.$viewValue;e&&e!==r.materialId?c(e):r.material={},r.materialId=e},r.key){l=n.create(r.key);var u=l.getCreated();u&&r.afterImageSelected(u)}r.$on("$destroy",function(){n.clear(r.key)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformImgMaterialSelector",["$http","nswGlobals",function(e,t){return{restrict:"A",require:"ngModel",scope:{remove:"&",afterSelect:"&"},templateUrl:globals.basAppRoute+"components/templates/materials/platform-img-material-selector-dir.html",link:function(e,a,n,r){e.imageUrl=globals.imageUrl.replace(/@appId/,t.getValue("appId")),e.afterImageSelected=function(t){e.materialId=t.fileId,r.$setViewValue(e.materialId),e.afterSelect({material:t})},e.doRemove=function(){e.material={},e.materialId="",r.$setViewValue(e.materialId),e.remove()},e.imageUploaded=function(t){e.afterImageSelected(t)},r.$render=function(){e.materialId=r.$viewValue}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformPreview",["$modal","$parse","$http","platformPreviewSvc",function(e,t,a,n){return{restrict:"A",require:"?ngModel",scope:{information:"=",infoType:"="},link:function(e,t){t.bind("click",function(t){var a;e.information.articles&&1===e.information.articles.length?(e.information.articles[0].digest=window.deletHtmlTag(e.information.articles[0].content.replace(/&nbsp;/gi," ")).slice(0,54),a=e.information):a=e.information;var r=e.infoType||"";t.stopPropagation(),n.showPreveivModal(a,r)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformPreviewSend",["$modal","$parse","$http","platformPreviewSvc",function(e,t,a,n){return{restrict:"A",require:"?ngModel",scope:{information:"="},link:function(e,t){t.bind("click",function(t){var a=e.information;t.stopPropagation(),n.showPreveivSendModal(a)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformMenu",["platformMenuDataSvc",function(e){return{restrict:"A",scope:!0,template:'<div class="c-menu-div">                <div class="c-menu-title" data-ng-bind="menus.title"></div>               <div class="c-menu-box">\t\t\t\t    <div data-ng-repeat="group in menus.groups" ng-show="!group.hide"  data-platform-menu-group data-ng-model="group"/></div>               </div>           </div>',link:function(t){var a=function(e){t.menus=e};t.setSelectedGroup=function(e){t.selectedGroup=e,t.$broadcast("currentGroupChanged")},t.setSelectedMenu=function(e,a){t.selectedMenu=e,a&&(t.selectedGroup=a),t.$broadcast("currentGroupChanged")};var n=function(e,a){t.selectedGroup=a,t.selectedMenu=e,t.$broadcast("currentGroupChanged")};e.registerMenuSelected(n),e.registerMenuLoaded(a),t.$on("$destroy",function(){e.unregisterMenuLoaded(a)}),t.$evalAsync(function(){n(e.getCurrentMenu(),e.getCurrentMenuGroup())})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformMenuGroup",["platformMenuDataSvc","$timeout",function(e,t){return{restrict:"A",scope:!0,require:"ngModel",template:'<div>               <div class="c-menu c-mkname"  data-ng-class="getGroupClass()" data-ng-click="selectMenu(group)"><span data-ng-class="selectMenuIcon()"></span><div data-ng-bind="group.name"/></div>               <div class="c-menu-list">                   <div data-ng-repeat="menu in group.menus" data-ng-class="getMenuClass(menu)" class="c-menu-item" data-ng-click="selectMenu(menu)" data-ng-bind="menu.name"></div>               </div>           </div>',link:function(t,a,n,r){var o;r.$render=function(){t.group=r.$viewValue,t.group.selected?t.selectMenu(t.group):_.forEach(t.group.menus,function(e){e.selected&&t.selectMenu(e)})},t.navigate=function(t){e.fireMenuSelected(t)},t.selectMenuIcon=function(){var e=t.group.icon||"glyphicon glyphicon-tag";return(t.selectedMenu===t.group&&t.selectedGroup===t.group||t.selectedGroup===t.group&&t.group.menus)&&(e+=" active"),e},t.selectMenu=function(a){o=a,a.state?e.fireMenuSelected(a):a.menus&&(t.setSelectedGroup(a),t.$root.$broadcast("currentGroupChanged"))},t.getGroupClass=function(){var e="";return t.selectedGroup!==t.group||!t.group||t.group.menus&&t.group.menus.length?t.selectedGroup===t.group&&t.group&&(e="expend"):e+="selected",e},t.getMenuClass=function(e){return!e||t.selectedMenu!==e||e.menus&&e.menus.length?"":"selected"};var i=function(){var e=a.find(".c-menu");t.selectedGroup&&t.selectedGroup===t.group&&o===t.group?e.hasClass("expend")?e.next().slideUp(500,function(){e.removeClass("expend")}):t.group.menus&&t.group.menus.length&&e.next().stop(!0).slideDown(500,function(){e.addClass("expend")}):t.selectedGroup!==t.group&&e.hasClass("expend")&&e.next().stop(!0).slideUp(500,function(){e.removeClass("expend")})};t.$on("currentGroupChanged",i)}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformImgText",[function(){return{restrict:"A",templateUrl:globals.basAppRoute+"components/templates/modals/platform-img-text.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("platformOnlyImg",[function(){return{restrict:"A",templateUrl:globals.basAppRoute+"components/templates/modals/platform-olny-img.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("getKeyWord",[function(){return{restrict:"A",scope:{keyWord:"="},require:"ngModel",link:function(e,t,a,n){n.$render=function(){var a=n.$viewValue.toString();if(e.keyWord){var r=new RegExp(e.keyWord,"ig");a=a.replace(r,"<font color='red'>"+e.keyWord+"</font>")}t.html(a)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("signKeyWord",[function(){return{restrict:"A",scope:{keyWord:"="},require:"ngModel",link:function(e,t,a,n){n.$render=function(){var a=n.$viewValue.toString();if(e.keyWord){var r=new RegExp(e.keyWord,"ig");a=a.replace(r,"<font color='red'>"+e.keyWord+"</font>")}t.html(a)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMaxLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,a,n){if(n){var r=function(e){e=e||"";for(var t=parseInt(a.nswMaxLength)||0,r=0,o=0;o<e.length;o++){var i=e.charCodeAt(o);i>=1&&i<=126||65376<=i&&i<=65439?r++:r+=2}return 0===t||r<=t?(n.$setValidity("nswmaxlength",!0),e):(n.$setValidity("nswmaxlength",!1),e)};n.$formatters.push(r),n.$parsers.unshift(r),a.$observe("nswMaxLength",function(){r(n.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("maxWord",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,a,n){if(n){var r=/[、]+|[\|\|]+|[\$]+|[\\]+|[\s]+|[,，]+|[;；]+|[|｜]+/,o=/[、]+|[\|\|]+|[\$]+|[\\]+|[\s]+|[,，]+|[;；]+|[|｜]+/g,i=function(e){var t=parseInt(a.maxWord)||0,o=(e||"").split(r).length;return 0===t||o<=t?(n.$setValidity("maxword",!0),e):(n.$setValidity("maxword",!1),e)};n.$formatters.push(i),n.$parsers.unshift(i),n.$viewChangeListeners.push(function(){var e=n.$viewValue;e&&(e=e.replace(o,","),n.$setViewValue(e))}),a.$observe("maxword",function(){i(n.$viewValue)})}}}}]).directive("nswMaxLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,a,n){if(n){var r=function(e){e=e||"";for(var t=parseInt(a.nswMaxLength)||0,r=0,o=0;o<e.length;o++){var i=e.charCodeAt(o);i>=1&&i<=126||65376<=i&&i<=65439?r++:r+=2}return 0===t||r<=t?(n.$setValidity("nswmaxlength",!0),e):(n.$setValidity("nswmaxlength",!1),e)};n.$formatters.push(r),n.$parsers.unshift(r),a.$observe("nswmaxlength",function(){r(n.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswMinLength",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,a,n){if(n){var r=0,o=function(e){var t=parseInt(a.nswMinLength)||0,o=0;e=e||"";for(var i=0;i<e.length;i++){var s=e.charCodeAt(i);s>=1&&s<=126||65376<=s&&s<=65439?o++:o+=2}return r=o,0===r||o>=t?(n.$setValidity("nswminlength",!0),e):void n.$setValidity("nswminlength",!1)};n.$formatters.push(o),n.$parsers.unshift(o),a.$observe("nswminlength",function(){o(n.$viewValue)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("modelCompare",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,a,n){if(n){var r=function(t){var r=a.modelCompare,o=e.$eval(r);return t!==o&&o?(n.$setValidity("modelcompare",!1),t):(n.$setValidity("modelcompare",!0),t)};n.$formatters.push(r),n.$parsers.unshift(r);var o=e.$watch(a.modelCompare,function(){r(n.$viewValue)});a.$observe("modelCompare",function(){r(n.$viewValue)}),e.$on("$destroy",function(){o()})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswUserValidator",[function(){return{restrict:"A",require:"?ngModel",link:function(e,t,a,n){if(n){var r=function(t){var r=e.$eval(a.nswUserValidator).call(this,t),o=a.validatorName;return r?(n.$setValidity(o,!0),t):(n.$setValidity(o,!1),t)};n.$formatters.push(r),n.$parsers.unshift(r)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswBindHtml",[function(){return{restrict:"A",scope:{template:"@"},replace:!0,link:function(e,t,a){a.$observe("nswBindHtml",function(){t.html(a.nswBindHtml)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswEnter",["$parse","$rootScope",function(e,t){return{restrict:"A",compile:function(a,n){var r=e(n.nswEnter,!0);return function(e,a){a.keydown(function(a){if(13===a.keyCode){var n=function(){r(e,{$event:a}),a.stopPropagation()};t.$$phase?e.$evalAsync(n):e.$apply(n)}})}}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformBreadNav",["$state","platformMenuDataSvc",function(e,t){return{restrict:"A",scope:{breadNavs:"=platformBreadNav"},templateUrl:globals.basAppRoute+"components/templates/platform-bread-nav-dir.html",link:function(e){e._breadNavs=e.breadNavs||[];var a=e._breadNavs.length-1;e._breadNavs[a]&&(e._breadNavs[a].href="#"),e.navigateTo=function(e){t.fireMenuSelected(e)},e.$watch("breadNavs",function(){e._breadNavs=e.breadNavs||[];var t=e._breadNavs.length-1;e._breadNavs[t]&&(e._breadNavs[t].href="#")})}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformCatalogList",["platformModalSvc",function(e){return{restrict:"A",scope:{options:"="},templateUrl:globals.basAppRoute+"components/templates/platform-catalog-list-dir.html",link:function(t){t.options.enableCreate=_.isBoolean(t.options.enableCreate)?t.options.enableCreate:!!t.options.onCreated,t.options.enableSpeedEdit=_.isBoolean(t.options.enableSpeedEdit)?t.options.enableSpeedEdit:!!t.options.onSpeedEdit,t.options.enableLineEdit=_.isBoolean(t.options.enableLineEdit)?t.options.enableLineEdit:!!t.options.onLineEdited,t.options.enableSort=_.isBoolean(t.options.enableSort)?t.options.enableSort:!!t.options.onSorted,t.options.enableDelete=_.isBoolean(t.options.enableDelete)?t.options.enableDelete:!!t.options.onDeleted,t.displayList=[],t.options.setData=function(e){_.isArray(e)&&(t.displayList=_.sortBy(e,t.options.data.sortBy),t.options.data.selectedItem&&t.options.data.selectedItem.id?t.updateSelection(_.find(t.displayList,{id:t.options.data.selectedItem.id})):t.options.data.selectedItem&&t.options.data.selectedItem._id?t.updateSelection(_.find(t.displayList,{_id:t.options.data.selectedItem._id})):t.updateSelection(t.displayList[0]))},t.updateSelection=function(a){return t.lineEditing&&a!==t.options.data.selectedItem?void e.showWarmingTip("请先保存修改！"):(t.options.data.selectedItem=a,void t.options.onSelectedChanged.apply(this,arguments))},t.toggleLineEdit=function(e){return t.options.enableSpeedEdit?void t.options.onSpeedEdit.call(this,e):void(e===t.options.data.selectedItem&&(t.lineEditing=!t.lineEditing,t.lineEditing?t.options.data.selectedItem=e:t.options.onLineEdited.call(this,e)))},t.doSaveCreate=function(e){t.options.formOptions.$invalid||(t.options.onCreated(e),t.options.formOptions.setData({}))},t.options.setData(t.options.data.dataList);var a=t.$watch("options.data.dataList",function(e){t.options.setData(e)});t.options.formOptions&&(t.options.formOptions.data=t.options.formOptions.data||{}),t.$on("$destroy",function(){a()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformDynamicForm",["$http","$compile","$sce",function(t,a,n){return{restrict:"A",replace:!0,link:function(n,r,o){function i(e){var t=a(e)(n);r.html(t)}if(e.isDefined(o.template)){var s=n.$eval(o.template);s?i(s):n.$watch(o.template,function(e){i(e)})}else if(e.isDefined(o.templateUrl)){var l=n.$eval(o.template);t.get(l).then(function(e){i(e.data)})}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformGetHeight",[function(){return{restrict:"A",link:function(e,t,a){var n=e.$watch("dataList",function(){setTimeout(function(){var e=$("."+a.standard).outerHeight();e-=t.siblings().outerHeight(),t.height(e)},200)});e.$on("$destroy",function(){n()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformInput",[function(){return{restrict:"A",require:"?ngModel",template:'<input type="{{type}}" class="form-control nsw-form-input col-lg-8" data-ng-change="changed()" ng-model="model" autocomplete="off" ><span data-ng-hide="hideCounter" data-ng-bind="countTip"></span>',link:function(e,t,a,n){e.type=a.type,e.hideCounter=!a.ngMaxlength,n.$render=function(){e.model=n.$viewValue,r()},e.changed=function(){n.$setViewValue(e.model),r()};var r=function(){var t=e.model?e.model.length:0;e.countTip=t+"/"+a.ngMaxlength+"字符"}}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformModalTransclude",[function(){return{restrict:"A",templateUrl:globals.basAppRoute+"components/templates/platform-modal-dir.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("nswNavHint",["platformNavigationSvc","platformModalSvc",function(e,t){return{restrict:"A",scope:{dirtyChecker:"="},link:function(a,n){var r=function(e){if(!e.stop){var r=!!n.find(".ng-dirty").not(".hasDatepicker,.not-check-dirty").length;_.isFunction(a.dirtyChecker)&&(r=a.dirtyChecker.call(a,r)),r?e.confirm=t.showConfirmMessage("当前页面没有保存是否确认离开？","温馨提示").then(function(){return e.stop=!1,a.$emit("formDirtyInfo",e),!0},function(){return e.stop=!0,a.$emit("formDirtyInfo",e),!1}):a.$emit("formDirtyInfo",{dirty:!1})}};a.$on("checkFormDirty",function(){var e={};r(e)}),e.registerRouteWillUpdated(r),a.$on("$destroy",function(){e.unregisterRouteWillUpdated(r)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswAutofocus",["$timeout",function(e){return{restrict:"A",link:function(t,a){e(function(){a[0].focus()},100)}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswBg",[function(){return{restrict:"A",link:function(e,t,a){var n=function(){var e=/^(http|https|ftp)?:\/\//,n=/^[..\\]{1}/,r=/^data:image\//,o=/^~\//,i=/^(http|https|ftp)?:\/\/mmbiz/,s=a.nswBg,l=!1;s||(s=globals.defaultImg,l=!0);var c=!1;if(s&&o.test(s))s=s.replace(o,globals.basAppRoot),l=!1;else if(s&&i.test(s))s=s.split("?")[0],l=!1;else if(s&&!e.test(s)&&!n.test(s)&&!r.test(s)){var u=globals.basImagePath;a.nswSrcPath&&(u=globals[a.nswSrcPath]),s=u+s,c=!0,l=!1}if(s){if(a.nswSrcSize&&c){var d=_.lastIndexOf(s,".");s=s.slice(0,d)+"_"+a.nswSrcSize+s.slice(d,s.length)}l?t.css({backgroundImage:'url("'+s+'")',backgroundSize:"100% 100%",backgroundPosition:"0 0 "}):t.css({backgroundImage:'url("'+s+'")',backgroundSize:"cover"})}};a.$observe("nswBg",function(){n()}),e.$evalAsync(function(){n()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswClipboard",["platformModalSvc",function(e){return{restrict:"A",link:function(t,a,n){a.on("click",function(){if("disabled"!==n.disable){var a=$("<textarea/>");a.text(n.nswClipboard),$("body").append(a),a.select();var r=!0;try{r=document.execCommand("copy")}catch(o){r=!1}a.remove(),r?e.showSuccessTip("拷贝到剪切板成功!"):e.showModal({size:"sm",templateUrl:globals.basAppRoute+"components/templates/platform-clipboard-error-dialog.html",options:{content:n.nswClipboard}}),n.onCopy&&t.$eval(n.onCopy,{$event:{data:n.nswClipboard}})}})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswComboBox",["$compile",function(){return{restrict:"A",require:"ngModel",scope:{nswChildren:"@",nswData:"=",nswDisplay:"@",nswKey:"@"},priority:1e3,templateUrl:globals.basAppRoute+"components/templates/platform-nsw-combo-box-dir.html",link:function(e,t,a,n){var r="　　　　　　　　　　　　　　　　　　",o=function i(t,a,n){return t=_.isArray(t)?t:[t||{}],n=n||0,a=a||[],_.forEach(t,function(t){var o={};o.key=t[e.nswKey],o.display=t[e.nswDisplay],o.spaces=new Array(n),o._source=t,a.push(o),t[e.nswChildren]?(o.display=r.slice(0,n)+"└　"+o.display,i(t[e.nswChildren],a,n+1)):o.display=r.slice(0,n)+"├"+o.display}),a};e.onChange=function(){var r=e.collection[$("select",t)[0].selectedIndex];r&&(n.$setViewValue(r._source),t.parent().controller("form").$setDirty()),a.ngChange&&e.$parent.$eval(a.ngChange),e.collection=o(e.nswData),n.$dirty=!0},n.$render=function(){e.model=n.$viewValue;var t={};e.model&&e.model[e.nswKey]?(t.key=e.model[e.nswKey],e.model=_.find(e.collection,t),e.collection=o(e.nswData)):e.model=null},e.isSelected=function(t){return!(!e.model||!t)&&e.model.key===t.key},e.collection=o(e.nswData),n.$render(),e.$watch("nswData",function(t){e.collection=o(t),n.$render()}),e.$evalAsync(function(){t.find("select").on("change",e.onChange)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswCommit",[function(){return{restrict:"A",link:function(e,t,a){var n=a.nswCommit||(t.closest("form")?t.closest("form").attr("name"):"");n&&e[n]&&t.bind("click",function(){e[n].$setPristine()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswDraggable",[function(){return{restrict:"A",scope:{drag:"&",drop:"&",options:"&"},link:function(e,t){e.onDrag=function(t){e.select({source:t})},e.onDrop=function(t,a){e.select({source:t,target:a})},e.$evalAsync(function(){t.draggable(e.options)})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswFileuploader",["$http","platformModalSvc","platformMessenger",function(t,a,n){return{restrict:"A",transclude:!0,scope:{config:"=",uploader:"="},template:'<div>             <div id="uploader" style="position: relative;left: 44%" ng-hide="uploading" data-ng-transclude/>             <div style="position:relative;z-index:12;pointer:cursor;" ng-show="uploading" nsw-progress-bar data-cancel="cancel" data-ng-model="status" data-hint="hint" data-show-hint-in="6" data-show-percentage-in="6">               <button class="btn btn-default btn-color btn-cancel progress-publish-btn" type="button" ng-click="cancel()">                   <label class="checkcancel"></label>                   <span class="btntext black">取&nbsp;消</span>               </button>             </div>              <div ng-if="uploading" class="progress-mask" style="background:#000 filter:alpha(opacity = 0.01) opacity:1;position:fixed;left:0;top:0;width:100%;height:100%;z-index:2;"></div>          </div>',link:function(n,r){var o,i=(new Date).getTime(),s=$("#uploader").html(),l=n.config?n.config:{},c={auto:!0,server:"/pccms/file/upload?taskId="+i,swf:"/pccms/plugin/ueditor/third-party/webuploader/Uploader.swf",formData:{},fileVal:"file",extensions:"zip",mimeTypes:"application/x-zip-compressed",multiple:!1,duplicate:!0,beforeFileQueued:null,fileQueued:null,uploadStart:null,uploadProgress:null,uploadSuccess:null,uploadError:null,uploadComplete:null,uploadFinished:null,error:null};e.extend(c,l);var u=function(e){t({method:"POST",url:"/pccms/progress/file?taskId="+i,data:{taskId:i}}).success(function(t){if(t.isSuccess){t=JSON.parse(t.message);var r=void 0===t.percent?0:t.percent;switch(n.hint=void 0===t.hint?"上传并解压中...":t.hint,n.status=r,parseInt(t.index)){case 0:case 3:n.status=r,n.uploading=!0;break;case 1:case 2:n.status="100",n.unziping=!1,n.uploading=!1,a.showWarmingMessage(n.hint,"温馨提示").then(function(){n.status="0"}),y(),clearInterval(e);break;case 4:case 5:n.hint="上传并解压中...",n.unziping=!0;break;default:n.status="100",n.uploading=!1,n.hint="上传并解压监控失败:"+n.hint,a.showWarmingMessage(n.hint,"温馨提示").then(function(){n.status="0"}),y(),clearInterval(e),console.error(t)}n.status=parseInt(n.status),100===n.status&&(n.hint="上传并解压中...",n.unziping=!0)}else a.showWarmingMessage("上传并解压监控失败："+t.message,"温馨提示")}).error(function(e){console.error(e),setTimeout(function(){a.showWarmingMessage("网络故障请重新上传！","温馨提示").then(function(){n.status="0"}),n.uploading=!1,y()},3e3)})};n.cancel=function(){a.showConfirmMessage("确认取消上传？","温馨提示").then(function(){n.status="0",clearInterval(o),n.unziping=!1,n.uploading=!1,y()})};var d,p=function(e){return"zip"!==e.ext.toLowerCase()?(a.showWarmingMessage("文件的类型不正确，请选择zip格式文件！","温馨提示"),!1):"function"==typeof c.beforeFileQueued?c.beforeFileQueued.apply(this,[d,e]):void 0},m=function(e){"function"==typeof c.fileQueued&&c.fileQueued.apply(this,[d,e])},f=function(e){"function"==typeof c.uploadStart&&c.uploadStart.apply(this,[d,e]),n.uploading=!0,o=setInterval(function(){u(o)},1e3)},g=function(e,t){"function"==typeof c.uploadSuccess&&c.uploadSuccess.apply(this,[d,e,t])},h=function(e){"function"==typeof c.uploadError&&c.uploadError.apply(this,[d,e])},v=function(e){"function"==typeof c.uploadComplete&&c.uploadComplete.apply(this,[d,e])},b=function(e){"function"==typeof c.uploadFinished&&c.uploadFinished.apply(this,[d,e])},w=function(e){"function"==typeof c.error&&c.error.apply(this,[d,e])},y=function(){d&&(d.stop(),d.reset(),$("#uploader",r).children().remove(),$("#uploader").html(s)),i=(new Date).getTime(),c.server="/pccms/file/upload?taskId="+i,n.hint="",d=WebUploader.create({auto:c.auto,swf:c.swf,server:c.server,pick:{id:"#uploader",label:c.label,multiple:c.multiple},fileVal:c.fileVal,accept:{title:"zip",extensions:c.extensions,mimeTypes:c.mimeTypes},duplicate:c.duplicate,button:r,formData:c.formData}),d.on("beforeFileQueued",p),d.on("fileQueued",m),d.on("uploadStart",f),d.on("uploadSuccess",g),d.on("uploadError",h),d.on("uploadComplete",v),d.on("uploadFinished",b),d.on("error",w)};y(),"function"==typeof n.uploader&&n.uploader(d),l.stopUploader=function(){o&&clearInterval(o),y()}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswGroupSelector",[function(){return{restrict:"A",scope:{onSelectAll:"&",onReverseSelect:"&",listGetter:"=",selectedItemsGetter:"="},templateUrl:globals.basAppRoute+"components/templates/platform-nsw-group-selector.html",link:function(e,t,a){e.selectAll=function(t){var a=e.selectedItemsGetter.call(this),n=e.listGetter.call(this);e.allSelected=t,a.length=0,t&&_.forEach(n,function(e){a.push(e)}),e.onSelectAll({selectedItems:e.selectedItems})},e.reverseSelect=function(){var t=e.selectedItemsGetter.call(this),a=e.listGetter.call(this);_.forEach(a,function(e){_.find(t,e)?_.remove(t,e):t.push(e)}),e.onReverseSelect({selectedItems:e.selectedItems})};var n=e.$watchCollection(e.selectedItemsGetter,function(){var t=e.selectedItemsGetter.call(this),a=e.listGetter.call(this);e.allSelected=a.length===t.length}),r=e.$watchCollection(e.listGetter,function(){var t=e.selectedItemsGetter.call(this),a=e.listGetter.call(this);e.allSelected=a.length&&a.length===t.length});e.$on("$destroy",function(){n(),r()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswHref",[function(){return{restrict:"A",link:function(e,t,a){var n=function(){var e=/^(http|https|ftp)?:\/\//,n=/^[..\\]{1}/,r=/^data:image\//,o=/^~\//,i=/^(http|https|ftp)?:\/\/mmbiz/,s=a.nswHref;!s&&t[0]&&_.isString(t[0].tagName)&&"img"===t[0].tagName.toLowerCase()&&(s=globals.defaultImg);var l=!1;if(s&&o.test(s))s=s.replace(o,globals.basAppRoot);else if(s&&i.test(s))s=s.split("?")[0];else if(s&&!e.test(s)&&!n.test(s)&&!r.test(s)){var c=globals.basImagePath;a.nswSrcPath&&(c=globals[a.nswSrcPath]),s=c+s,l=!0}if(s){if(a.nswSrcSize&&l){var u=_.lastIndexOf(s,".");".gif"!==s.slice(u,s.length)&&(s=s.slice(0,u)+"_"+a.nswSrcSize+s.slice(u,s.length))}t.attr("href",s)}};a.$observe("nswHref",function(){n()}),e.$evalAsync(function(){n()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswHtml",["$http","$compile","$sce",function(e,t,a){return{restrict:"A",replace:!0,link:function(e,t,a){var n=function(){t.html(a.nswHtml)};a.$observe("nswHtml",function(){n()}),e.$evalAsync(function(){n()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswLazyscroll",[function(){return{restrict:"A",link:function(e,t,a){var n=parseInt(a.step)||1,r=parseInt(a.currentStep)||0,o=function(){var o=t.scrollTop(),i=parseInt(o/n)+(o%n>0?1:0);i!==r&&a.nswStepChange&&(e.$eval(a.nswStepChange).call(this,{target:t,step:n,current:i}),r=i,e.$digest())};a.$observe("count",function(e){$(t.find(".step-target")).height(n*e)}),t.scroll(o)}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformNswListMaterial",[function(){return{restrict:"A",scope:{material:"=",remove:"&",edit:"&"},templateUrl:globals.basAppRoute+"components/templates/platform-nsw-list-material-dir.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("platformNswMaterial",[function(){return{restrict:"A",scope:{material:"=",remove:"&",edit:"&"},templateUrl:globals.basAppRoute+"components/templates/platform-nsw-material-dir.html"}}])}(angular),function(e){"use strict";e.module("platform").directive("nswProgressBar",[function(){return{restrict:"A",require:"ngModel",transclude:!0,scope:{showPercentageIn:"@",showHintIn:"@",hint:"=",cancel:"="},template:'<div class="index-progress">               <div class="progress" >                   <div class="progress-bar progress-bar-success"  role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"  ng-style="style">                      <div class="progress-content">                          <span ng-bind="hint"></span>                          <span ng-bind="progress"></span>                       </div>                   </div>                </div>               <div id="transclude" data-ng-transclude />           </div>',link:function(e,t,a,n){n.$render=function(){e.progress=n.$viewValue+"%";var t=parseInt(e.showHintIn||"6"),a=parseInt(e.showPercentageIn||"6");e.displayHint=n.$viewValue>=t&&n.$viewValue<=100,e.displayPercentage=n.$viewValue>=a&&n.$viewValue<=100,n.$viewValue>=100?$("#transclude").hide():$("#transclude").show(),$(".progress-bar.progress-bar-success").css("width",e.progress)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswSortable",[function(){return{restrict:"A",scope:{nswSortableEnable:"=",updated:"&",items:"=",child:"@"},link:function(e,t,a){var n;e.onUpdated=function(a,n){var r=[];_.forEach(t.children(),function(t){var a=$(t).scope();if(a){var n=a.$eval(e.child);_.find(e.items,n)&&(r.push(n),_.remove(e.items,n))}}),_.forEach(r,function(t){e.items[e.items.length]=t}),e.updated({source:e.items}),e.$digest()},e.onDrop=function(t,a){e.select({source:t,target:a})},e.$evalAsync(function(){e.options=e.options||{},e.options.items=">*",a.exclude&&(e.options.items+=":not("+a.exclude+")"),
e.options.update=e.onUpdated,e.options.disabled=!e.nswSortableEnable,n=t.sortable(e.options)}),e.$watch("nswSortableEnable",function(t){e.options=e.options||{},n&&n.sortable({disabled:!t})})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswSrc",[function(){return{restrict:"A",link:function(e,t,a){var n=function(){var e=/^(http|https|ftp)?:\/\//,n=/^[..\\]{1}/,r=/^data:image\//,o=/^~\//,i=/^(http|https|ftp)?:\/\/mmbiz/,s=a.nswSrc;!s&&t[0]&&_.isString(t[0].tagName)&&"img"===t[0].tagName.toLowerCase()&&(s=globals.defaultImg);var l=!1;if(s&&o.test(s))s=s.replace(o,globals.basAppRoot);else if(s&&i.test(s))s=s.split("?")[0];else if(s&&!e.test(s)&&!n.test(s)&&!r.test(s)){var c=globals.basImagePath;a.nswSrcPath&&(c=globals[a.nswSrcPath]),s=c+s,l=!0}s&&(a.nswSrcSize&&l&&(s=s+"?imageMogr2/thumbnail/"+a.nswSrcSize.replace(/\*/g,"x")),t.attr("src",s))};a.$observe("nswSrc",function(){n()}),e.$evalAsync(function(){n()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswStatusButton",[function(){return{restrict:"A",replace:!1,scope:!0,require:"ngModel",templateUrl:globals.basAppRoute+"components/templates/platform-nsw-status-button-dir.html",link:function(e,t,a,n){e.isChecked=!!n.$viewValue,n.$render=function(){e.isChecked=!!n.$viewValue},e.onClick=function(r){r.stopPropagation(),t.attr("disabled")||(e.isChecked=!e.isChecked,n.$setViewValue(e.isChecked),a.ngClick&&e.$parent.$eval(a.ngClick))}}}}])}(angular),function(e){"use strict";e.module("platform").directive("platformPagenation",[function(){return{restrict:"A",scope:{searchOptions:"=",nswRefresh:"&"},templateUrl:globals.basAppRoute+"components/templates/platform-pagenation-dir.html",link:function(e){e.pagesList=[],e.hasVal=!0,e.searchOptions.pageNum=e.searchOptions.pageNum||1;var t=e.$watch("searchOptions.totalRows",function(t){t?e.hasVal=!0:e.hasVal=!1}),a=e.$watch("searchOptions.totalPages",function(t){e.pagesList=[];for(var a=1;a<=t;a++)e.pagesList.push(a)});e.goNext=function(){e.searchOptions.pageNum<e.searchOptions.totalPages&&(e.searchOptions.pageNum++,e.nswRefresh({options:e.searchOptions}))},e.getPrevious=function(){e.searchOptions.pageNum>1&&(e.searchOptions.pageNum--,e.nswRefresh({options:e.searchOptions}))},e.goPage=function(){e.nswRefresh({options:e.searchOptions})},e.$on("$destroy",function(){a(),t()})}}}])}(angular),function(e){"use strict";e.module("platform").directive("nswPopover",function(){return{restrict:"A",link:function(e,t){t.parent().hover(function(){t.popover("show")},function(){t.popover("hide")})}}})}(angular),function(e){"use strict";e.module("platform").directive("nswPopovertip",["$compile",function(e){return{restrict:"A",scope:!0,transclude:!0,template:'<div data-toggle="popover" data-placement="{{dir}}">               <div class="hide container" data-ng-transclude></div>            </div>',link:function(t,a,n){var r=a.find(".container").html();t.dir=n.dir;var o=function(){a.find("[data-toggle='popover']").popover("show")},i=function(){a.find("[data-toggle='popover']").popover("hide")},s=function(){a.siblings().on("mouseover",o),a.siblings().on("mouseout",i)},l=function(){a.siblings().off("mouseover",o),a.siblings().off("mouseout",i)},c=function(){l();var n=e(r)(t);a.children().popover({html:!0,content:n}),s()},u="";t.$evalAsync(function(){c(),t.$watch(function(){var e=u!==a.html();return u=a.html(),e},function(){c()})})}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.directive("platformQrCode",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,a,n){n.$render=function(){if(n.$viewValue){var e=parseInt(a.width)||150,r=parseInt(a.height)||150;t.children().remove(),t.qrcode({text:n.$viewValue,width:e,height:r})}}}}}])}(angular),function(e){"use strict";var t=e.module("platform");t.factory("utils",["$rootScope","$location","$http","$modal",function(e,t,a,n){function r(e,t,a,r,o){n.open({template:'<div class="defa-font"><div class="modal-header"><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><p ng-bind-html="msg"></p></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()"><span class="glyphicon glyphicon-ok"></span> '+(o?o:"确定")+"</button></div></div>",controller:["$scope","$modalInstance",function(a,n){a.title=e,a.msg=t,a.ok=function(){n.close()}}],backdrop:"static",size:r?r:"sm"}).result.then(function(){void 0!==a&&a()})}function o(e,t,a,r,o){n.open({template:'<div class="defa-font"><div class="modal-header"><h3 class="modal-title">{{title}}</h3></div><div class="modal-body"><p>{{msg}}</p></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()"><span class="glyphicon glyphicon-ok"></span> 确定</button><button class="btn btn-default" ng-click="cancel()"><span class="glyphicon glyphicon-remove"></span> 取消</button></div></div>',controller:["$scope","$modalInstance",function(a,n){a.title=e,a.msg=t,a.ok=function(){n.close()},a.cancel=function(){n.dismiss()}}],backdrop:"static",size:o?o:"sm"}).result.then(function(){a()},function(){void 0!==r&&r()})}function i(e,t,a,r,o,i){var s=[];s[s.length]='<div class="modal-header">',s[s.length]='    <h3 class="modal-title">'+e+"</h3>",s[s.length]="</div>",s[s.length]='<div class="modal-body">'+t+"</div>",s[s.length]='<div class="modal-footer">',s[s.length]='    <button class="btn btn-primary" type="button" ng-click="ok()">'+(i?i:"确定")+"</button>",s[s.length]='    <button class="btn btn-default" type="button" ng-click="cancel()">取消</button>',s[s.length]="</div>",n.open({template:s.join(""),controller:["$scope","$modalInstance",function(n,o){n.title=e,n.msg=t,n.ok=function(){var e=!1;if(void 0===a)e=!0;else if("function"==typeof a){var t=a();(t||void 0===t)&&(e=!0)}e&&o.close()},n.cancel=function(){var e=!1;if(void 0===r)e=!0;else if("function"==typeof r){var t=r();(t||void 0===t)&&(e=!0)}e&&o.dismiss()}}],backdrop:"static",size:o?o:""})}function s(e){n.open({template:'<div class="c-dialog-img-preview"><i class="fa fa-times" ng-click="close();"></i><img src="'+e+'"/></div>',controller:["$scope","$modalInstance",function(e,t){e.close=function(){t.close()}}],backdrop:"static",size:""})}return{alertBox:r,confirmBox:o,openWin:i,imgPreview:s,helpBox:function(e,t){n.open({template:'<div class="defa-font"><div class="modal-body help"><img class="w-100" nsw-src="{{asset(image)}}" /></div><div class="modal-footer"><button class="btn btn-default" ng-click="close()"><span class="glyphicon glyphicon-remove"></span> 关闭</button></div></div>',controller:["$scope","$modalInstance",function(t,a){t.image=e,t.close=function(){a.close()}}],backdrop:"static",size:t?t:"md"})}}}]).directive("templateLib",["$modal","$parse","platformModalSvc",function(e,t,a){return{restrict:"A",link:function(e,t,n){t.click(function(){a.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"/components/templates/platform-template-view.html",controller:"templateLib",size:"lg"})})}}}]).controller("templateLib",["$scope","$http","utils",function(e,t,a){t({method:"GET",url:"/pccms/editorTpl/editorTplList?pageNum=1&pageSize=1000"}).success(function(t){e.templateLib=t.data.list}),e.imgPreview=function(e,t){a.imgPreview(e),t.stopPropagation()},e.selectImg=function(t){e.selected=t},e.commit=function(){e.closeModal(!0,{template:e.selected,replace:e.checked})},e.checked=!0}])}(angular),function(e){"use strict";e.module("platform").directive("platformUeditor",[function(){return{restrict:"A",require:"ngModel",scope:{simple:"@",maxWord:"@"},template:'<div ueditor ng-model="model" config="config" ng-change="change()"></div>',link:function(e,t,a,n){var r={initialFrameWidth:"100%",maximumWords:2e4,initialFrameHeight:450,themePath:globals.basAppRoot+"plugin/ueditor/themes/",langPath:globals.basAppRoot+"plugin/ueditor/lang/",serverUrl:"",UEDITOR_HOME_URL:globals.basAppRoot+"plugin/ueditor/"},o={maximumWords:150,initialFrameWidth:"90%",initialFrameHeight:100,themePath:globals.basAppRoot+"plugin/ueditor/themes/",langPath:globals.basAppRoot+"plugin/ueditor/lang/",serverUrl:"",UEDITOR_HOME_URL:globals.basAppRoot+"plugin/ueditor/",toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","|","forecolor","backcolor","|","fontfamily","fontsize","|","justifyleft","justifycenter","justifyright","justifyjustify","|","link"]]};setTimeout(function(){e.config=Boolean(e.simple)?o:r,e.config.maximumWords=Number(e.maxWord)}),e.change=function(){n.$setViewValue(e.model)},e.$render=function(){e.model=n.$viewValue}}}}])}(angular),function(e){"use strict";e.module("platform").directive("beyond",function(){return{restrict:"ACE",replace:!0,link:function(e,t){var a=$(t.find(".form-control[ng-model],.form-control[data-ng-model],.editor[ng-model],.editor[data-ng-model]")[0]),n=a.data("$ngModelController");if(n){var r=function(){var a=n.$viewValue;t.find(".mess-zx").html(a&&a.length?a.length:0),e.$root.$$phase||e.$apply()};e.$evalAsync(function(){var e=n.$render;n.$render=function(){e.apply(this,arguments),r()},r()}),a.on("keyup",function(){r()}),n.$viewChangeListeners.push(r)}}}})}(angular),function(e){"use strict";e.module("platform").directive("platformWaterfall",["$timeout",function(e){return{restrict:"A",link:function(e,t){t.css({visibility:"hidden"});var a=function(){for(var e=0,a=t.find("li"),n=a.outerWidth(),r=3,o=0;o<a.length;o++)o<r?$(a[o]).css({top:"0px",left:o*(n+17)+"px"}):$(a[o]).css({top:$(a[o-r]).position().top+$(a[o-r]).outerHeight()+12+"px",left:$(a[o-r]).position().left}),$(a[o]).position().top+$(a[o]).outerHeight()>e&&(e=$(a[o]).position().top+$(a[o]).outerHeight());t.css({height:e+"px",visibility:"visible"})};e.$on("ngRepeatFinished",function(){a()})}}}]).directive("onFinishRenderFilters",["$timeout","nswGlobals",function(e,t){return{restrict:"A",link:function(a){if(a.$last===!0)if(t.getValue("waterFallTime")>1)e(function(){a.$emit("ngRepeatFinished")},100);else{e(function(){a.$emit("ngRepeatFinished")},800);var n=t.getValue("waterFallTime")?t.getValue("waterFallTime"):0;++n,t.setValue("waterFallTime",n,!0)}}}}])}(angular),function(e){"use strict";e.module("platform").directive("qrCode",[function(){return{restrict:"A",require:"ngModel",scope:{qrCodeUrl:"=",afterSelect:"&"},link:function(e,t,a,n){function r(){var a={mPosX:.5,mPosY:.5,mSize:.2,minVersion:6,mode:0,quiet:1,radius:0,render:"canvas",size:200,background:"#ffffff",ecLevel:"H",fill:"#333333",fontcolor:"#ff9818",text:e.qrCodeUrl},r=$.extend({},a,s);t.qrcode(r),0===r.mode?"normal"!==n.$viewValue&&n.$setViewValue("normal"):n.$setViewValue("personality"),e.afterSelect({data:t.find("canvas")[0].toDataURL("image/png")}),t.children("canvas").remove(),e.$root.$$phase||e.$apply()}var o,i,s={},l=function(){var e=$('<input id="image" type="file">');e[0].click(),e.change(function(){if(e[0].files&&e[0].files[0]){var t=new FileReader;t.onload=function(e){setTimeout(function(){o=$('<img id="img-buffer" src="'+e.target.result+'">')[0],s.image=o,s.mode=4,r()},250)},t.readAsDataURL(e[0].files[0])}})};n.$render=function(){i=n.$viewValue||""},t.click(function(){n.$viewValue&&"personality"!==n.$viewValue?l():(s.mode=0,r())});var c=e.$watch("qrCodeUrl",function(e,t){e&&e!==t?r():i=""});e.$on("$destroy",function(){c()})}}}])}(angular),function(e){"use strict";e.module("platform").factory("adlibBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,a){var n={},r=new e;return n.init=function(e,n){r.init(e,n),r.getTemplate("adlib"),t.init(e,n),a.init(e,n),r.addConfiguration(/%errors%/g,t.build()),r.addConfiguration(/%validateTip%/g,a.build()),r.addConfiguration(/%validators%/g,n.validateDirectives||"")},n.build=function(){return r.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").service("baseTemplateBuilder",["$templateCache",function(t){return function(){var a={};a.nameFormat="form-%name%.html",a.init=function(e,t){a.form=e,a.editor=t,r()},a.getTemplate=function(e,n){e=a.nameFormat.replace(/%name%/g,e);var r=t.get(e);return a.template=n?a.template:r,r},a.buildTemplateKey=function(e,t){a.template=a.template.replace(e,t)},a.buildConfigurations=function(){return e.forEach(a.configuration,function(e){a.buildTemplateKey(e.key,e.value)}),a.template},a.addConfiguration=function(e){_.isUndefined(e)||(_.isArray(e)||(e=[e]),_.isRegExp(arguments[0])&&!_.isUndefined(arguments[0])&&(e=[{key:arguments[0],value:arguments[1]}]),_.forEach(e,function(e){a.configuration.unshift(e)}))};var n="col-md-%s% col-lg-%s% col-sm-%s% col-xs-%s%",r=function(){a.configuration=[{key:/%formName%/g,value:a.form.name||""},{key:/%name%/g,value:a.editor.name||""},{key:/%default%/g,value:a.editor["default"]||""},{key:/%lookup%/g,value:a.editor.lookup||""},{key:/%size%/g,value:n.replace(/%s%/g,a.editor.size)},{key:/%type%/g,value:a.editor.type||""},{key:/%model%/g,value:"data."+a.editor.model||""},{key:/%directive%/g,value:a.editor.directive||""},{key:/%options%/g,value:a.editor.options||""},{key:/%maxLength%/g,value:a.editor.maxLength||""},{key:/%maxWord%/g,value:a.editor.maxWord||""},{key:/%label%/g,value:a.editor.label||""},{key:/%placeholder%/g,value:a.editor.placeholder||""},{key:/%validators%/g,value:a.editor.validateDirectives||""},{key:/%id%/g,value:a.editor.id||""}]};return a}}])}(angular),function(e){"use strict";e.module("platform").factory("checkboxBuilderSvc",["baseTemplateBuilder",function(e){var t={},a=new e;return t.init=function(e,t){a.init(e,t);var n=a.getTemplate("checkbox",!0);a.getTemplate("radioGroup");var r=[];_.forEach(a.editor.options,function(e){var t=n.replace(/%checked%/g,!!e.checked).replace(/%key%/g,e[a.editor.key]).replace(/%model%/g,"data."+e.parent+"."+e.model).replace(/%display%/g,e[a.editor.display]);r.push(t)}),a.addConfiguration(/%content%/g,r.join("\r\n"))},t.build=function(){return a.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").service("htmleditorBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,a){var n={},r=new e;return n.init=function(e,n){r.init(e,n),r.getTemplate("htmleditor"),t.init(e,n),a.init(e,n),r.addConfiguration(/%errors%/g,t.build()),r.addConfiguration(/%validateTip%/g,a.build()),r.addConfiguration(/%validators%/g,n.validateDirectives||""),r.addConfiguration(/%simple%/g,!!n.isSimple)},n.build=function(){return r.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").service("inputBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,a){var n={},r=new e;return n.init=function(e,n){r.init(e,n),r.getTemplate("input"),t.init(e,n),a.init(e,n),r.addConfiguration(/%errors%/g,t.build()),r.addConfiguration(/%validateTip%/g,a.build()),r.addConfiguration(/%validators%/g,n.validateDirectives||"")},n.build=function(){return r.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").factory("labelBuilderSvc",["baseTemplateBuilder",function(e){var t={},a=new e;return t.init=function(e,t){if(a.init(e,t),a.getTemplate("label"),t.hasLabel){var n=t.required?a.getTemplate("required",!0):"";a.addConfiguration(/%required%/g,n)}else a.template="",a.configuration=[]},t.build=function(){return a.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").factory("radioBuilderSvc",["baseTemplateBuilder",function(e){var t={},a=new e;return t.init=function(e,t){a.init(e,t);var n=a.getTemplate("radio",!0);a.getTemplate("radioGroup");var r=[];_.forEach(a.editor.options,function(e){var t=n.replace(/%checked%/g,!!e.checked).replace(/%key%/g,e[a.editor.key]).replace(/%display%/g,e[a.editor.display]);r.push(t)}),a.addConfiguration(/%content%/g,r.join("\r\n"))},t.build=function(){return a.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").factory("rowBuilderSvc",["baseTemplateBuilder","$injector","labelBuilderSvc",function(e,t,a){var n={},r=new e;return n.init=function(e,n){r.init(e,n),r.getTemplate("row");var o=t.get(n.template+"BuilderSvc");o.init(e,n),a.init(e,n);var i=a.build(),s=o.build();r.addConfiguration(/%label%/g,i),r.addConfiguration(/%content%/g,s)},n.build=function(){return r.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").service("selectBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,a){var n={},r=new e;return n.init=function(e,n){r.init(e,n),r.getTemplate("select"),t.init(e,n),a.init(e,n),r.addConfiguration(/%errors%/g,t.build()),r.addConfiguration(/%validateTip%/g,a.build()),r.addConfiguration(/%validators%/g,n.validateDirectives||""),r.addConfiguration(/%key%/g,n.key||""),r.addConfiguration(/%display%/g,n.display||"")},n.build=function(){return r.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").factory("singleimageBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,a){var n={},r=new e;return n.init=function(e,n){r.init(e,n),r.getTemplate("single-image"),t.init(e,n),a.init(e,n),r.addConfiguration(/%errors%/g,t.build()),r.addConfiguration(/%validateTip%/g,a.build()),r.addConfiguration(/%validators%/g,n.validateDirectives||"")},n.build=function(){return r.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").service("textareaBuilderSvc",["baseTemplateBuilder","validationBuilderSvc","validationTipBuilderSvc",function(e,t,a){var n={},r=new e;return n.init=function(e,n){r.init(e,n),r.getTemplate("textarea"),t.init(e,n),a.init(e,n),r.addConfiguration(/%errors%/g,t.build()),r.addConfiguration(/%validateTip%/g,a.build()),r.addConfiguration(/%validators%/g,n.validateDirectives||""),r.addConfiguration(/%rows%/g,n.rows||"3")},n.build=function(){return r.buildConfigurations()},n}])}(angular),function(e){"use strict";e.module("platform").factory("validationBuilderSvc",["baseTemplateBuilder",function(e){var t={},a=new e;return t.init=function(e,t){a.getTemplate("errorContainer"),a.init(e,t);var n=a.getTemplate("error",!0);t.validates=t.validates||[],t.required&&!_.find(t.validates,{type:"required"})&&t.validates.push({type:"required",message:"请填写%label%",directive:"data-ng-required=true"}),t.maxLength&&!_.find(t.validates,{type:"nswmaxlength"})&&t.validates.push({type:"nswmaxlength",message:"%label%长度为0~%maxLength%字符",directive:'data-nsw-max-length="'+t.maxLength+'"'}),t.maxWord&&!_.find(t.validates,{type:"maxword"})&&t.validates.push({type:"maxword",message:"%label%使用逗号、空格和分隔符，并不能超过%maxWord%个关键字",directive:'data-maxword="'+t.maxWord+'"'});var r=[];_.forEach(a.editor.validates,function(e){var t=n.replace(/%error%/g,e.type).replace(/%errorMessage%/g,e.message);r.push(t)}),t.validateDirectives=_.map(t.validates,"directive").join(" "),a.addConfiguration(/%content%/g,r.join("\r\n"))},t.build=function(){return a.buildConfigurations()},t}])}(angular),function(e){"use strict";e.module("platform").factory("validationTipBuilderSvc",["baseTemplateBuilder",function(e){var t=new e,a={};return a.init=function(e,a){t.init(e,a),a.hasValidateTip&&a.validateTip?t.getTemplate(a.validateTip+"-tip"):(t.template="",t.configuration=[])},a.build=function(){return t.buildConfigurations()},a}])}(angular),function(e){"use strict";e.module("platform").factory("nswimagePluginSvc",["platformImgLibSvc","nswGlobals","$rootScope",function(e,t,a){var n={};return n.init=function(){KindEditor.plugin("nswimage",function(){var t=this,n="nswimage",r=null;t.lang({nswimage:"从图片库中选择图片"});var o=function(e){var a=e.fileId;/^[http|https]/g.test(e.fileId)||(a=globals.basImagePath+a);var n=window.KindEditor("<img/>");n.attr("src",a),n.attr("data-ke-src",a),n.attr("title",e.name||e.fileName),n.attr("alt",e.name||e.fileName),n.attr("width",320);var o=window.KindEditor("<p></p>");o.css("text-indent","0px"),o.css("text-indent","0px"),o.css("padding-top","14px"),o.css("margin","0px"),o.css("text-align",e.align),o.append(n),r&&o.attr(r),t.cmd.range.insertNode(o[0])},i=function(e,a){r=null,o(e),t.sync(),KindEditor(a).fire("mouseup")},s=function(t){return e.showImgLibModal({count:1,size:300,width:800,height:800,ext:"gif,jpg,jpeg,bmp,png"}).then(function(e){i(e,t),setTimeout(function(){a.$apply()})})};t.plugin.nswmultiimage={edit:function(){s($(this.container[0]).find("iframe")[0].contentDocument)}},t.clickToolbar(n,t.plugin.nswmultiimage.edit)})},n}])}(angular),function(e){"use strict";e.module("platform").factory("nswmultiimagePluginSvc",["platformModalSvc","nswGlobals",function(e,t){var a={};return a.init=function(){KindEditor.plugin("nswmultiimage",function(){var t=this,a="nswmultiimage",n=null;t.lang({nswmultiimage:"批量图片上传"});var r=function(e){t.exec("insertimage",e.url,e.fileName,null,null,null,null,null);for(var a=t.cmd.commonNode({img:"*"}),r=a.parent();r&&r.name&&"body"!==r.name&&"p"!==r.name;)r=r.parent();if(r&&"p"===r.name||(a.after("<p></p>"),r=a.next(),r.append(a),n&&r.attr(n),r.css("text-indent","0px"),r.css("text-align",e.align)),r){null===n&&(n=r.attr()),a.after('<p class="image-holder" style="display: none">HOLDER</p>');var o=a.next();t.cmd.range.selectNode(o[0])}},o=function(e,t){for(n=null,_.forEach(e,r);KindEditor.query(".image-holder",t);)KindEditor.query(".image-holder",t).remove()},i=function(t){return e.showModal({templateUrl:globals.basAppRoot+"/partials/imglibWin.html",controller:"imglibWinCtrl",size:"lg",options:{showAlign:!0,imgConfig:{count:15,size:3e3,width:800,height:600,ext:"gif,jpg,jpeg,bmp,png"},backImgList:[]}}).then(function(e){o(e,t)})};t.plugin.nswmultiimage={edit:function(){i($(this.container[0]).find("iframe")[0].contentDocument)}},t.clickToolbar(a,t.plugin.nswmultiimage.edit)})},a}])}(angular),function(e,t){"use strict";e.module("platform").factory("nswPreviewPluginSvc",[function(){var e={};return e.init=function(){KindEditor.plugin("nswpreview",function(e){var t=this,a="nswpreview";t.lang({nswpreview:"PC预览"}),t.clickToolbar(a,function(){var n='<div style="padding:10px 20px;"><iframe class="ke-textarea" frameborder="0" style="width:100%;height:550px;"></iframe></div>',r=t.createDialog({name:a,width:"80%",title:t.lang(a),body:n}),o=e("iframe",r.div),i=e.iframeDoc(o);i.open(),i.writeln('<base href="'+globals.basImagePath+'">'),i.writeln('<link href="'+globals.basAppRoute+'components/content/css/kindeditor/kind-editor-reset.css" rel="stylesheet">'),i.write(t.fullHtml()),i.close(),e(i.body).css("background-color","#FFF"),o[0].contentWindow.focus()})})},e}])}(angular,void 0),function(e,t){"use strict";e.module("platform").factory("nswPreviewPhonePluginSvc",[function(){var e={};return e.init=function(){KindEditor.plugin("nswpreviewphone",function(e){var t=this,a="nswpreviewphone";t.lang({nswpreviewphone:"手机预览"}),t.clickToolbar(a,function(){var n='<div style="padding:10px 20px;" class="phone-box"><iframe class="ke-textarea" frameborder="0" style="width:320px;height:480px;"></iframe></div>',r=t.createDialog({name:a,width:350,title:t.lang(a),body:n}),o=e("iframe",r.div),i=e.iframeDoc(o);i.open(),i.writeln('<base href="'+globals.basImagePath+'">'),i.writeln('<link href="'+globals.basAppRoute+'components/content/css/kindeditor/kind-editor-reset.css" rel="stylesheet">'),i.write(t.fullHtml()),i.close(),e(i.body).css("background-color","#FFF"),o[0].contentWindow.focus()})})},e}])}(angular,void 0),function(e){"use strict";e.module("platform").factory("reformatPluginSvc",[function(){var e={};return e.init=function(){KindEditor.plugin("reformat",function(e){function t(e){for(var t=e.first();t&&t.first();)t=t.first();return t}var a=this,n="reformat",r=e.toMap("blockquote,center,div,h1,h2,h3,h4,h5,h6,p");a.lang({reformat:"自动排版"}),a.clickToolbar(n,function(){var n=e.dialog({width:240,title:"温馨提示",body:'<div style="margin:10px;"><strong>对齐文本功能将取消之前你设置好的所有文本样式</strong></div>',closeBtn:{name:"关闭",click:function(){n.remove()}},yesBtn:{name:"确定",click:function(){function o(t){if("div"===t.name&&t.hasAttr("style")&&t.hasAttr("class")||"#text"===t.name||"body"===t.name){var a=t.html();return""===a?"body"!==t.name&&o(e(s.body)):(a="<p style='text-indent:2em;'>"+a.replace(/(<br[^>]*\/>)/gi,"</p><p style='text-indent:2em;'>")+"</p>",a=a.replace(/<p style='text-indent:2em;'><\/p>/g,""),t.html(a),!0)}}a.focus();var i,s=a.edit.doc,l=e(s.body).first(),c=[],u=[];if(l&&o(l)!==!0){for(;l;){i=l.next();var d=t(l);if("<br />"===l.html())i=l.next(),l.remove();else{if(d&&"img"===d.name){if(d&&"img"===d.name){var p=!0;e(l).scan(function(e){if("IMG"!==e.nodeName&&"#text"!==e.nodeName)return p=!1,!1}),p&&l.css("text-indent",0)}}else r[l.name]?(l.html(l.html().replace(/^(\s|&nbsp;|　)+/gi,"")),l.css("text-indent","2em")):u&&u.push(l),(!i||r[i.name]||r[l.name]&&!r[i.name])&&(u.length>0&&c.push(u),u=[]);l=i}}e.each(c,function(t,a){var n=null;n=e('<p style="'+("img"===a[0].name?"text-align:center":"text-indent:2em")+';"></p>',s),a[0].before(n),e.each(a,function(e,t){n.append(t)})})}a.addBookmark(),n.remove()}},noBtn:{name:"取消",click:function(){n.remove()}}})})})},e}])}(angular),function(e){"use strict";e.module("platform").factory("selectmodularPluginSvc",["platformModalSvc",function(e){var t={};return t.init=function(){KindEditor.plugin("selectmodular",function(t){var a=this,n="selectmodular";a.lang({selectmodular:"文章模板"});var r=function(e,t){t?a.html(e):a.insertHtml(e)},o=function(){return e.showModal({backdrop:"static",templateUrl:globals.basAppRoute+"/components/templates/platform-template-view.html",controller:"templateLib",size:"lg"}).then(function(e){e&&e.template&&r(e.template.htmlContent||"",e.replace)})};a.plugin.spechars={edit:function(){o()}},a.clickToolbar(n,a.plugin.spechars.edit)})},t}])}(angular),function(){"use strict";angular.module("platform").factory("spechartsPluginSvc",[function(){function e(e){return e.split(",")}var t={},a=[{name:"tsfh",title:"特殊字符",content:e("、,。,·,ˉ,ˇ,¨,〃,々,—,～,‖,…,‘,’,“,”,〔,〕,〈,〉,《,》,「,」,『,』,〖,〗,【,】,±,×,÷,∶,∧,∨,∑,∏,∪,∩,∈,∷,√,⊥,∥,∠,⌒,⊙,∫,∮,≡,≌,≈,∽,∝,≠,≮,≯,≤,≥,∞,∵,∴,♂,♀,°,′,″,℃,＄,¤,￠,￡,‰,§,№,☆,★,○,●,◎,◇,◆,□,■,△,▲,※,→,←,↑,↓,〓,〡,〢,〣,〤,〥,〦,〧,〨,〩,㊣,㎎,㎏,㎜,㎝,㎞,㎡,㏄,㏎,㏑,㏒,㏕,︰,￢,￤,℡,ˊ,ˋ,˙,–,―,‥,‵,℅,℉,↖,↗,↘,↙,∕,∟,∣,≒,≦,≧,⊿,═,║,╒,╓,╔,╕,╖,╗,╘,╙,╚,╛,╜,╝,╞,╟,╠,╡,╢,╣,╤,╥,╦,╧,╨,╩,╪,╫,╬,╭,╮,╯,╰,╱,╲,╳")},{name:"lmsz",title:"罗马字符",content:e("ⅰ,ⅱ,ⅲ,ⅳ,ⅴ,ⅵ,ⅶ,ⅷ,ⅸ,ⅹ,Ⅰ,Ⅱ,Ⅲ,Ⅳ,Ⅴ,Ⅵ,Ⅶ,Ⅷ,Ⅸ,Ⅹ,Ⅺ,Ⅻ")},{name:"szfh",title:"数字字符",content:e("⒈,⒉,⒊,⒋,⒌,⒍,⒎,⒏,⒐,⒑,⒒,⒓,⒔,⒕,⒖,⒗,⒘,⒙,⒚,⒛,⑴,⑵,⑶,⑷,⑸,⑹,⑺,⑻,⑼,⑽,⑾,⑿,⒀,⒁,⒂,⒃,⒄,⒅,⒆,⒇,①,②,③,④,⑤,⑥,⑦,⑧,⑨,⑩,㈠,㈡,㈢,㈣,㈤,㈥,㈦,㈧,㈨,㈩")},{name:"rwfh",title:"日文字符",content:e("ぁ,あ,ぃ,い,ぅ,う,ぇ,え,ぉ,お,か,が,き,ぎ,く,ぐ,け,げ,こ,ご,さ,ざ,し,じ,す,ず,せ,ぜ,そ,ぞ,た,だ,ち,ぢ,っ,つ,づ,て,で,と,ど,な,に,ぬ,ね,の,は,ば,ぱ,ひ,び,ぴ,ふ,ぶ,ぷ,へ,べ,ぺ,ほ,ぼ,ぽ,ま,み,む,め,も,ゃ,や,ゅ,ゆ,ょ,よ,ら,り,る,れ,ろ,ゎ,わ,ゐ,ゑ,を,ん,ァ,ア,ィ,イ,ゥ,ウ,ェ,エ,ォ,オ,カ,ガ,キ,ギ,ク,グ,ケ,ゲ,コ,ゴ,サ,ザ,シ,ジ,ス,ズ,セ,ゼ,ソ,ゾ,タ,ダ,チ,ヂ,ッ,ツ,ヅ,テ,デ,ト,ド,ナ,ニ,ヌ,ネ,ノ,ハ,バ,パ,ヒ,ビ,ピ,フ,ブ,プ,ヘ,ベ,ペ,ホ,ボ,ポ,マ,ミ,ム,メ,モ,ャ,ヤ,ュ,ユ,ョ,ヨ,ラ,リ,ル,レ,ロ,ヮ,ワ,ヰ,ヱ,ヲ,ン,ヴ,ヵ,ヶ")},{name:"xlzm",title:"希腊字母",content:e("Α,Β,Γ,Δ,Ε,Ζ,Η,Θ,Ι,Κ,Λ,Μ,Ν,Ξ,Ο,Π,Ρ,Σ,Τ,Υ,Φ,Χ,Ψ,Ω,α,β,γ,δ,ε,ζ,η,θ,ι,κ,λ,μ,ν,ξ,ο,π,ρ,σ,τ,υ,φ,χ,ψ,ω")},{name:"ewzm",title:"俄文字符",content:e("А,Б,В,Г,Д,Е,Ё,Ж,З,И,Й,К,Л,М,Н,О,П,Р,С,Т,У,Ф,Х,Ц,Ч,Ш,Щ,Ъ,Ы,Ь,Э,Ю,Я,а,б,в,г,д,е,ё,ж,з,и,й,к,л,м,н,о,п,р,с,т,у,ф,х,ц,ч,ш,щ,ъ,ы,ь,э,ю,я")},{name:"pyzm",title:"拼音字母",content:e("ā,á,ǎ,à,ē,é,ě,è,ī,í,ǐ,ì,ō,ó,ǒ,ò,ū,ú,ǔ,ù,ǖ,ǘ,ǚ,ǜ,ü")},{name:"yyyb",title:"英语字符",content:e("i:,i,e,æ,ʌ,ə:,ə,u:,u,ɔ:,ɔ,a:,ei,ai,ɔi,əu,au,iə,εə,uə,p,t,k,b,d,g,f,s,ʃ,θ,h,v,z,ʒ,ð,tʃ,tr,ts,dʒ,dr,dz,m,n,ŋ,l,r,w,j,")},{name:"zyzf",title:"其他字符",content:e("ㄅ,ㄆ,ㄇ,ㄈ,ㄉ,ㄊ,ㄋ,ㄌ,ㄍ,ㄎ,ㄏ,ㄐ,ㄑ,ㄒ,ㄓ,ㄔ,ㄕ,ㄖ,ㄗ,ㄘ,ㄙ,ㄚ,ㄛ,ㄜ,ㄝ,ㄞ,ㄟ,ㄠ,ㄡ,ㄢ,ㄣ,ㄤ,ㄥ,ㄦ,ㄧ,ㄨ,▁,▂,▃,▄,▅,▆,▇,�,█,▉,▊,▋,▌,▍,▎,▏,▓,▔,▕,▼,▽,◢,◣,◤,◥,☉,⊕,〒,〝,〞")}];return t.init=function(){KindEditor.plugin("spechars",function(e){var t=this,n="spechars";t.lang({spechars:"特殊字符"}),t.plugin.spechars={edit:function(){var r='<div style="padding:10px;">';r+='<div class="tabs spec-char"></div>';for(var o=0;o<a.length;o++){var i=a[o];r+='<div class="tabbody tab'+o+'" style="display:none;">';for(var s=0;s<i.content.length;s++)r+="<span>"+i.content[s]+"</span>";r+="</div>"}r+="</div>";var l=t.createDialog({name:n,width:620,height:500,title:"特殊字符",body:r}),c=l.div,u=e.tabs({src:e(".tabs",c),afterSelect:function(e){}});u.div.addClass("spec-char"),e(".ke-tabs",c).css("margin-bottom","0");for(var o=0;o<a.length;o++){var d=a[o];u.add({title:d.title,style:"padding:0px 5px",panel:e(".tab"+o,c)})}e(".tabbody span",c).bind("click",function(){t.hideDialog().focus(),t.insertHtml(e(this).text()).hideMenu().focus()}),u.select(0)}},t.clickToolbar(n,t.plugin.spechars.edit)})},t}])}(),function(e){"use strict";e.module("platform").factory("basDataSvc",["basDataListSvc","basDataItemSvc","basDataProcessorSvc","basDataValidationSvc","basDataCacheSvc","basDataAuthSvc",function(e,t,a,n,r,o){var i={},s=[],l=0,c=function(){l+=1;var e=3-l.toString().length;return e=e<0?0:e,"00".slice(0,e)+l},u=function(i,s){e(i,s),t(i,s),a(i,s),n(i,s),r(i,s),o(i,s)},d=function(e){var t=this,a={};a.init=[],a.options=e,a.options.item=a.options.item||{},a.options.list=a.options.list||{},t.$$serviceId=c(),u(t,a),_.forEach(a.init,function(e){e.call(this)})};return i.createInstance=function(e){var t=new d(e);return s.push(t),t},i}])}(angular),function(e){"use strict";e.module("platform").factory("basDetailCtrlSvc",["$state","$q","nswGlobals","platformModalSvc","platformNavigationSvc","platformNswAuthSvc",function(t,a,n,r,o,i){var s={},l=function(t,s,l){l=l||{},t.appId=n.getValue("appId"),t.currentItem=s.getCurrentItem(),t.tabs={},t.options={},t.imageUrl=s.getImageUrl();var c,u=function(){l&&l.listState&&o.goState(l.listState)},d=function(a){l&&l.notCopyCurrent?t.currentItem=a:t.currentItem=e.copy(a)};t.goState=o.goState,t.resetForm=function(){s.resetCurrentItem()},t.create=function(){s.createNew()},t.save=function(n,o){var i=a.defer();l.failed=l.failed||{},l.success=l.success||{};var d=l.tip||{};d.loading=d.loading||{},_.isObject(n)&&(o=n,n=!0),n=!!_.isUndefined(n)||n,c=s.getCurrentItem();var p,m=null,f=!(l&&l.failed&&l.failed.title);return p=l&&l.tip&&_.isFunction(l.tip.showLoading)?l.tip.showLoading.call(this):l&&l.tip&&l.tip.showLoading,m=t.currentItem.$$new?s.saveCreate(t.currentItem,{displayTip:f,showLoading:p,loadingTip:d.loading.message}):s.updateItem(t.currentItem,{displayTip:f,showLoading:p,loadingTip:d.loading.message}),m.then(function(t){if(o&&o.$setPristine(),_.isObject(t)&&_.has(t,"id")&&e.extend(c,t),!f){var a=_.isString(t)?t:"数据保存成功";a=l.success.tip?l.success.tip:a,r.showSuccessTip(a)}n&&u(),i.resolve(t)},function(e){if(!f){var t=_.isString(e)?e:"数据保存失败";t=l.failed.tip?l.failed.tip:t,r.showWarmingMessage(t,l.failed.title)}i.reject(e)}),i.promise},t.selectTab=function(e){_.forEach(t.tabs,function(e,a){t.tabs[a]=!1}),t.tabs[e]=!0,t.tab=e},t.omitAttr=s.omitAttr,t.goBack=function(){u()},t.checkAuthed=function(e){return i.getAuth(e)},s.registerCurrentItemChanged(d),t.$on("$destroy",function(){s.unregisterCurrentItemChanged(d)})};return s.createInstance=function(e,t,a){return new l(e,t,a)},s}])}(angular),function(e){"use strict";e.module("platform").factory("basListCtrlSvc",["$state","nswGlobals","platformModalSvc","platformNavigationSvc","platformNswAuthSvc",function(t,a,n,r,o){var i={},s=function(t,i,s){t.appId=a.getValue("appId"),t.currentItem=i.getCurrentItem(),t.dataList=i.getDataList(),t.searchOptions=i.getSearchOptions(),t.tabs={},t.imageUrl=i.getImageUrl(),t.options={};var l=function(e){t.currentItem=e},c=function(a){t.dataList=a,e.extend(t.searchOptions,i.getSearchOptions())},u=function(){s&&s.detailState&&r.goState(s.detailState)};t.goState=r.goState,t.setCurrentItem=function(e){i.setCurrentItem(e)},t.selectAll=function(e){e=!!e,_.forEach(t.dataList,function(a){t.isItemSelected(a)!==e&&t.selectItem(a)})},t.selectReverse=function(){_.forEach(t.dataList,function(e){t.selectItem(e)})},t.selectItem=function(e){i.selectItem(e)},t.isItemSelected=function(e){return!!_.find(i.getSelectedItems(),{_id:e._id})},t.hasSelectedItems=function(){return i.getSelectedItems().length},t.isCurrentItem=function(e){return t.currentItem===e},t.searchData=function(e){return i.loadData(e)},t.resetSearchData=function(a){return e.extend(t.searchOptions,{pageNum:1,filter:""}),
i.loadData(a)},t.save=function(e){i.updateItem(e)},t.create=function(){i.createNew(),u()},t.edit=function(e){i.setCurrentItem(e),u()},t.remove=function(e,t){var a=_.isString(t)?t:"确认删除？";t?n.showConfirmMessage(a,"删除提示").then(function(){i.removeItem(e)}):i.removeItem(e)},t.selectTab=function(e){_.forEach(t.tabs,function(e,a){t.tabs[a]=!1}),t.tabs[e]=!0,t.tab=e},t.goBack=function(){},t.getList=function(){return t.dataList},t.getSelectedItems=function(){return i.getSelectedItems()},t.checkAuthed=function(e){return o.getAuth(e)};var d=function(){i.resetSearchOptions(),i.loadData()};t.omitAttr=i.omitAttr,i.registerCurrentItemChanged(l),i.registerListLoaded(c),r.registerRouteUpdated(d),t.$on("$destroy",function(){i.unregisterCurrentItemChanged(l),i.unregisterListLoaded(c),i.resetSearchOptions(),r.unregisterRouteUpdated(d)})};return i.createInstance=function(e,t,a){return new s(e,t,a)},i}])}(angular),function(e){"use strict";e.module("platform").factory("basMainControllerSvc",[function(){var e={},t=function(e,t){e.$on("$destroy",function(){})};return e.createInstance=function(e,a){return new t(e,a)},e}])}(angular),function(e){"use strict";e.module("platform").factory("nswGlobals",["$localStorage","platformMessenger","$sessionStorage",function(t,a,n){var r={},o={},i=new a;return t.globals=t.globals||{},n.globals=t.globals||{},r.setValue=function(e,a,s){return _.set(o,e,a),i.fire(e,a),s&&(_.set(t.globals,e,a),s&&_.set(n.globals,e,a)),r},r.getValue=function(a){if(o.hasOwnProperty(a))return o[a];var i=n.globals[a]||t.globals[a];return e.isDefined(i)&&r.setValue(a,i,!0),i},r.registerPropertyChanged=function(e){i.register(e)},r.unregisterPropertyChanged=function(e){i.unregister(e)},r}])}(angular),function(e){"use strict";e.module("platform").factory("basDataAuthSvc",["platformNswAuthSvc",function(e){return function(t,a){t.checkAuthed=function(t){return e.getAuth(t)}}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataCacheSvc",["platformMessenger","$localStorage",function(e,t){return function(a,n){var r=new e;a.saveCache=function(){if(!n.options.cache||!n.options.name||!n.options.cache.getCache)return null;var e=n.options.cache.getCache.call(a);return t.moduleCache=t.moduleCache||{},t.moduleCache[n.options.name]=e,e},a.loadCache=function(){if(!n.options.cache||!n.options.name||!n.options.cache.applyCache)return null;t.moduleCache=t.moduleCache||{};var e=t.moduleCache[n.options.name]||{};return n.options.cache.applyCache.call(this,e),r.fire(e),e},a.registerCacheLoaded=function(e){r.register(e)},a.unregisterCacheLoaded=function(e){r.register(e)},n.init.push(function(){a.loadCache()})}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataItemSvc",["$http","$q","platformMessenger","platformModalSvc","nswGlobals",function(t,a,n,r,o){return function(i,s){s.currentItem={};var l=s.options.item["default"],c=s.options.item.afterCreated||e.noop,u=s.options.item.prepareCreate||e.noop,d=s.options.item.prepareUpdate||e.noop,p=s.options.item.prepareRemove||e.noop,m=s.options.item.prepareLoad||e.noop,f=s.options.item.itemReseted||e.noop,g=s.options.item.createUri||s.options.uri,h=s.options.item.updateUri||s.options.uri,v=s.options.item.removeUri||s.options.uri,b=s.options.item.loadUri||s.options.uri;s.itemCreated=new n,s.itemUpdated=new n,s.itemRemoved=new n,s.itemLoaded=new n,s.currentItemChanged=new n,i.setCurrentItem=function(e){s.currentItem=e,s.currentItemChanged.fire(e)},i.getCurrentItem=function(){return s.currentItem},i.resetCurrentItem=function(){l=s.options.item["default"],e.extend(s.currentItem,l),f(s.currentItem)},i.createNew=function(){l=s.options.item["default"],_.has(l,"appId")&&(l.appId=o.getValue("appId"));var t=e.copy(l);return t.$$new=!0,c.call(i,t),i.setCurrentItem(t),t},i.saveCreate=function(n,o){n=n||s.currentItem,o=o||{},o.displayTip=!!_.isUndefined(o.displayTip)||o.displayTip;var l=a.defer(),c=e.copy(n);_.omit(c,"$$new");var d={method:"post",url:globals.basAppRoot+g,data:c};u&&u(i,d),t(d).then(function(t){if(t.data.isSuccess){if(_.omit(n,"$$new"),e.extend(n,t.data.data),o.displayTip){var a=_.isString(t.data.data)?t.data.data:"保存成功";r.showSuccessTip(a)}s.searchOptions.totalRows++,s.dataList.length>=s.searchOptions.pageSize?(s.searchOptions.filter="",s.searchOptions.pageNum=1,i.loadData()):s.dataList.push(t.data.data),l.resolve(t.data.data),s.itemCreated.fire(t.data.data)}else o.displayTip&&r.showWarmingMessage(t.data.data,"失败提示"),l.reject(t.data.data);return t.data},function(e){l.reject(e)});var p=_.isBoolean(o.showLoading)?o.showLoading:o.displayTip;return p&&r.showLoadingTip(o.loadingTip||"保存中...").close(l.promise),l.promise},i.updateItem=function(n,o){n=n||s.currentItem,o=o||{},o.displayTip=!!_.isUndefined(o.displayTip)||o.displayTip;var l=a.defer(),c={method:"put",url:globals.basAppRoot+h,data:n};d&&d(i,c),t(c).then(function(t){t.data.isSuccess?(e.extend(n,t.data.data),o.displayTip&&r.showSuccessTip("保存成功"),l.resolve(t.data.data),s.itemUpdated.fire(t.data.data)):(o.displayTip&&r.showWarmingMessage(t.data.data,"保存失败"),l.reject(t.data.data))},function(e){l.reject(e)});var u=_.isBoolean(o.showLoading)?o.showLoading:o.displayTip;return u&&r.showLoadingTip(o.loadingTip||"保存中...").close(l.promise),l.promise},i.removeItem=function(e){e=e||s.currentItem;var a={method:"delete",url:globals.basAppRoot+v,params:{id:e.id}};p&&p(i,a,e);var n=t(a).then(function(t){return t.data.isSuccess?(s.itemRemoved.fire(e),r.showSuccessTip(t.data.data),s.searchOptions.totalRows--,s.options.list.enablePaging&&s.searchOptions.totalPages>1&&i.loadData()):r.showWarmingMessage(t.data.data,"删除失败"),t.data});return r.showLoadingTip("数据移除中!").close(n),n},i.loadItemById=function(e){var a={method:"get",url:globals.basAppRoot+b,params:{id:e}};m&&m(i,a);var n=t(a).then(function(e){return e.data.isSuccess?(s.itemLoaded.fire(e.data.data),e.data.data):void r.showWarmingMessage(e.data.data,"数据获取失败")});return r.showLoadingTip("数据加载中!").close(n),n},i.omitAttr=function(e){var t=_.toArray(arguments);e=t.shift(0),_.forEach(t,function(t){e&&e.hasOwnProperty(t)&&delete e[t]})},i.getImageUrl=function(){return globals.imageUrl.replace(/@appId/,o.getValue("appId"))},i.registerItemCreated=function(e){s.itemCreated.register(e)},i.unregisterItemCreated=function(e){s.itemCreated.unregister(e)},i.registerItemUpdated=function(e){s.itemUpdated.register(e)},i.unregisterItemUpdated=function(e){s.itemUpdated.unregister(e)},i.registerItemRemoved=function(e){s.itemRemoved.register(e)},i.unregisterItemRemoved=function(e){s.itemRemoved.unregister(e)},i.registerItemLoaded=function(e){s.itemLoaded.register(e)},i.unregisterItemLoaded=function(e){s.itemLoaded.unregister(e)},i.registerCurrentItemChanged=function(e){s.currentItem&&!_.isEmpty(s.currentItem)&&e.call(this,s.currentItem,!0),s.currentItemChanged.register(e)},i.unregisterCurrentItemChanged=function(e){s.currentItemChanged.unregister(e)}}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataListSvc",["$http","$q","platformMessenger","platformModalSvc","nswGlobals",function(t,a,n,r,o){return function(a,i){var s=!!i.options.list.enablePaging,l=!!i.options.list.enableSearch,c=i.options.list.pageSize||10,u=i.options.list.listUri||i.options.uri,d=i.options.list.listMethod||"get",p=i.options.list.selectionMode||"multi",m=!e.isDefined(i.options.requireAppId)||i.options.requireAppId,f=i.options.list.multiRemoveUri||i.options.item.removeUri||i.options.uri,g=i.options.list.prepareMultiRemove,h=i.options.list.prepareSearchParam;i.dataList=[],i.searchOptions={},i.currentSearchOptions=null,i.dataProcessors=[],i.selectedItems=[],i.listLoaded=new n,i.beforeListLoad=new n,i.multiRemoved=new n;var v=function(e){e=_.isNumber(e)?{_id:e}:e;var t=_.indexOf(i.dataList,{_id:e._id});_.remove(i.dataList,{_id:e._id}),i.currentItem._id===e._id?i.dataList.length>t?a.setCurrentItem(i.dataList[t]):i.dataList.length===t&&t>0&&a.setCurrentItem(i.dataList[t-1]):a.setCurrentItem({}),0===i.dataList.length&&i.searchOptions.pageNum--,_.remove(i.selectedItems,{_id:e._id})};i.resetFilterOptions=function(){i.searchOptions=i.searchOptions||{},_.forEach(i.searchOptions,function(e,t){i.searchOptions.hasOwnProperty(t)&&delete i.searchOptions[t]}),s&&_.extend(i.searchOptions,{totalRows:0,pageNum:1,totalPages:0,pageSize:c,maxSize:5,title:"",advanced:{},advancedSearch:!1})},i.getSearchParam=function(t){var n=e.copy(i.searchOptions);return n=_.omit(n,"advanced"),n=_.omit(n,"advancedSearch"),n=_.omit(n,"totalRows"),n=_.omit(n,"maxSize"),i.currentSearchOptions&&i.currentSearchOptions.filter!==n.filter&&(i.searchOptions.pageNum=n.pageNum=1),i.currentSearchOptions=n,e.extend(i.currentSearchOptions,n),h&&h.call(a,i.currentSearchOptions,t),n},a.resetSearchOptions=function(){i.resetFilterOptions()},a.getSearchOptions=function(){return i.searchOptions},a.loadSearchData=function(a){var n={};a=a||{},a.displayTip=!!_.isUndefined(a.displayTip)||a.displayTip,l&&(n=i.getSearchParam(a),e.extend(n)),m&&(n.appId=o.getValue("appId"));var c=_.isFunction(u)?u.call(this,n):u,p={method:d,url:globals.basAppRoot+c};"get"===p.method?p.params=n:p.data=n,i.beforeListLoad.fire();var f=t(p).then(function(e){var t=e.data;return t.isSuccess?(t=t.data,i.searchOptions.totalRows=0,s&&t.dataList&&(i.dataList=t.dataList,i.searchOptions.totalPages=t.totalPages,i.searchOptions.totalRows=t.totalRows,i.selectedItems.length=0),s||(i.dataList=t,i.searchOptions.totalRows=i.dataList.length),i.listLoaded.fire(i.dataList),i.dataList):void(a.displayTip&&r.showWarmingMessage(t.data,"温馨提示"))},function(){console.log("系统异常或网络不给力！")});return a.displayTip&&r.showLoadingTip("数据加载中!").close(f),f},a.loadData=function(e){return a.loadSearchData(e)},a.removeItems=function(e){e=e||a.getSelectedItems();var n=_.map(e,"id"),s={method:"delete",url:globals.basAppRoot+f,params:{ids:n}};m&&(s.params.appId=o.getValue("appId")),g&&g(a,s,e);var l=t(s).then(function(t){return t.data.isSuccess?(i.multiRemoved.fire(e),r.showSuccessTip(t.data.data),i.searchOptions.totalRows-=e.length,i.options.list.enablePaging&&i.searchOptions.totalPages>1&&a.loadData(),_.forEach(e,v)):r.showWarmingMessage(t.data.data,"删除失败"),t.data});return r.showLoadingTip("数据移除中!").close(l),l},a.selectItem=function(e){"single"===p?(i.selectedItems[0]=e,a.setCurrentItem(e)):_.find(i.selectedItems,e)?_.remove(i.selectedItems,e):i.selectedItems.push(e)},a.getSelectedItems=function(){return i.selectedItems},a.getDataList=function(){return i.dataList},a.setDataList=function(e){return i.dataList.length=0,_.forEach(e,function(e,t){i.dataList[t]=e}),_.forEach(i.dataList,function(e){i.processData(e,i.dataList)}),a},a.registerListLoaded=function(e){i.dataList&&e.call(this,i.dataList,!0),i.listLoaded.register(e)},a.unregisterListLoaded=function(e){i.listLoaded.unregister(e)},a.registerBeforeListLoad=function(e){i.beforeListLoad.register(e)},a.unregisterBeforeListLoad=function(e){i.beforeListLoad.unregister(e)},a.registerMultiRemoved=function(e){i.multiRemoved.register(e)},a.unregisterMultiRemoved=function(e){i.multiRemoved.unregister(e)},i.init.push(function(){a.registerItemRemoved(v),i.resetFilterOptions()})}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataProcessorSvc",["$injector","platformMessenger",function(e,t){return function(a,n){var r=[],o=new t,i=new t;_.forEach(n.options.processors,function(t){r.push({name:t,instance:e.get(t)})}),n.processData=function(e,t){_.forEach(r,function(n){var r={service:a,item:e,data:t};if(o.fire(r),r.ignore||(n.instance.process.call(a,e,t),i.fire(r)),r.stop)return!1})}}}])}(angular),function(e){"use strict";e.module("platform").factory("basDataValidationSvc",[function(){return function(e,t){t.validators=[],e.checkValidations=function(a){var n,r={},o=[];return t.validating=!0,a=a||t.currentItem,_.forEach(a,function(n,i){_.forEach(t.validators,function(t){var s=t.validate.call(e,a,i,n);t.isAsync?o.push(s.then(function(e){return r[i].result=e,e})):r[i].result=s})}),o&&o.length?o.all(function(){n.resolve(r),t.validating=!1}):(n.resolve(r),t.validating=!1),n}}}])}(angular),function(e){"use strict";e.module("account",["platform"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/wechat","/wechat/account"),e.state("wechat.account",{url:"/account",templateUrl:globals.basAppRoute+"account/partials/account-list.html",controller:"accountListController"}).state("wechat.accountNotice",{url:"/account/notice",templateUrl:globals.basAppRoute+"account/partials/notice-list.html",controller:"noticeListCtrl"}).state("wechat.accountAuthorize",{url:"/account/authorize",templateUrl:globals.basAppRoute+"account/partials/account-authorize.html",controller:"accountListController"}).state("wechat.accountAdd",{url:"/account/add",templateUrl:globals.basAppRoute+"account/partials/account-edit.html",controller:"accountEditCtrl"}).state("wechat.accountEdit",{url:"/account/edit",templateUrl:globals.basAppRoute+"account/partials/account-edit.html",controller:"accountEditCtrl"}).state("wechat.authorizeAbout",{url:"/account/authorizeAbout?state&id",templateUrl:globals.basAppRoute+"account/partials/account-authorize-about.html",controller:"accountAuthorizeCtrl"}).state("wechat.authorizeUrl",{url:"/account/authorizeUrl?appId",templateUrl:globals.basAppRoute+"account/partials/account-authorize-url.html",controller:"accountAuthorizeUrlCtrl"}).state("wechat.authorizeMain",{url:"/account/authorizeMain",templateUrl:globals.basAppRoute+"account/partials/account-authorize-base.html",controller:"accountBaseCtrl"}).state("wechat.authorizeMain.explain",{url:"/explain",templateUrl:globals.basAppRoute+"account/partials/account-authorize-explain.html",controller:"accountListController"}).state("wechat.authorizeMain.mode",{url:"/mode",templateUrl:globals.basAppRoute+"account/partials/account-authorize-mode.html",controller:"accountEditCtrl"}).state("wechat.authorizeMain.success",{url:"/success?state&id",templateUrl:globals.basAppRoute+"account/partials/account-authorize-success.html",controller:"accountAuthorizeCtrl"}).state("wechat.authorizeMain.write",{url:"/write?appId",templateUrl:globals.basAppRoute+"account/partials/account-authorize-write-info.html",controller:"accountAuthorizeUrlCtrl"})}])}(angular),function(e){"use strict";e.module("account").factory("accountDataSvc",["basDataSvc","nswGlobals","$http","platformModalSvc","$q","platformMenuDataSvc",function(e,t,a,n,r,o){var i={requireAppId:!1,uri:"account/wxAccountInfo",item:{"default":{bindType:0,verify_type_info:-1,encryptType:!1}},list:{enableSearch:!0,listUri:"account/getWxAccountList",selectionMode:"single"}},s={},l=e.createInstance(i);return l.loadData(),l.registerCurrentItemChanged(function(e){t.setValue("accountId",e.id,!0),t.setValue("appId",e.appId,!0),t.setValue("platform_menus_defaultState",{stop:!0},!0),o.reloadSystemMenus()}),l.clearCache=function(){t.setValue("accountId",null,!0),t.setValue("appId",null,!0)},l.registerListLoaded(function(e){var a=t.getValue("accountId");a&&e&&e.length&&l.setCurrentItem(_.find(e,{id:a}))}),l.authorizeAotu=function(){var e=r.defer(),t={method:"get",url:globals.basAppRoot+"oauth/authorCheck"};return a(t).then(function(t){t.data.isSuccess?e.resolve(t.data):n.showWarmingMessage(t.data.data,"温馨提示")}),e.promise},l.getEidtHistory=function(){return s.back||"欢迎页面"},l.setEidtHistory=function(e){s.back=s.current||"",s.current=e},l}])}(angular),function(e){"use strict";e.module("account").factory("noticeDataSvc",[function(){}])}(angular),function(e){"use strict";e.module("account").controller("accountListController",["$scope","basListCtrlSvc","accountDataSvc","platformModalSvc","$state","nswGlobals","platformMenuDataSvc",function(e,t,a,n,r,o,i){e.isAgree=!0,e.isAutoAuthorize=!0,t.createInstance(e,a,{detailState:"wechat.authorizeMain.mode"}),e.addAccount=function(){a.authorizeAotu().then(function(e){e.isSuccess&&r.go("wechat.authorizeMain.explain")})},e.changeChooes=function(t){e.isAutoAuthorize=t},e.removeItem=function(t){t.deleteing=!0,n.showConfirmMessage('你确定要删除<font class="promise-color">已选择的</font>账号吗?',"温馨提示","<div>删除之后所有与此账号相关的信息，如已录入的回复信息、自定义菜单等都将删除无法还原</div>").then(function(){e.remove(t)},function(){t.deleteing=!1})},e.setCurrentItem=function(e){a.setCurrentItem(e),e.appId&&i.selectMenu("关注时回复")},e.setCurrentItem({})}])}(angular),function(e){"use strict";e.module("account").controller("accountAuthorizeCtrl",["$scope","$stateParams","$state","basDetailCtrlSvc","accountDataSvc","platformModalSvc","nswGlobals","platformMenuDataSvc",function(e,t,a,n,r,o,i,s){n.createInstance(e,r,{}),"success"===t.state?r.loadItemById(t.id).then(function(t){e.currentItem=t,e.isCertifi=2===e.currentItem.bindType&&0===e.currentItem.verify_type_info,e.accountType=e.currentItem.verify_type_info+""+e.currentItem.bindType,s.reloadSystemMenus()}):o.showWarmingMessage("授权失败,请确认是否绑定的微信号已到上限,或咨询客服解决!","温馨提示").then(function(){a.go("wechat.account")}),e.reAuthorize=function(){i.setValue("platform_menus_defaultState",{stop:!0},!0),i.setValue("platform_menus_selectedMenu",null,!0),i.setValue("platform_menus_selectedMenuGroup",null,!0),window.location.href=globals.basAppRoot+"oauth/goAuthor"},e.goList=function(){a.go("wechat.account")}}])}(angular),function(e){"use strict";e.module("account").controller("accountBaseCtrl",["$scope","$stateParams","$state","basDetailCtrlSvc","accountDataSvc","nswGlobals",function(e,t,a,n,r,o){e.getStage=function(){return"wechat.authorizeMain.explain"===a.current.name?1:"wechat.authorizeMain.success"===a.current.name?3:2}}])}(angular),function(e){"use strict";e.module("account").controller("accountEditCtrl",["$scope","$stateParams","$state","basDetailCtrlSvc","accountDataSvc","nswGlobals","platformMenuDataSvc",function(e,t,a,n,r,o,i){n.createInstance(e,r,{}),e.isEdit=!1,e.isWrite=!0,i.getMenus().groups.length||e.goState("wechat.authorizeMain.explain");var s=e.save;e.save=function(){e.currentItem.head_img=e.currentItem.head_img||globals.defaultImg,e.currentItem.$new=!e.currentItem.type,e.isEdit=!e.currentItem.$new,s(!1,e.formaccount).then(function(t){!e.isEdit&&t.appId?a.go("wechat.authorizeMain.write",{appId:t.id}):i.selectMenu(r.getEidtHistory()),r.loadData()})},e.cancleBtn=function(){window.history.back(-1)},e.imgurl="file/local/upload",e.currentItem.type&&(e.isEdit=!0),e.accountType=[{_id:0,name:"订阅号"},{_id:2,name:"服务号"}],e.currentItem||r.create(),e.changeFile=function(t){e.currentItem.head_img=t.fileId},e.reAuthorize=function(){o.setValue("platform_menus_defaultState",{stop:!0},!0),o.setValue("accountId",null,!0),o.setValue("appId",null,!0),o.setValue("platform_menus_selectedMenu",null,!0),o.setValue("platform_menus_selectedMenuGroup",null,!0),window.location.href=globals.basAppRoot+"oauth/goAuthor"},e.chooesAuthorizeWay=function(t){1===t?r.authorizeAotu().then(function(){o.setValue("platform_menus_defaultState",{stop:!0},!0),o.setValue("accountId",null,!0),o.setValue("appId",null,!0),o.setValue("platform_menus_selectedMenu",null,!0),o.setValue("platform_menus_selectedMenuGroup",null,!0),window.location.href=globals.basAppRoot+"oauth/goAuthor"}):e.isWrite=!1},e.saveAirticle=function(){a.go("wechat.account")}}])}(angular),function(e){"use strict";e.module("account").controller("accountAuthorizeUrlCtrl",["$scope","$stateParams","$state","basDetailCtrlSvc","accountDataSvc",function(e,t,a,n,r){r.loadItemById(t.appId).then(function(t){e.currentItem=t,e.currentItem.appId="",e.isCertifi=2===e.currentItem.bindType&&0===e.currentItem.verify_type_info,e.accountType=e.currentItem.verify_type_info+""+e.currentItem.bindType}),e.saveAirticle=function(){a.go("wechat.authorizeMain.success",{id:t.appId,state:"success"})}}])}(angular),function(e){"use strict";e.module("account").controller("noticeListCtrl",["$scope","noticeDataSvc",function(e,t){}])}(angular),function(e){"use strict";e.module("materials",["platform"]).config(["$stateProvider",function(e){e.state("wechat.materials",{url:"/materials/detail",templateUrl:globals.basAppRoute+"materials/partials/materials-detail.html",controller:"materialsDetailCtrl"}).state("wechat.materials.add",{url:"/add",templateUrl:globals.basAppRoute+"materials/partials/materials-detail-add.html",controller:"materialsDetailAddCtrl"}).state("wechat.materials.apply",{url:"/apply",templateUrl:globals.basAppRoute+"materials/partials/materials-detail-apply.html",controller:"materialsDetailApplyCtrl"}).state("wechat.materialsList",{url:"/materialsList",templateUrl:globals.basAppRoute+"materials/partials/materials-list.html",controller:"materialsListCtrl"})}])}(angular),function(e){"use strict";e.module("materials").factory("articleLibDataSvc",["$q","$http","$state","$timeout","basDataSvc","nswGlobals","materialsDataSvc","platformModalSvc",function(e,t,a,n,r,o,i,s){var l={uri:"material/materialInfoNews",list:{listUri:function(){return"myMaterials"===c?"material/materialInfoNews":"wxMaterial/list"},pageSize:2,enableSearch:!0,enablePaging:!0,prepareSearchParam:function(e){e.type="news",e.appId=o.getValue("appId")},selectionMode:"single"}},c="myMaterials",u=r.createInstance(l),d=!1;u.createArticle=function(e,t){i.setCreateType(e,!0,t),d=!0,i.createNew(),i.checkAuthed("phoneProj")?a.go("wechat.materials.apply"):a.go("wechat.materials.add")};var p=function(e){d&&(d=!1,n(function(){u.closeModal(!0,e)}))};return u.sync=function(){var a=e.defer(),n={method:"get",url:globals.basAppRoot+"wxMaterial/sync",params:{appId:o.getValue("appId"),type:"news"}};return t(n).then(function(e){return e.data.isSuccess?(a.resolve(e.data.data),s.showWarmingMessage(e.data.data,"温馨提示")):(a.reject(e.data.data),s.showWarmingMessage(e.data.data,"温馨提示")),a.promise})},u.setFilterType=function(e){c=e},i.registerItemCreated(p),u.loadData(),u}])}(angular),function(e){"use strict";e.module("materials").factory("materialsCacheDataSvc",["$timeout","$state",function(t,a){var n,r={},o=function(){n.saveCache()};r.init=function(e){n=e,n.registerCurrentItemChanged(o)},r.resolveCache=function(){var e=this,t=e.getCurrentItem();return{current:{id:t.id,name:t.name},selectedIndex:e.getArrowIndex(),createType:e.getCreateType(),createSource:e.getCreateSource(),searchoptions:e.getSearchOptions()}};var i=function(t){var n=this,r=n.getCurrentItem(),o=!1,i=t.searchoptions||{};n.setCreateType(t.createType,t.createSource),n.setArrowIndex(t.selectedIndex),r&&r.id||(o=!0,r=t.current||{}),i&&e.extend(n.getSearchOptions(),i),r.id?(r.articles=[{}],n.setCurrentItem(r),n.loadData().then(function(e){r=_.find(e,{id:r.id}),r&&r.id&&(n.setCurrentItem(r),"wechat.materials.apply"===a.current.name&&a.go("wechat.materials.add"))})):n.loadData()};return r.applyCache=function(e){var a=this;t(function(){i.call(a,e)})},r}])}(angular),function(e){"use strict";e.module("materials").factory("materialsCmsDataSvc",["$http","$q","platformModalSvc",function(e,t,a){var n,r={},o=function(e){return e.map(function(e){return{_id:e._id,name:e.name}})};return r.transformCmsArticle=function(e){var t=/(src\S*=\S*")((?!http|https|ftp)\S+)"/gi;return e.replace(t,"$1"+globals.cmsImagePath+'$2"')},r.setProject=function(e){n=e},r.getProject=function(){return n},r.getProjectLists=function(){var o=t.defer(),i={method:"get",url:globals.basAppRoot+"cms/getProjectLists"};return e(i).then(function(e){return e.data.isSuccess?(n=e.data.data,r.getModuleLists({projId:e.data.data}).then(function(e){o.resolve(e)})):a.showWarmingMessage(e.data.data,"项目信息失败"),e.data}),o.promise},r.getModuleLists=function(n){var r=t.defer(),i={method:"get",url:globals.basAppRoot+"cms/getModuleLists",params:n};return e(i).then(function(e){if(e.data.isSuccess){var t=e.data.data.modules;r.resolve(o(t))}else a.showWarmingMessage(e.data.data,"取模块列表失败");return e.data}),r.promise},r.getCtgLists=function(r){var i=t.defer(),s={method:"get",url:globals.basAppRoot+"cms/getCtgLists",params:{projId:n,moduleId:r}};return e(s).then(function(e){return e.data.isSuccess?i.resolve(o(e.data.data.ctgs)):a.showWarmingMessage(e.data.data,"分类列表失败"),e.data}),i.promise},r.getArticleLists=function(r){var o=r;o.projId=n;var i=t.defer(),s={method:"get",url:globals.basAppRoot+"cms/getArticleLists",params:o};return e(s).then(function(e){return e.data.isSuccess?i.resolve(e.data.data.articles):a.showWarmingMessage(e.data.data,"项目信息失败"),e.data}),i.promise},r.choseArticle=function(e){var t={};return t.title=e.title||"",e.imgSm&&e.imgSm.url?t.fileId=e.imgSm.url:t.fileId="",t.digest=window.deletHtmlTag(e.desc)||"",t.digest=t.digest.replace(/(^\s*)/,"").replace(/\s*$/,"").replace(/\s{2,}/g," "),t.digest=t.digest.replace(/&nbsp;/g," ").substring(0,120),e.content?t.content=r.transformCmsArticle(e.content):e.tabContents&&e.tabContents instanceof Array?t.content=r.transformCmsArticle(e.tabContents[0].value):t.content="",t.id=e._id,t},r}])}(angular),function(e){"use strict";e.module("materials").factory("materialsDataSvc",["$state","basDataSvc","nswGlobals","$http","platformModalSvc","$q","materialsCacheDataSvc",function(t,a,n,r,o,i,s){var l,c,u,d,p={name:"materialsDataSvc",uri:"material/materialInfoNews",item:{removeUri:"material/materialInfo",loadUri:"material/materialInfo","default":{articles:[{content:"",title:"",digest:"",show_cover_pic:"",isArticle:!0},{content:"",title:"",digest:"",show_cover_pic:"",isArticle:!0}]},afterCreated:function(e){e.appId=n.getValue("appId"),e.update_time=(new Date).format("yyyy-MM-dd  hh:mm:ss")},prepareRemove:function(e,t){t.params.type="news",t.params.appId=n.getValue("appId")},prepareLoad:function(e,t){t.params.type="news"},prepareUpdate:function(e,t){_.omit(t.params,"id")}},list:{enableSearch:!0,enablePaging:!0,pageSize:12,prepareSearchParam:function(e){e.appId=n.getValue("appId")},selectionMode:"single"},cache:{getCache:s.resolveCache,applyCache:s.applyCache}},m=a.createInstance(p);m.setArrowIndex=function(e){d=e},m.getArrowIndex=function(){return d||0},m.getCreateType=function(){return l||n.getValue("type")},m.getAppId=function(){return n.getValue("appId")},m.isArticleEmpty=function(e){return e=e||{},!(e.title||e.fileId||e.desc||e.content)},m.getCreateSource=function(){return c},m.getCreateSourceName=function(){return u},m.setCreateType=function(e,a,r){var o=_.isBoolean(a)?a:_.isString(a);o&&(a=_.isString(a)?a:t.current.name,u=r),l=e,c=a,n.setValue("type",e,!0)},m.registerItemCreated(function(e){m.setCurrentItem(e)}),m.registerItemLoaded(function(e){m.setCurrentItem(e)});var f=function(e){return e&&!/^(http|ftp|https):\/\//.test(e)&&(e="http://"+e),e};return m.createArticle=function(e){return{isArticle:!0,show_cover_pic:"",title:"",content_source_url:"",otherUrl:"",content:"",fileId:"",digest:"",isFromPhone:!!e}},m.validateSaveData=function(t){var a=t.articles.length>1;return t.articles=_.filter(t.articles,function(e){return!m.isArticleEmpty(e)}),a&&m.isArticleEmpty(t.articles[1])?(o.showWarmingTip("请完成前两篇图文!"),t.articles.length<2&&(t.articles[1]=m.createArticle()),!1):(_.forEach(t.articles,function(a){if(e.isDefined(a.isArticle)){a.isArticle?(a.content_source_url=f(a.content_source_url),m.omitAttr(a,"isArticle","hasUrl","otherUrl")):(m.omitAttr(a,"isArticle","hasUrl","content","content_source_url"),a.otherUrl=f(a.otherUrl));var n=a.content;1===t.articles.length&&!a.digest&&n&&(a.digest=window.deletHtmlTag(n.replace(/&nbsp;/gi," ")).slice(0,54))}}),!0)},m.validatePreviewData=function(e){if(e.articles){var t=e.articles.length>1,a=_.filter(e.articles,function(e){return!m.isArticleEmpty(e)});return!(t&&m.isArticleEmpty(a[1]))}},s.init(m),m}])}(angular),function(e){"use strict";e.module("materials").factory("materialsImgDataSvc",["basDataSvc","nswGlobals","$http","platformModalSvc",function(t,a,n,r){var o={uri:"material/materialInfoImage",item:{removeUri:"material/materialInfo",loadUri:"material/materialInfo","default":{},prepareRemove:function(e,t){t.params.type="image",t.params.appId=a.getValue("appId")},prepareLoad:function(e,t){t.params.type="image"}},list:{enableSearch:!0,enablePaging:!0,pageSize:12,prepareSearchParam:function(e){e.appId=a.getValue("appId")},selectionMode:"single"}},i=t.createInstance(o);i.loadData();var s;return i.getCreateType=function(){return s},i.setCreateType=function(e){s=e},i.removeItems=function(e){var t={method:"delete",url:globals.basAppRoot+"material/materialInfo",params:{id:e,type:"image",appId:a.getValue("appId")}},o=i.getSearchOptions();return n(t).then(function(t){return t.data.isSuccess?(i.getDataList().length<=e.split(",").length&&o.pageNum>1&&o.pageNum--,i.loadData(),r.showSuccessTip(t.data.data)):r.showWarmingMessage(t.data.data,"删除失败"),t.data})},i.editImgName=function(e){var t={method:"put",url:globals.basAppRoot+"material/materialInfoImage",data:e};return n(t).then(function(e){return e.data.isSuccess?(i.loadData(),r.showSuccessTip("修改成功!")):r.showWarmingMessage(e.data.data,"修改失败"),e.data})},i.showRenameModal=function(t){return o=o||{},o.selected=e.copy(t),r.showModal({templateUrl:globals.basAppRoute+"materials/partials/materials-img-rename-partial.html",controller:"memberDetailCtrl",size:"sm",options:o}).then(function(a){e.extend(t,a),i.updateItem(t)})},i}])}(angular),function(e){"use strict";e.module("materials").controller("articleLibCtrl",["$scope","$state","articleLibDataSvc","basListCtrlSvc",function(e,t,a,n){n.createInstance(e,a,{detailState:"wechat.materialsAdd"}),e.syncDisable=!1,a.closeModal=e.closeModal,e.createArticle=function(t){a.createArticle(t,e.modalOptions.srcModuleName),e.$close()},e.setCurrentItem({}),e.searchType=function(t,n){e.tab=n,a.setFilterType(t),e.searchOptions&&(e.searchOptions.pageNum=1),e.searchData()},e.sync=function(){e.syncDisable=!0,a.sync().then(function(){e.searchData(),e.syncDisable=!1})};var r=function(){var t=_.find(e.dataList,e.modalOptions.selected);t&&e.setCurrentItem(t)};a.registerListLoaded(r),e.searchData(),e.$on("$destroy",function(){a.setFilterType("myMaterials"),a.unregisterListLoaded(r)})}])}(angular),function(e){"use strict";e.module("materials").controller("materialsDetailCtrl",["$scope","$state","$timeout","materialsDataSvc","basDetailCtrlSvc","platformModalSvc",function(t,a,n,r,o,i){var s=r.getCreateSource(),l=!1;t.sourceName=r.getCreateSourceName()||"图文回复",o.createInstance(t,r,{listState:s||"wechat.materialsList"}),t.option={selectedIndex:0},t.option.article=r.createArticle(),t.type=r.getCreateType();var c=e.noop;t.setForm=function(e){c=e};var u=function(){return c.call(t)||{$setDirty:e.noop,$setPristine:e.noop}};t.setArrowIndex=function(e){t.option.selectedIndex=e,r.setArrowIndex(e)};var d=function(){var e=t.currentItem.articles||[],a=e&&e[0]?e[0]:null,n=r.getArrowIndex();e.length||(t.create(),e=t.currentItem.articles,a=e&&e[0]?e[0]:null),"single"===t.type&&e.length&&(e.length=1),e.length&&(t.option.article=a,a.isArticle=!a.otherUrl,a.hasUrl=!!a.content_source_url,"single"===t.type&&(a.create_time=(new Date).toString())),t.setArrowIndex(n)};t.hasUrl=function(){t.option.article.hasUrl||(t.option.article.content_source_url="")},t.addArticle=function(){t.currentItem.articles=t.currentItem.articles||[];var e=t.currentItem.articles;e.length<8?e.push(r.createArticle()):i.showWarmingTip("多图文不能超过8个!")},t.editArticle=function(e,a){t.option.article=t.option.article||{};var n=!!_.find(t.currentItem.articles,{$$hashKey:t.option.article.$$hashKey}),r=u();if(l=l||r.$dirty,!n||r.$valid){r.$setPristine();var o=t.option.article=t.currentItem.articles[e];o.isArticle=!o.otherUrl,o.hasUrl=!!o.content_source_url,t.setArrowIndex(e)}else a&&(t.option.article.fileId?i.showWarmingTip("请先完成当前图文!"):i.showWarmingTip("请先上传封面图片!"))},t.isDataDirty=function(e){return e||l},t.setDataDirty=function(e){return l=e},t.saveArticles=function(){t.option.article=e.copy(t.option.article);var a=r.validateSaveData(t.currentItem),n=u();a?(l=!1,t.save(!0,n),t.setArrowIndex(0)):t.option.article=t.currentItem.articles[t.option.selectedIndex]};var p=function(e,a,n){e.splice(n,1),a=e[n]||e[n-1],a.isArticle=!a.otherUrl,a.hasUrl=!!a.content_source_url,t.setArrowIndex(_.indexOf(e,a))};t.deleteArticle=function(e){var a=t.option.article,n=t.currentItem.articles,r=u();r.$valid||a===n[e]?n.length>2?i.showConfirmMessage("确认删除文章？","温馨提示").then(function(){
p(n,a,e)}):i.showWarmingTip("多图文最少为2个!"):i.showWarmingTip("请先完成当前图文!")},t.switchToReference=function(){r.isArticleEmpty(t.option.article)?a.go("wechat.materials.apply"):i.showConfirmMessage("切换时内容会清空,你确认要切换吗?","温馨提示").then(function(){e.extend(t.option.article,r.createArticle()),a.go("wechat.materials.apply")})},t.switchToWrite=function(){r.isArticleEmpty(t.option.article)?a.go("wechat.materials.add"):i.showConfirmMessage("切换时内容会清空,你确认要切换吗?","温馨提示").then(function(){e.extend(t.option.article,r.createArticle()),a.go("wechat.materials.add")})},t.resetForm=function(){e.extend(t.option.article,r.createArticle())},t.isArticleChanged=function(e){e.isArticle||(e.otherUrl=e.otherUrl||"http://")},t.isContentChanged=function(e){e.content_source_url=e.content_source_url||"http://"};var m=function(){var e=r.getArrowIndex();n(function(){t.editArticle(e)})},f=function(){l=!1};r.registerCurrentItemChanged(m),d(),r.registerItemCreated(f),r.registerItemUpdated(f),t.$on("$destroy",function(){l=!1,r.unregisterCurrentItemChanged(m),r.unregisterItemCreated(f),r.unregisterItemUpdated(f)})}])}(angular),function(e){"use strict";e.module("materials").controller("materialsDetailAddCtrl",["$scope","$state","materialsDataSvc",function(e,t,a){e.valiPreveiw=!0;var n=e.$watch("formmaterials.$valid",function(t){t?e.valiPreveiw=a.validatePreviewData(e.currentItem):e.valiPreveiw=!1});e.$on("$destroy",function(){n(),"wechat.materials.apply"!==t.current.name&&e.setArrowIndex(0)}),e.setForm(function(){return e.formmaterials}),e.checkAuthed("phoneProj")||e.goState("wechat.materials.add")}])}(angular),function(e){"use strict";e.module("materials").controller("materialsDetailApplyCtrl",["$scope","$state","materialsDataSvc","basDetailCtrlSvc","platformModalSvc","$timeout","materialsCmsDataSvc",function(t,a,n,r,o,i,s){t.filterOptions={};var l=function(){s.getProjectLists().then(function(e){t.module=e}),t.getCtg=function(){s.getCtgLists(t.filterOptions.module).then(function(e){t.ctg=e}),t.filterOptions.ctg=""}};t.searchArticles=function(){var e={moduleId:t.filterOptions.module,title:t.filterOptions.title,ctgId:t.filterOptions.ctg};s.getArticleLists(e).then(function(e){t.option.searched=!0,t.option.articles=e})},t.choseArticle=function(a){t.option.chosed=!0,t.option.article||(t.option.article={}),t.formmaterials.$dirty=!0,e.extend(t.option.article,s.choseArticle(a)),t.setDataDirty(!0)},t.valiPreveiw=!0;var c=t.$watch("formmaterials.$valid",function(e){e?t.valiPreveiw=n.validatePreviewData(t.currentItem):t.valiPreveiw=!1});l(),t.$on("$destroy",function(){c(),"wechat.materials.add"!==a.current.name&&t.setArrowIndex(0)}),t.setForm(function(){return t.formmaterials})}])}(angular),function(e){"use strict";e.module("materials").controller("materialsImgListCtrl",["$scope","materialsImgDataSvc","basListCtrlSvc","platformModalSvc",function(e,t,a,n){a.createInstance(e,t),e.ids=[],e.check=function(t){_.has(t,"ischeck")&&t.ischeck?e.ids.push(t.id):_.remove(e.ids,function(e){return e===t.id})},e.deleteimgs=function(){n.showConfirmMessage("确认删除选中的图片？","删除提示").then(function(){t.removeItems(e.ids.toString()).then(function(t){t.isSuccess&&(e.ids.length=0)})})},e.editImgName=function(e){t.editImgName(e)},e.editNickName=function(e){t.showRenameModal(e)},e.allimg=function(){e.searchOptions.filter="",e.searchData()},e.searchData()}])}(angular),function(e){"use strict";e.module("materials").controller("materialsRenameCtrl",["$scope","basDetailCtrlSvc","materialsImgDataSvc",function(e,t,a){t.createInstance(e,a)}])}(angular),function(e){"use strict";e.module("materials").controller("materialsListCtrl",["$scope","$state","materialsDataSvc","materialsImgDataSvc",function(e,t,a,n){e.imgurl="material/image/upload?appId="+a.getAppId(),e.tab=1,e.selectTab=function(t){e.tab=t},e.changeFile=function(){var e=n.getSearchOptions();e.pageNum=1,e.filter="",n.loadData()};var r=function(){a.createNew(),e.checkAuthed("phoneProj")?t.go("wechat.materials.apply"):t.go("wechat.materials.add")};e.createSingle=function(){a.setCreateType("single"),r()},e.createMultiple=function(){a.setCreateType("multiple"),r()};var o=function(){var t=a.getSearchOptions().totalRows;e.tabTitle="图文素材("+t+")"},i=function(){$("html,body").animate({scrollTop:"0px"},300)};a.registerListLoaded(o),a.registerListLoaded(i),n.registerListLoaded(i),e.$on("$destroy",function(){a.unregisterListLoaded(o),a.unregisterListLoaded(i),n.unregisterListLoaded(i)})}])}(angular),function(e){"use strict";e.module("materials").controller("materialsNewsListCtrl",["$scope","materialsDataSvc","basListCtrlSvc","platformModalSvc",function(e,t,a,n){a.createInstance(e,t,{detailState:"wechat.materials.add"}),e.editNews=function(a){_.has(a,"articles")&&a.articles.length>1?t.setCreateType("multiple"):t.setCreateType("single"),e.edit(a)},e.allMaterial=function(){e.searchOptions.filter="",e.searchData()},e.searchNewsData=function(){e.searchOptions.filter?e.searchData():n.showWarmingTip("请输入搜索的标题!")},e.searchData()}])}(angular),function(e){"use strict";e.module("menu",["platform"]).config(["$stateProvider",function(e){e.state("wechat.menu",{url:"/menu",controller:"menuDetailCtrl",templateUrl:globals.basAppRoute+"menus/partials/menu-detail-partial.html"}).state("wechat.enable-menu",{url:"/enable-menu",controller:"menuEnableCtrl",templateUrl:globals.basAppRoute+"menus/partials/menu-enable-partial.html"})}])}(angular),function(e){"use strict";e.module("menu").factory("menuCmsDataSvc",["$timeout","basDataSvc",function(e,t){var a={list:{enableSearch:!0,enablePaging:!0,listUri:"cms/getPublishedArticle",selectionMode:"single",pageSize:6}};return t.createInstance(a)}])}(angular),function(e){"use strict";e.module("menu").factory("menuDataSvc",["$timeout","basDataSvc","nswGlobals","$state","materialsDataSvc","materialsImgDataSvc","platformImgLibSvc","platformModalSvc","accountDataSvc","platformMenuDataSvc","$q","$http",function(e,t,a,n,r,o,i,s,l,c,u,d){var p={uri:"menu/menuInfo",item:{prepareLoad:function(e,t){t.params.appId=a.getValue("appId"),_.omit(t.params,"id")},"default":{enable:!1}},list:{enableSearch:!0,listUri:"menu/getWxMenuList",selectionMode:"single"}},m=t.createInstance(p),f=[],g=!1,h={};m.registerItemLoaded(function(e){f=m.getMenus(),e.appId=a.getValue("appId"),e.button=e.button||[],f.length=0,_.forEach(e.button,function(e,t){f[t]=e}),m.setCurrentItem(e)}),m.isCreatingMaterial=function(){return g},m.getMenus=function(){var e=m.getCurrentItem()||{};return e.button||[]},m.setCurrentSubMenu=function(e){m.selectedSubMenu=e},m.setCurrentMenu=function(e){m.currentMenu=e},m.setSelected=function(e){m.selected=e},m.checkExists=function(e,t,a){var n=!1;return a=a||t.name,_.forEach(m.getMenus(),function(e){if(n=e!==t&&e.name===a,n||_.forEach(e.sub_button,function(e){if(n=e!==t&&e.name===a)return!1}),n)return!1}),n},m.removeAttr=function(e,t){e.hasOwnProperty(t)&&delete e[t]},m.resetMenu=function(e){m.removeAttr(e,"url"),m.removeAttr(e,"key"),m.removeAttr(e,"materialType"),m.removeAttr(e,"picName"),m.removeAttr(e,"keyWord")},m.selectImg=function(e){e&&(m.resetMenu(m.selected),m.removeAttr(m.selected,"url"),m.selected.key=e.fileId,m.selected.materialType="pic",m.selected.picName=e.name||e.fileName)},m.selectKeyWord=function(e){e&&(m.resetMenu(m.selected),m.removeAttr(m.selected,"url"),m.selected.key=e.rule.id,m.selected.materialType="keyWord",m.selected.keyWord=e.keyword,m.fetchMaterialById(e.rule.id,"keyWord"))},m.showArtcileLib=function(){g=!0,s.showModal({controller:"articleLibCtrl",templateUrl:globals.basAppRoute+"materials/templates/articles-lib.html",size:"lg",options:{selected:{id:m.selected.key},srcModuleName:"自定义菜单"}}).then(function(e){n.go("wechat.menu"),m.resetMenu(m.selected),h[e.id]=e,m.selected.key=e.id,m.selected.materialType="news",g=!1})},m.selectImageLib=function(){g=!0,i.showImgLibModal({count:1,size:300,width:800,height:800,ext:"gif,jpg,jpeg,bmp,png"},h[m.selected.key]).then(function(e){n.go("wechat.menu"),m.selectImg(e),g=!1})};var v=function(e){if("view"===e.type){var t=e.url||"";t&&!/^(http|ftp|https):\/\//.test(t)&&(e.url="http://"+t)}};m.validateSaveData=function(e,t){t=t||m.getCurrentItem().button;var a=null;return _.forEach(t,function(t){var n=t.sub_button&&t.sub_button.length;if(!n){if("click"===t.type&&!t.key)return a={parent:e,selected:t,desc:"没有选择相关的素材"},!1;"view"===t.type?(v(t),t.url||(a={parent:e,selected:t,desc:"没有选择菜单的URL"})):t.type||(a={parent:e,selected:t,desc:"没有选择菜单类型"})}return!a&&t.sub_button&&(a=m.validateSaveData(t,t.sub_button)),!a}),a};var b=function(){r.createNew(),r.checkAuthed("phoneProj")?n.go("wechat.materials.apply"):n.go("wechat.materials.add")};m.createArticle=function(e){r.setCreateType(e,"wechat.menu","自定义菜单"),b(),g=!0};var w=function(e){g&&m.selected&&(g=!1,m.selected.hasOwnProperty("url")&&delete m.selected.url,h[e.id]=e,m.selected.key=e.id,m.selected.materialType="news")};m.getMaterials=function(){return h},m.loadKeyWordInfo=function(e){var t=u.defer(),a={url:globals.basAppRoot+"keyWord/reply",method:"get",params:{id:e}};return d(a).then(function(e){return e.data.isSuccess?t.resolve(e.data.data):t.reject(e.data.data),t.promise})},m.fetchMaterialById=function(e,t){"news"===t&&r.loadItemById(e).then(function(t){h[e]=t}),"keyWord"===t&&m.loadKeyWordInfo(e).then(function(t){"news"===t.replyType?r.loadItemById(t.mediaId).then(function(t){h[e]={data:t,keyWordReplyType:"news"}}):"pic"===t.replyType?h[e]={data:t.fileId,keyWordReplyType:"pic"}:h[e]={data:t.content,keyWordReplyType:"txt"}})},m.registerItemLoaded(function(e){_.forEach(e.button,function(e){"click"===e.type&&m.fetchMaterialById(e.key,e.materialType),_.forEach(e.sub_button,function(e){"click"===e.type&&m.fetchMaterialById(e.key,e.materialType)})})});var y=function(e){m.selected=null,m.selectedSubMenu=null,m.currentMenu=null,e&&e.appId?m.loadItemById():m.createNew()},I=function(){g=!1};return r.registerItemCreated(w),l.registerCurrentItemChanged(y),c.registerMenuSelected(I),y(),m}])}(angular),function(e){"use strict";e.module("menu").factory("menuKeyWordSvc",["basDataSvc",function(e){var t,a={requireAppId:!0,list:{enableSearch:!0,enablePaging:!0,listUri:"keyWord/list",prepareSearchParam:function(e){e.type=1},selectionMode:"multi",pageSize:1e5}},n=e.createInstance(a);return n.setCurrentTag=function(e){t=e},n.getCurrentTage=function(){return t},n}])}(angular),function(e){"use strict";e.module("menu").controller("menuCmsMobileCtrl",["$scope","menuCmsDataSvc","basListCtrlSvc",function(e,t,a){a.createInstance(e,t),e.searchData(),e.isItemSelected=function(e){return!!_.find(t.getSelectedItems(),{url:e.url})}}])}(angular),function(e){"use strict";e.module("menu").controller("menuDetailCtrl",["$scope","menuDataSvc","basDetailCtrlSvc","platformModalSvc","$state","platformNavigationSvc",function(t,a,n,r,o,i){n.createInstance(t,a,{notCopyCurrent:!0,tip:{showLoading:!1}}),t.imgurl="material/image/upload?appId="+t.appId,t.currentMenu=a.currentMenu,t.selected=a.selected,t.editModel=!0,t.materials=a.getMaterials();var s=e.noop(),l=function(e,t){var a=!1;return _.forEach(e,function(e,n){if(t&&t[n]!==e)return a=!0,!1}),a},c=function(e,a){a?t.isDirty=e:t.isDirty||(t.isDirty=e)},u=function(){s=t.$watch("selected",function(e,t){c(l(e,t))},!0)},d=function(){e.isFunction(s)&&s()},p=function(){var e;e=t.selected&&"news"===t.selected.materialType?"message":t.selected&&"keyWord"===t.selected.materialType?"keyWord":"pic",t.selectTab(e)};p();var m=function(t,a,n){var o=e.copy(t);a=a||{},a.selected=o,r.showModal({templateUrl:globals.basAppRoute+"menus/partials/menu-rename-partial.html",controller:"menuRenameCtrl",size:"sm",options:a}).then(function(){n(o),c(!0)})},f=function(e,t){e=e||{},r.showModal({templateUrl:globals.basAppRoute+"menus/partials/menu-cms-mobile-partial.html",controller:"menuCmsMobileCtrl",size:"md",options:e}).then(function(e){t(e),c(!0)})};t.getCmsMobileUrl=function(){var e={url:t.selected.url};f(e,function(e){t.selected.url=e.url})};var g=function(e,t){e=e||{},r.showModal({templateUrl:globals.basAppRoute+"menus/partials/menu-key-word-partial.html",controller:"menuKeyWordCtrl",size:"md",options:e}).then(function(e){t(e),c(!0)})};t.disable=function(){t.currentItem.enable=!1,a.updateItem().then(function(){o.go("wechat.enable-menu")})},t.createMenu=function(e){if(t.currentItem.button&&0!==t.currentItem.button.length&&t.menuForm.name&&t.menuForm.name.$invalid)r.showWarmingTip("当前菜单名不合法!");else{var a={type:"click"};e?(e.sub_button.push(a),t.selectSubMenu(a),t.resetMenu(e)):(a.sub_button=[],t.currentItem.button.push(a),t.selectMenu(a))}},t.selectedNameChange=function(){a.checkExists(null,t.selected)&&r.showWarmingTip("该名称已经存在,请重新命名？")},t.validateName=function(e){return!a.checkExists(null,t.selected,e)},t.selectSubMenu=function(e){t.menuForm.name&&t.menuForm.name.$invalid?r.showWarmingTip("菜单名不合法!"):(d(),a.setCurrentSubMenu(e),t.currentSubMenu=e,t.selected=e,a.selected=e,p(),u())},t.selectMenu=function(e){t.menuForm.name&&t.menuForm.name.$invalid?r.showWarmingTip("菜单名不合法!"):(d(),t.currentMenu=e,t.selected=e,a.selected=e,a.currentMenu=e,p(),u())},t.removeMenu=function(e){r.showConfirmMessage("删除确认","温馨提示","删除后该菜单下设置的消息将同步被删除！").then(function(){e===t.currentMenu?_.remove(t.currentItem.button,e):e===t.currentSubMenu&&_.remove(t.currentMenu.sub_button,e),t.selected=null})},t.reNameMenu=function(e){m(e,{title:"修改菜单名称"},function(n){return a.checkExists(e,n)?(r.showConfirmMessage("该名称已经存在,是否需要重新命名？","温馨提示").then(function(){t.reNameMenu(e)}),!1):void(e.name=n.name)})},t.setType=function(e,a){t.resetMenu(e),e.type=a,"view"===a&&(t.selected.url="http://")},t.showArtcileLib=function(){a.showArtcileLib()},t.showImageLib=function(){a.selectImageLib()},t.selectImg=function(e){a.selectImg(e)},t.removeImg=function(e){a.removeAttr(e,"url"),a.removeAttr(e,"key"),a.removeAttr(e,"picName")},t.removeArticle=function(e){a.removeAttr(e,"url"),a.removeAttr(e,"key")},t.resetMenu=function(e){a.resetMenu(e)},t.createArticle=function(e){a.createArticle(e,t.selected)},t.toggleSortable=function(){t.enableSort=!t.enableSort},t.saveMenu=function(){var e=a.validateSaveData();e?(e.sub_button?t.selectMenu(e.selected):(t.selectMenu(e.parent),t.selectSubMenu(e.selected)),r.showErrorMessage("验证错误","验证错误","菜单："+e.selected.name+"<br/> 错误信息："+e.desc)):t.save()};var h=function(e){e.enable||o.go("wechat.enable-menu")},v=function(e){a.currentMenu&&a.selected&&(a.currentMenu=_.find(e.button,{name:a.currentMenu.name})||{},a.selected=a.selected.name===a.currentMenu.name?a.currentMenu:_.find(a.currentMenu.sub_button,{name:a.selected.name}),t.currentMenu=a.currentMenu,t.selected=a.selected,c(!1,!0))},b=function(e){t.isDirty?e.confirm=r.showConfirmMessage("当前页面没有保存是否确认离开？","温馨提示").then(function(){return e.stop=!1,t.$emit("formDirtyInfo",e),a.currentMenu=null,a.selected=null,!0},function(){return e.stop=!0,t.$emit("formDirtyInfo",e),!1}):(a.currentMenu=null,a.selected=null,t.$emit("formDirtyInfo",{dirty:!1}))};t.getKeyWords=function(){var e={keyWord:t.selected.keyWord,id:t.selected.key};g(e,function(e){t.selected.keyWord=e.keyword,a.selectKeyWord(e),t.materials=a.getMaterials()})},t.isContentChanged=function(){t.selected.url=t.selected.url||"http://"},i.registerRouteWillUpdated(b),a.registerCurrentItemChanged(h),a.registerItemUpdated(v),t.$on("$destroy",function(){a.unregisterCurrentItemChanged(h),a.unregisterItemUpdated(v),i.unregisterRouteWillUpdated(b),d(),a.isCreatingMaterial()||a.loadItemById()})}])}(angular),function(e){"use strict";e.module("menu").controller("menuEnableCtrl",["$scope","menuDataSvc","basDetailCtrlSvc","platformModalSvc","accountDataSvc","$state",function(t,a,n,r,o,i){n.createInstance(t,a);var s=function(){i.go("wechat.menu")};t.enableMenu=function(){r.showWarmingMessage("开启自定义菜单之后，将在24小时内对所有用户生效,确定开启吗？","操作提示").then(function(){t.currentItem.enable=!0,a.updateItem(t.currentItem).then(function(t){e.extend(a.getCurrentItem(),t.data),s()})})};var l=function(e){e.enable&&s()};a.registerCurrentItemChanged(l),t.$on("$destroy",function(){a.unregisterCurrentItemChanged(l)}),a.loadItemById()}])}(angular),function(e){"use strict";e.module("menu").controller("menuKeyWordCtrl",["$scope","menuKeyWordSvc","basListCtrlSvc",function(e,t,a){a.createInstance(e,t,{}),e.searchData(),e.selectedItem={},e.modalOptions&&(e.selectedItem.keyword=e.modalOptions.keyWord,e.selectedItem.rule={id:e.modalOptions.id}),e.isShow=!0,e.selectRule=function(t){e.currentrRule=t},e.selectKeyword=function(t,a){e.selectedItem.keyword=a,e.selectedItem.rule=t},e.selectedTag=function(t,a){return e.selectedItem.keyword===a&&e.selectedItem.rule.id===t.id},e.deleteTag=function(){e.selectedItem.keyword=""},e.selectedKeyword=function(t){return e.selectedItem.keyword===t}}])}(angular),function(e){"use strict";e.module("menu").controller("menuListCtrl",["$scope","basListCtrlSvc","menuDataSvc",function(e,t,a){t.createInstance(e,a),e.createMenu=function(t,n){var r=a.createNew();r.code="00"+e.dataList.length,t&&(r.parentCode=t.code,n.preventDefault()),e.dataList.push(r)},e.selectSubMenu=function(t,n){a.setCurrentSubMenu(t),e.currentSubMenu=t,n.preventDefault()},e.selectMenu=function(t){e.currentMenu=t},e.$watch("dataList.length",function(){e.rootItems=_.filter(e.dataList,function(e){return!e.parentCode})})}])}(angular),function(e){"use strict";e.module("menu").controller("menuRenameCtrl",["$scope",function(e){e.maxCount=e.modalOptions.maxCount||(e.modalOptions.selected.sub_button?8:16)}])}(angular),function(e){"use strict";e.module("menu").directive("menuSub",[function(){return{restrict:"A",scope:{parent:"=",menus:"=",selected:"=",selectSubMenu:"=",addSubMenu:"="},templateUrl:globals.basAppRoute+"menus/templates/menu-sub-dir.html",link:function(e){e.menus=e.menus||[],e.selectMenu=function(t){e.currentMenu=t},e.addMenu=function(){e.addSubMenu(e.parent)},e.$watch("menus.length",function(){e.subMenus=_.filter(e.menus,{parentCode:e.parent.code})}),e.getSelectedClass=function(t){if(t===e.selected)return"current"}}}}])}(angular),function(e){"use strict";e.module("autoReply",["platform"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("wechat.autoReplyOnFollow",{url:"/replyOnFollow",templateUrl:globals.basAppRoute+"auto-reply/partials/reply-on-follow.html",controller:"replyOnFollowCtrl"}).state("wechat.keywordautoReply",{url:"/keywordautoReply",templateUrl:globals.basAppRoute+"auto-reply/partials/keyword-reply.html",controller:"replyKeyWordCtrl"}).state("wechat.noMatchReply",{url:"/noMatchReply",templateUrl:globals.basAppRoute+"auto-reply/partials/no-match-reply.html",controller:"noMatchReplyCtrl"})}])}(angular),function(e){"use strict";e.module("autoReply").factory("autoReplyDataSvc",["basDataSvc","platformModalSvc","nswGlobals","$q","materialsImgDataSvc",function(e,t,a,n,r){var o={name:"autoReplyData",requireAppId:!0,uri:"keyWord/reply",item:{"default":{content:"",type:0,replyType:"txt"},afterCreated:function(e){e.appId=a.getValue("appId")},prepareCreate:function(e,t){e.filterData(t.data)},prepareUpdate:function(e,t){e.filterData(t.data)}},list:{enableSearch:!0,enablePaging:!0,listUri:"keyWord/attentionOrMatching",prepareSearchParam:function(e){e.type=0},selectionMode:"single"},cache:{getCache:function(){},applyCache:function(){}}},i=e.createInstance(o);return i.filterData=function(e){"pic"===e.replyType?(e.hasOwnProperty("content")&&delete e.content,e.hasOwnProperty("mediaId")&&delete e.mediaId):"news"===e.replyType?(e.hasOwnProperty("content")&&delete e.content,e.hasOwnProperty("fileId")&&delete e.fileId):(e.hasOwnProperty("mediaId")&&delete e.mediaId,e.hasOwnProperty("fileId")&&delete e.fileId)},i}])}(angular),function(e){"use strict";e.module("autoReply").factory("keyWordReplyDataSvc",["basDataSvc","platformMenuDataSvc","platformModalSvc","nswGlobals","$q","$http",function(e,t,a,n,r,o){var i={requireAppId:!0,uri:"keyWord/reply",item:{"default":{matchType:0,replyType:"txt",keyWordList:["","",""],type:1},afterCreated:function(e){e.appId=n.getValue("appId")},prepareCreate:function(e,t){e.filterData(t.data)},prepareRemove:function(e,t){t.params.appId=n.getValue("appId"),t.params.ids=[],t.params.ids.push(t.params.id),_.omit(t.params,"id")}},list:{enableSearch:!0,enablePaging:!0,listUri:"keyWord/list",prepareSearchParam:function(e){e.type=1},selectionMode:"multi",pageSize:10}},s=e.createInstance(i);return s.loadData(),s.showArtcileLib=function(e){var t=r.defer();return a.showModal({controller:"articleLibCtrl",templateUrl:globals.basAppRoute+"materials/templates/articles-lib.html",size:"lg",options:{type:e}}).then(function(e){t.resolve(e)}),t.promise},s.setSelected=function(e){s.selected=e},s.filterData=function(e){"pic"===e.replyType?(e.hasOwnProperty("content")&&delete e.content,e.hasOwnProperty("mediaId")&&delete e.mediaId):"news"===e.replyType?(e.hasOwnProperty("content")&&delete e.content,e.hasOwnProperty("fileId")&&delete e.fileId):(e.hasOwnProperty("mediaId")&&delete e.mediaId,e.hasOwnProperty("fileId")&&delete e.fileId)},s.removeItems=function(e){var t={method:"delete",url:globals.basAppRoot+"keyWord/reply",params:{ids:e,appId:n.getValue("appId")}};return o(t).then(function(t){if(t.data.isSuccess){var n=s.getSearchOptions();s.getDataList().length===e.length&&n>1&&(n.pageNum--,s.loadData()),s.loadData(),a.showSuccessTip(t.data.data)}else a.showWarmingMessage(t.data.data,"删除失败");return t.data})},s}])}(angular),function(e){"use strict";e.module("autoReply").factory("noMatchReplyDataSvc",["basDataSvc","platformModalSvc","nswGlobals","$q",function(e,t,a,n){var r={requireAppId:!0,uri:"keyWord/reply",item:{"default":{content:"",type:2,replyType:"txt"},afterCreated:function(e){e.appId=a.getValue("appId")},prepareCreate:function(e,t){e.filterData(t.data)},prepareUpdate:function(e,t){e.filterData(t.data)}},list:{enableSearch:!0,enablePaging:!0,listUri:"keyWord/attentionOrMatching",prepareSearchParam:function(e){e.type=2},selectionMode:"single"}},o=e.createInstance(r);return o.filterData=function(e){"pic"===e.replyType?(e.hasOwnProperty("content")&&delete e.content,e.hasOwnProperty("mediaId")&&delete e.mediaId):"news"===e.replyType?(e.hasOwnProperty("content")&&delete e.content,e.hasOwnProperty("fileId")&&delete e.fileId):(e.hasOwnProperty("mediaId")&&delete e.mediaId,e.hasOwnProperty("fileId")&&delete e.fileId)},o}])}(angular),function(e){"use strict";e.module("autoReply").controller("noMatchReplyCtrl",["$scope","noMatchReplyDataSvc","basDetailCtrlSvc","nswGlobals","materialsImgDataSvc",function(e,t,a,n,r){a.createInstance(e,t);var o=e.selectTab;e.selectTab=function(t){1===t?e.currentItem.replyType="txt":e.currentItem.replyType="pic",o.apply(this,arguments)},t.loadData().then(function(a){if(a.length){var n=a[0];t.filterData(n),t.setCurrentItem(n),"pic"===n.replyType&&e.selectTab(2)}else t.createNew()}),e.imgurl="material/image/upload?appId="+n.getValue("appId"),e.afterImageSelected=function(t){e.keyWordImage=t,e.currentItem.fileId=t.fileId},e.deleteMaterial=function(){e.keyWordImage=null},e.changeFile=function(t){e.keyWordImage=t,e.currentItem.fileId=t.fileId},e.replaySave=function(){e.save(!0,e.formmaterials),e.currentItem.$$new=!1},e.textReset=function(){e.currentItem.content=""},e.imgReset=function(){e.currentItem.fileId=""}}])}(angular),function(e){"use strict";e.module("autoReply").controller("replyKeyWordCtrl",["$scope","keyWordReplyDataSvc","basDetailCtrlSvc","nswGlobals",function(e,t,a,n){a.createInstance(e,t,{}),e.imgurl="material/image/upload?appId="+n.getValue("appId"),e.editTitle="新建关键词回复";var r=e.selectTab;e.selectTab=function(t){1===t&&(e.editTitle=!e.currentItem.id||e.currentItem.$$new?"新建关键词回复":"编辑关键词回复"),2===t?e.$broadcast("checkFormDirty"):r.apply(this,arguments)},e.$on("formDirtyInfo",function(a,n){n.stop&&n.dirty!==!1?r.call(this,1):(t.createNew(),e.editTitle="新建关键词回复",r.call(this,2))})}])}(angular),function(e){"use strict";e.module("autoReply").controller("replyKeyWordAddCtrl",["$scope","keyWordReplyDataSvc","basDetailCtrlSvc","nswGlobals",function(e,t,a,n){a.createInstance(e,t,{notCopyCurrent:!0}),e.currentItem.appId&&e.currentItem.appId===n.getValue("appId")||e.create(),e.deleteMaterial=function(){e.keyWordImage=null},e.changeFile=function(t){e.keyWordImage=t,e.currentItem.fileId=t.fileId},e.deleteNsw=function(){e.material=null},e.wordSave=function(){e.formreplay.$setPristine(),e.save(!1)};var r=function(){e.$parent.$parent.selectTab(2)};t.registerItemCreated(r),t.registerItemUpdated(r),e.reset=function(){var t=e.currentItem.replyType;e.create(),e.currentItem.replyType=t,e.formreplay.$setPristine()},e.$on("$destroy",function(){t.unregisterItemCreated(r),t.unregisterItemUpdated(r)})}])}(angular),function(e){"use strict";e.module("autoReply").controller("replyKeyWordListCtrl",["$scope","keyWordReplyDataSvc","basListCtrlSvc","platformModalSvc",function(e,t,a,n){a.createInstance(e,t,{detailState:"wechat.keywordautoReply"}),e.searchOptions.filter="",e.removeitems=function(){n.showConfirmMessage("确定要批量删除关键词回复吗？删除之后所有已录入的关键词回复信息内容都将删除无法还原。","温馨提示").then(function(){t.removeItems(_.map(t.getSelectedItems(),"id")).then(function(){e.dataList.length<=t.getSelectedItems().length&&1!==e.searchOptions.pageNum&&(e.searchOptions.pageNum--,e.searchData())})})},e.editItem=function(a){t.setCurrentItem(a),e.$parent.$parent.selectTab(1),e.$emit("tab",e.tab)},e.updateEnable=function(e){e.enable=!e.enable,t.updata(e)};var r=e.remove;e.remove=function(e,t){t="确定要删除<font color='red'>"+e.ruleName+"</font>吗？删除之后所有已录入的关键词回复信息内容都将删除无法还原。",r.call(this,e,t)};var o=function(){e.isSelectAll=!1};e.searchData(),t.registerListLoaded(o),e.$on("$destroy",function(){t.unregisterListLoaded(o)})}])}(angular),function(e){"use strict";e.module("autoReply").controller("replyOnFollowCtrl",["$scope","autoReplyDataSvc","basDetailCtrlSvc","materialsImgDataSvc","nswGlobals",function(e,t,a,n,r){a.createInstance(e,t);var o=e.selectTab;e.selectTab=function(t){1===t?e.currentItem.replyType="txt":e.currentItem.replyType="pic",o.apply(this,arguments)},t.loadData().then(function(a){if(a&&a.length){var n=a[0];t.filterData(n),t.setCurrentItem(n),"pic"===n.replyType&&n.fileId&&e.selectTab(2)}else t.createNew()}),e.imgurl="material/image/upload?appId="+r.getValue("appId"),e.replaySave=function(){e.save(e.formmaterials),e.currentItem.$$new=!1},e.textReset=function(){e.currentItem.content=""},e.imgReset=function(){e.currentItem.fileId=""};var i=function(){t.loadData().then(function(e){if(e.length){var a=e[0];t.setCurrentItem(a)}else t.createNew()})};t.registerItemCreated(i)}])}(angular),function(e){"use strict";e.module("platform").directive("autoReplyKeyWordList",["platformModalSvc",function(e){return{restrict:"A",require:"ngModel",templateUrl:globals.basAppRoute+"auto-reply/templates/auto-reply-key-word-list.html",link:function(t,a,n,r){t.deleteKeyWord=function(e){t.keyWordList.splice(e,1),t.setValue()},t.addKeyWord=function(){t.keyWordList=t.keyWordList||[],t.keyWordList.length<10?t.keyWordList.push({name:""}):e.showWarmingTip("关键词不能超过10个!")},t.setValue=function(){var e=_.map(_.filter(t.keyWordList,function(e){return!!e.name}),"name");e.length>0&&r.$setViewValue(e),t.updateRequiredValidator()},r.$render=function(){t.keyWordList=r.$viewValue,t.keyWordList=_.map(t.keyWordList,function(e){return{name:e}});_.map(_.filter(t.keyWordList,function(e){return!!e.name}),"name")},t.updateRequiredValidator=function(){var e=_.filter(t.keyWordList||[],function(e){return e&&e.name&&e.name.replace(/\s*/g,"").length});r.$setValidity("required",e.length)};var o=t.$watchCollection("keyWordList",t.updateRequiredValidator);t.$on("$destroy",function(){o()})}}}])}(angular),function(e){"use strict";e.module("member",["platform"]).config(["$stateProvider",function(e){e.state("wechat.member",{url:"/member",controller:"memberListCtrl",templateUrl:globals.basAppRoute+"member/partials/member-list-partial.html"}).state("wechat.memberDetail",{url:"/member-detail",controller:"memberDetailCtrl",templateUrl:globals.basAppRoute+"member/partials/member-detail-partial.html"})}])}(angular),function(e){"use strict";e.module("member").factory("memberCtgDataSvc",["basDataSvc","nswGlobals","platformModalSvc","$q","$http",function(t,a,n,r,o){var i,s={uri:"fansTag/tag",requireAppId:!0,item:{prepareLoad:function(e,t){_.omit(t.data,"tagId")},prepareRemove:function(e,t,a){t.params.tagId=a.tagId,t.params.appId=a.appId},afterCreated:function(e){e.appId=a.getValue("appId")},"default":{}},list:{prepareSearchParam:function(e){e.showDefault=!0},enableSearch:!0,listUri:"fansTag/tagList",selectionMode:"single"}},l=t.createInstance(s);return l.createNew=function(){var e={};return e.appId=a.getValue("appId"),e},l.showCreateModal=function(){return s=s||{},s.selected=l.createNew(),n.showModal({templateUrl:globals.basAppRoute+"member/partials/member-catalog-create-partial.html",controller:"memberCatalogCreateCtrl",size:"sm",options:s})},l.getFansCount=function(){var e=r.defer(),t={method:"get",url:globals.basAppRoot+"fans/getFansCount",params:{appId:a.getValue("appId")}};return o(t).then(function(t){return t.data.isSuccess?e.resolve(t.data.data):e.reject(t.data.data),e.promise})},l.getCtgDataList=function(){var e=r.defer(),t={method:"get",url:globals.basAppRoot+"fansTag/tagList",params:{appId:a.getValue("appId"),showDefault:!1}};return o(t).then(function(t){return t.data.isSuccess?(i=t.data.data,e.resolve(t.data.data)):e.reject(t.data.data),e.promise})},l.getCtgDataList(),l.showEditModal=function(t){return s=s||{},s.selected=e.copy(t),n.showModal({templateUrl:globals.basAppRoute+"member/partials/member-catalog-edit-partial.html",controller:"memberCatalogEditCtrl",size:"sm",options:s})},l.getCtgSelectList=function(){return i},l}])}(angular),function(e){"use strict";e.module("member").factory("memberDataSvc",["$http","basDataSvc","nswGlobals","platformModalSvc","memberCtgDataSvc","$q",function(t,a,n,r,o,i){var s={uri:"fans/fansInfo",requireAppId:!0,item:{"default":{}},list:{enablePaging:!0,enableSearch:!0,pageSize:6,listUri:function(){return o.getCurrentItem()&&"黑名单"!==o.getCurrentItem().name?"fansTag/getFansByTag":"fans/fansList"},selectionMode:"multi",prepareSearchParam:function(e){o.getCurrentItem()&&("黑名单"===o.getCurrentItem().name?e.groupId=(o.getCurrentItem()||{}).groupid:e.tagId=(o.getCurrentItem()||{}).tagId)}}},l=a.createInstance(s),c=[];l.toggleDetailDisplay=function(e){_.find(c,e)?_.remove(c,e):c.push(e)},l.isShowDetail=function(e){return!!_.find(c,e)},l.switchCatalog=function(e){var a=l.getSelectedItems();return t({method:"post",url:globals.basAppRoot+"fans/moveFansToGroup",data:{openid:_.map(a,"openid"),appId:n.getValue("appId"),groupid:e}})},l.userTag=function(e,a){for(var s=i.defer(),c=[],u=0;u<e.length;u++)c.push(e[u].tagId+"");var d={url:globals.basAppRoot+"fansTag/userTag",method:"put",params:{tagId:c,openId:a,appId:n.getValue("appId")}};return a||(d.params.openId=_.map(l.getSelectedItems(),"openid"),d.url=globals.basAppRoot+"fansTag/batchAddUserTag",d.method="post"),t(d).then(function(e){return e.data.isSuccess?(s.resolve(e.data.data),l.loadData(),o.loadData(),r.showSuccessTip(e.data.data)):(s.reject(e.data.data),r.showWarmingTip(e.data.data)),s.promise})},l.showRenameModal=function(t){return s=s||{},s.selected=e.copy(t),r.showModal({templateUrl:globals.basAppRoute+"member/partials/member-rename-partial.html",controller:"memberDetailCtrl",size:"sm",options:s}).then(function(a){e.extend(t,a),l.updateItem(t)})};var u=function(){o.loadData()},d=function(){l.loadData()};return o.registerCurrentItemChanged(d),l.registerItemCreated(u),l.registerItemRemoved(u),l.loadData(),l}])}(angular),function(e){"use strict";e.module("member").factory("memberTagDataSvc",["basDataSvc","nswGlobals","platformModalSvc","$q","$http",function(e,t,a,n,r){}])}(angular),function(e){"use strict";e.module("member").filter("memberCtg",["memberCtgDataSvc",function(e){var t=[],a=function(e){t=e};return e.registerListLoaded(a),t&&t.length||e.loadData(),function(e){var a=_.parseInt(e);if(-100===a)return"全部用户";var n=_.find(t||[],{tagId:a});return n&&n.name?n.name:""}}])}(angular),function(e){"use strict";e.module("member").controller("memberCatalogCreateCtrl",["$scope","basDetailCtrlSvc","memberCtgDataSvc","memberDataSvc",function(e,t,a,n){
t.createInstance(e,a),e.saveCreate=function(){a.saveCreate(e.modalOptions.selected).then(function(t){e.closeModal(!0,t)})}}])}(angular),function(e){"use strict";e.module("member").controller("memberCatalogEditCtrl",["$scope","basDetailCtrlSvc","memberCtgDataSvc",function(t,a,n){a.createInstance(t,n),t.saveEdit=function(){var a=t.modalOptions.selected,r=_.find(n.getDataList(),{tagId:a.tagId});n.updateItem(a).then(function(a){e.extend(r,a),t.closeModal(!0,a)})}}])}(angular),function(e){"use strict";e.module("member").controller("memberDetailCtrl",["$scope","basDetailCtrlSvc","memberDataSvc",function(e,t,a){t.createInstance(e,a)}])}(angular),function(e){"use strict";e.module("member").controller("memberListCtrl",["$scope","basListCtrlSvc","platformModalSvc","memberDataSvc","memberCtgDataSvc",function(t,a,n,r,o){a.createInstance(t,r,{detailState:"wechat.memberDetail"}),t.formOptions={},t.formOptions.isAllSelected=!1,t.options.showEmptyTip=!1,t.selectArr=[],t.createCatalog=function(){o.showCreateModal()},t.toggleDetailDisplay=function(e){r.toggleDetailDisplay(e)},t.isShowDetail=function(e){return r.isShowDetail(e)},t.selectCatalog=function(e){t.hasGroupSelected=_.isNumber(e.groupid),t.selectedCatalog=e,t.searchOptions.pageNum=1,o.setCurrentItem(e)},t.getTotal=function(){return t.Alllist},t.switchToCatalog=function(e,a){e&&!t.isItemSelected(e)&&t.selectItem(e),1===a?n.showConfirmMessage("加入黑名单后，你将无法接收该粉丝发来的消息，且该粉丝无法接收公众号发出的消息，确认加入黑名单？","温馨提示").then(function(){r.switchCatalog(a).then(function(){n.showSuccessTip("粉丝转移成功！"),t.searchOptions.pageNum=1,o.loadData().then(function(){r.loadData(),t.formOptions.isAllSelected=!1})})}):n.showConfirmMessage("确定移出黑名单吗?移除黑名单的粉丝默认属于全部用户 ","温馨提示").then(function(){r.switchCatalog(a).then(function(){n.showSuccessTip("粉丝转移成功！"),t.searchOptions.pageNum=1,o.loadData().then(function(){r.loadData(),t.formOptions.isAllSelected=!1})})})},t.toggleSubCatalogs=function(){t.showSubCatalogs=!t.showSubCatalogs},t.getTabTitle=function(){var e=o.getCurrentItem();return e&&"黑名单"===e.name?e.name+"("+t.blacklist+")":(e&&e.name||(e={$$key:"all",name:"全部用户",count:t.getTotal()}),e.name+"("+(t.searchOptions.totalRows||0)+")")},t.removeCatalog=function(e,a){a.stopPropagation();var i=e.count?"删除标签将会把该已有成员全部移动至未分组里。是否确定删除？":"你确定删除此标签吗？删除后将不再显示。";n.showConfirmMessage(i,"温馨提示").then(function(){o.removeItem(e).then(function(){o.loadData().then(function(){t.searchOptions.pageNum=1,t.searchOptions.tagId=null,t.selectCatalog({}),r.loadData(),t.formOptions.isAllSelected=!1}),n.showSuccessTip("删除成功")})})},t.editCatalog=function(t,a){a.stopPropagation();var n=e.copy(t);o.showEditModal(n).then(function(a){e.extend(t,a)})};var i=t.getList;t.getList=function(){var e=i.apply(this);return t.currentCatalog&&1===t.currentCatalog.groupid?e:_.filter(e,function(e){return 1!==e.groupid})},t.editNickName=function(e){r.showRenameModal(e)},t.isDefaultCatalog=function(e){return _.includes(["黑名单","未分组","星标组"],e.name)};var s=function(e){t.catalogList=e,o.getFansCount().then(function(e){t.blacklist=e.hmdNum,t.Alllist=e.allNum})},l=function(e,a){t.formOptions.isAllSelected=!1,t.options.showEmptyTip=!e.length&&!a,t.getTabTitle()},c=function(e){t.currentCatalog=e};t.deleteTag=function(e,t){e.tagid_list=_.filter(e.tagid_list,function(e){return e.name!==t.name}),r.userTag(e.tagid_list,e.openid)},t.searchData(),r.registerListLoaded(l),o.registerListLoaded(s),o.loadData(),o.registerCurrentItemChanged(c),t.$on("$destroy",function(){t.selectCatalog({}),r.unregisterListLoaded(s),o.unregisterListLoaded(s),o.unregisterCurrentItemChanged(c)})}])}(angular),function(e){"use strict";e.module("member").directive("memberTags",["memberCtgDataSvc","platformModalSvc","memberDataSvc",function(t,a,n){return{restrict:"A",scope:{afterSelect:"&",createCatalog:"&",ctgData:"="},templateUrl:globals.basAppRoute+"member/directives/member-tags-dir.html",require:"ngModel",link:function(r,o,i,s){r.tagIdList=[],r.err="",r.display=i.nswDisplay,r.UI={},r.UI.show=!1,r.value=i.nswValue,r.memberId=i.member,o.parent().find(".caret,.show-tag-box").click(function(){$(this).hasClass("disabled-btn")||($(".getTags .btn-cancel").click(),"bottom"===i.placement?r.UI.show=!0:(o.addClass("member-position-bottom"),r.UI.show=!0)),r.$apply()}),r.tagList=r.ctgData,s.$render=function(){r.tagIdList=e.copy(s.$viewValue),e.forEach(r.tagIdList,function(e){e instanceof Object&&(e.isChecked=!0)})},r.isSelected=function(e){_.find(r.tagIdList,function(t){return t.tagId===e.tagId})?r.tagIdList=_.filter(r.tagIdList,function(t){return t.tagId!==e.tagId}):r.tagIdList.push(e),r.tagIdList.length>3?r.err="最多只能选择3个标签":r.err=""},r.validationTagIdList=function(){return r.tagIdList.length&&0<r.tagIdList.length&&r.tagIdList.length<=3},r.saveTags=function(){n.userTag(r.tagIdList,r.memberId).then(function(){r.UI.show=!1,s.$setViewValue(r.tagIdList),r.tagIdList=[]},function(e){a.showWarmingTip(e)})},r.close=function(){r.UI.show=!1},r.isSelecteds=function(e){return!!_.find(r.tagIdList,function(t){return t.tagId===e})};var l=r.$watch("ctgData",function(e){e&&(r.tagList=r.ctgData)});r.$on("$destroy",function(){l(),t.unregisterListLoaded()})}}}])}(angular),function(e){"use strict";e.module("massMessage",["platform"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/wechat/massMessage","wechat/massMessage/detail"),e.state("wechat.massMessage",{url:"/massMessage",templateUrl:globals.basAppRoute+"mass-message/partials/mass-message.html",controller:"massMessageCtrl"}).state("wechat.massMessage.detail",{url:"/detail",templateUrl:globals.basAppRoute+"mass-message/partials/mass-message-detail.html",controller:"massMessageDetailCtrl"}).state("wechat.massMessage.list",{url:"/list",templateUrl:globals.basAppRoute+"mass-message/partials/mass-message-list.html",controller:"massMessageListCtrl"})}])}(angular),function(e){"use strict";e.module("massMessage").factory("massMessageSvc",["$http","$q","basDataSvc","platformModalSvc","nswGlobals",function(e,t,a,n,r){var o={requireAppId:!0,uri:"massmsg/sendMassMsgByJob",item:{"default":{groupid:-100,massType:"txt",hasDatePicker:!1},afterCreated:function(e){e.appId=r.getValue("appId")},prepareCreate:function(e,t){t.data&&""===t.data.jobTime&&(t.data.hasOwnProperty("jobTime")&&delete t.data.jobTime,t.url=globals.basAppRoot+"massmsg/sendMassMsg")},prepareRemove:function(e,t){t.url=globals.basAppRoot+"massmsg/sendMassMsg",t.params.appId=r.getValue("appId")}},list:{listUri:"massmsg/massMsgList",enablePaging:!0,enableSearch:!0,pageSize:6,selectionMode:"single"}},i=a.createInstance(o);return i.showArtcileLib=function(){n.showModal({controller:"articleLibCtrl",templateUrl:globals.basAppRoute+"materials/templates/articles-lib.html",size:"lg",options:{selected:{id:i.selected.key}}}).then(function(e){return e})},i.cancelJob=function(a){var r=t.defer(),o={method:"get",url:globals.basAppRoot+"massmsg/cancelJob",params:{jobId:a}};return e(o).then(function(e){return e.data.isSuccess?(r.resolve(e.data.data),n.showSuccessTip(e.data.data)):(r.reject(e.data.data),n.showWarmingTip(e.data.data)),r.promise})},i.loadData(),i}])}(angular),function(e){"use strict";e.module("massMessage").controller("massMessageCtrl",["$scope","$state","massMessageSvc",function(e,t,a){e.tabs={};var n="";e.selectTab=function(a,r){n=r,1===a&&(_.forEach(e.tabs,function(t,a){e.tabs[a]=!1}),e.tabs[a]=!0,e.tab=a,n&&t.go("wechat.massMessage."+n)),2===a&&e.$broadcast("checkFormDirty")},e.$on("formDirtyInfo",function(r,o){if(o.stop&&o.dirty!==!1)e.tabs[1]=!0,e.tab=1;else{if(n&&t.current.name!=="wechat.massMessage."+n){_.forEach(e.tabs,function(t,a){e.tabs[a]=!1});var i="detail"===n?1:2;e.tabs[i]=!0,e.tab=i,t.go("wechat.massMessage."+n)}a.createNew()}}),e.goToList=function(){e.selectTab(2,"list")},e.goToDetail=function(){e.selectTab(1,"detail")}}])}(angular),function(e){"use strict";e.module("massMessage").controller("massMessageDetailCtrl",["$scope","nswGlobals","massMessageSvc","basDetailCtrlSvc","memberCtgDataSvc","platformNavigationSvc",function(e,t,a,n,r,o){n.createInstance(e,a,{notCopyCurrent:!0,failed:{title:"群发失败"},tip:{loading:{message:"消息发送中...!"}}}),e.hasDatePicker=!1,e.options.groupType=-100,e.groupTypes=[{id:-100,name:"全部用户"},{id:-99,name:"按粉丝标签选择"}];var i=function(){e.options.groupType=e.currentItem.groupid===-100?-100:-99,e.currentItem&&e.currentItem.massType?e.currentItem.appId!==t.getValue("appId")&&e.create():e.create()};e.groupTypeSelected=function(t){t===-100?(e.currentItem.groupid=t,e.options.groupType=-100):e.options.groupType=-99},e.imgSelected=function(){e.currentItem.hasOwnProperty("mediaId")&&delete e.currentItem.mediaId,e.currentItem.hasOwnProperty("content")&&delete e.currentItem.content},e.articleSelected=function(){e.currentItem.hasOwnProperty("fileId")&&delete e.currentItem.fileId,e.currentItem.hasOwnProperty("content")&&delete e.currentItem.content},e.textChanged=function(){e.currentItem.hasOwnProperty("mediaId")&&delete e.currentItem.mediaId,e.currentItem.hasOwnProperty("fileId")&&delete e.currentItem.fileId},e.getTime=function(){e.currentItem.jobTime=(new Date).format("yyyy-MM-dd hh:mm:ss")},e.reset=function(t){var a=e.currentItem.massType;e.create(),e.currentItem.massType=a,t.$setPristine()};var s=function(t){e.memberCatalogs=_.filter(t,function(e){return!!e.count&&1e4!==e.id})},l=function(t){e.options.groupType=t.groupid===-100?-100:-99},c=function(){e.goToList(),e.create()},u=function(t){(t&&"群发消息"!==t.name||!e.currentItem.massType)&&a.createNew()},d=e.save;e.save=function(t,a,n){e.currentItem.hasDatePicker||(e.currentItem.jobTime=""),a.$setPristine(),d.call(t,a,n)},r.getSearchOptions().isMass=!0,r.loadData(),e.omitAttr(r.getSearchOptions(),"isMass"),o.registerStateUpdated(u),r.registerListLoaded(s),a.registerCurrentItemChanged(l),a.registerItemCreated(c),e.$on("$destroy",function(){r.unregisterListLoaded(s),a.unregisterCurrentItemChanged(l),a.unregisterItemCreated(c),o.unregisterStateUpdated(u)}),i()}])}(angular),function(e){"use strict";e.module("massMessage").controller("massMessageListCtrl",["$scope","massMessageSvc","basListCtrlSvc","$state",function(t,a,n,r){n.createInstance(t,a),t.displayList=[];var o=!1;e.copy(t.searchOptions);t.searchData(),t.cancelJob=function(e){a.cancelJob(e).then(function(){t.searchData()})},t.$on("$destroy",function(){o=!0,r.current&&"/massMessage"===r.current.url&&t.goToDetail()})}])}(angular),function(e){"use strict";e.module("message",["platform"]).config(["$stateProvider",function(e){e.state("wechat.message",{url:"/message",templateUrl:globals.basAppRoute+"message/partials/message.html",controller:"messageCtrl"}).state("wechat.chat",{url:"/chat",templateUrl:globals.basAppRoute+"message/partials/chat.html"}).state("wechat.message.list",{url:"/list",templateUrl:globals.basAppRoute+"message/partials/message-list.html",controller:"messageListCtrl"})}])}(angular),function(e){"use strict";e.module("message").factory("messageChatSvc",["$http","basDataSvc","platformModalSvc","messageSvc",function(e,t,a,n){var r,o={name:"messageChatSvc",list:{listUri:"message/msgList",enablePaging:!0,enableSearch:!0,selectionMode:"single",pageSize:20,prepareSearchParam:function(e){e.openId=n.getOpenId()}}},i=t.createInstance(o);return i.setOpenId=function(e){r=e,i.saveCache()},i.getOpenId=function(){return r},i}])}(angular),function(e){"use strict";e.module("materials").factory("messageCacheDataSvc",["$timeout",function(t){var a={};a.resolveCache=function(){var e=this;return{openId:e.getOpenId(),searchoptions:e.getSearchOptions()}};var n=function(t){var a=this,n=t.openId,r=t.searchoptions||{};r&&e.extend(a.getSearchOptions(),r),n&&a.setOpenId(n),a.loadData({displayTip:!0})};return a.applyCache=function(e){var a=this;t(function(){n.call(a,e)})},a}])}(angular),function(e){"use strict";e.module("message").factory("messageSvc",["$http","basDataSvc","platformModalSvc","nswGlobals","messageCacheDataSvc",function(e,t,a,n,r){var o,i,s={name:"messageSvc",uri:"message/sendMsg",item:{"default":{msgType:"txt",content:""},afterCreated:function(e){e.appId=n.getValue("appId"),e.openId=this.getOpenId()}},list:{listUri:"message/msgList",enablePaging:!0,enableSearch:!0,selectionMode:"single",pageSize:20,prepareSearchParam:function(e){e.dayNum=this.getSearchOptions().dayNum||0}},cache:{getCache:r.resolveCache,applyCache:r.applyCache}};return i=t.createInstance(s),i.setOpenId=function(e){o=e,i.saveCache()},i.getOpenId=function(){return o},i.send=function(t,r){t.appId=n.getValue("appId"),t.msgType="txt";var o={method:"post",url:globals.basAppRoot+"message/sendMsg",data:t,params:{msgId:r}};return e(o).then(function(e){return e.data.isSuccess?(i.loadData(),a.showSuccessTip("发送成功")):a.showWarmingMessage(e.data.data,"发送失败"),e.data},function(e){a.showWarmingMessage("发送失败:"+e,"发送失败")})},i.setMsgType=function(e,t){var a=i.getCurrentItem();switch(a.msgType=e||"",t&&t.id&&(a.mediaId=t.id||""),e){case"txt":a.content&&(a.msgType=e);break;case"pic":a.fileId&&(a.msgType=e);break;case"news":a.mediaId&&(a.msgType=e)}},i.getSelectedType=function(){var e=i.getCurrentItem();return e.fileId?"pic":e.mediaId?"news":"txt"},i}])}(angular),function(e){"use strict";e.module("message").controller("messageChatCtrl",["$scope","messageSvc","basDetailCtrlSvc","$timeout","$state",function(e,t,a,n,r){a.createInstance(e,t,{listState:"wechat.chat",notCopyCurrent:!0,tip:{showLoading:function(){return"pic"===e.currentItem.msgType}}}),e.currentItem&&!e.currentItem.$$new&&r.go("wechat.message.list"),e.setMsgType=t.setMsgType;var o=function(){e.selectTab("txt"),e.create(),e.formchat&&e.formchat.$setPristine()},i=function(t){e.selectTab(t.msgType||"txt")};t.registerItemCreated(o);var s=e.save;e.save=function(e,t,a){s.call(e,t,a).then(function(){t.$setPristine()})},n(function(){t.registerCurrentItemChanged(i)}),e.$on("$destroy",function(){t.unregisterItemCreated(o),t.unregisterCurrentItemChanged(i)})}])}(angular),function(e){"use strict";e.module("autoReply").controller("messageChatListCtrl",["$scope","$timeout","messageChatSvc","basListCtrlSvc","platformModalSvc",function(t,a,n,r){r.createInstance(t,n,{detailState:"wechat.chat"}),t.displayList=e.copy(t.dataList);var o=e.copy(t.searchOptions),i=!1,s=function(){t.searchData({displayTip:!1}).then(function(e){e&&!i&&l(3e3)})},l=function(e){a(function(){s()},e)};l();var c=function(a){o.totalRows===t.searchOptions.totalRows&&o.pageNum===t.searchOptions.pageNum&&t.displayList.length===t.dataList.length||(t.displayList=e.copy(a),o=e.copy(t.searchOptions))};n.registerListLoaded(c),t.$on("$destroy",function(){i=!0,n.unregisterListLoaded(c)})}])}(angular),function(e){"use strict";e.module("message").controller("messageCtrl",["$scope","$state",function(e,t){e.tabs={},e.selectTab=function(t,a){_.forEach(e.tabs,function(t,a){e.tabs[a]=!1}),e.tabs[t]=!0,e.tab=t},e.goToList=function(){e.selectTab(2,"list")},e.goToDetail=function(){e.selectTab(1,"detail")}}])}(angular),function(e){"use strict";e.module("autoReply").controller("messageListCtrl",["$scope","messageSvc","basListCtrlSvc","messageChatSvc",function(e,t,a,n){a.createInstance(e,t,{detailState:"wechat.chat"}),e.searchData(),e.searchOptions.dayNum=0,e.isShow=function(e){_.has(e,"reply.content")&&(e.reply.content=""),e.isShow=!e.isShow},e.timeFrame=[{_id:0,name:"全部"},{_id:1,name:"今天"},{_id:2,name:"昨天"},{_id:3,name:"前天"},{_id:4,name:"最近五天"}],e.send=function(e,a){a.$valid=!1;var n=e.reply;n.openId=e.fromUserName,t.send(n,e.msgId)},e.search=function(){e.searchOptions.pageNum=1,e.searchData()},e.msgCreate=function(a){t.setOpenId(a.fromUserName),n.loadSearchData(),e.create()},t.registerListLoaded(function(){e.searchOptions.hasOwnProperty("dayNum")||(e.searchOptions.dayNum=0)}),e.$on("$destroy",function(){t.unregisterListLoaded()})}])}(angular),function(e){"use strict";e.module("qrCode",["platform"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/wechat/QRCode","/wechat/QRCode/detail"),e.state("wechat.QRCode",{url:"/QRCode",templateUrl:globals.basAppRoute+"qr-code/partials/qr-code.html",controller:"QRCodeCtrl"}).state("wechat.QRCode.detail",{url:"/detail",templateUrl:globals.basAppRoute+"qr-code/partials/qr-code-detail.html",controller:"QRCodeDetailCtrl"}).state("wechat.QRCode.list",{url:"/list",templateUrl:globals.basAppRoute+"qr-code/partials/qr-code-list.html",controller:"QRCodeListCtrl"}).state("wechat.qrCodeCharts",{url:"/qrCodeCharts",controller:"qrCodeChartsCtrl",templateUrl:globals.basAppRoute+"qr-code/partials/qr-code-charts.html"}).state("wechat.qrCodeCharts.all",{url:"/all",templateUrl:globals.basAppRoute+"qr-code/partials/qr-code-charts-all.html",controller:"qrCodeChartsAllCtrl"}).state("wechat.qrCodeCharts.detail",{url:"/detail?isCheck",templateUrl:globals.basAppRoute+"qr-code/partials/qr-code-charts-detail.html",controller:"qrCodeChartsDetailCtrl"})}])}(angular),function(e){"use strict";e.module("qrCode").factory("qrCodeChartsAllSvc",["$http","basDataSvc","platformModalSvc","nswGlobals","$q","platformDateSvc",function(e,t,a,n,r,o){var i={requireAppId:!0,list:{listUri:"qrCodeMana/list",enablePaging:!0,enableSearch:!0,pageSize:10,selectionMode:"multi",prepareSearchParam:function(e){e.beginDate=s.getBeginDate(),e.endDate=s.getEndDate()}}},s=t.createInstance(i);s.getBeginDate=function(){return l},s.setBeginDate=function(e){l=e},s.getEndDate=function(){return c},s.setEndDate=function(e){c=e},s.downQrCodeData=function(){var e=globals.basAppRoot+"qrCodeMana/downQrCodeData?appId="+n.getValue("appId")+"&beginDate="+s.getBeginDate()+"&endDate="+s.getEndDate();window.location.href=e},s.dropDownQrCodeList=function(){var t=r.defer(),a={method:"get",url:globals.basAppRoot+"qrCodeMana/list",params:{appId:n.getValue("appId"),pageSize:1e6,pageNum:1}};return e(a).then(function(e){return e.data.isSuccess?t.resolve(e.data.data):t.reject(e.data.data),t.promise})};var l=o.dateRange({range:30}),c=(new Date).format("yyyy-MM-dd");return s.loadData(),s}])}(angular),function(e){"use strict";e.module("qrCode").factory("qrCodeChartsSvc",["$http","basDataSvc","platformMessenger","nswGlobals","$q","platformDateSvc",function(e,t,a,n,r,o){var i=new a,s="",l={requireAppId:!0,list:{listUri:"qrCodeMana/scanOneQrcodeList",enablePaging:!0,enableSearch:!0,pageSize:10,selectionMode:"multi",prepareSearchParam:function(e){e.beginDate=c.getListBeginDate(),e.endDate=c.getListEndDate(),e.id=c.getChartId()}}},c=t.createInstance(l);c.getChartsInfo=function(t){var a=r.defer(),o={method:"get",url:globals.basAppRoot+"qrCodeMana/todayStatistics",params:{appId:n.getValue("appId"),id:t}};return e(o).then(function(e){return e.data.isSuccess?a.resolve(e.data.data):a.reject(e.data.data),a.promise})},c.qrCodeScanDev=function(){var t=r.defer(),a={method:"get",url:globals.basAppRoot+"qrCodeMana/qrCodeScanDev",params:{id:c.getChartId(),beginDate:c.getBeginDate(),endDate:c.getEndDate()}};return e(a).then(function(e){return e.data.isSuccess?(c.buildDateList(c.getBeginDate(),c.getEndDate(),e.data.data),t.resolve(e.data.data)):t.reject(e.data.data),t.promise})},c.downQrCodeData=function(){var e=globals.basAppRoot+"qrCodeMana/scanOneQrcodeListExport?id="+c.getChartId()+"&beginDate="+c.getListBeginDate()+"&endDate="+c.getListEndDate();window.location.href=e},c.buildDateList=function(e,t,a){function n(e){var t=e.split("-");return new Date(t[0],t[1],t[2])}function r(e,t){return _.find(e,function(e){return e.scanDate===t})}for(var o=[],s=n(e),l=n(t);l.getTime()-s.getTime()>=0;){var c=s.getFullYear(),u=1===s.getMonth().toString().length?"0"+s.getMonth().toString():s.getMonth(),d=1===s.getDate().toString().length?"0"+s.getDate():s.getDate(),p=r(a,c+"-"+u+"-"+d);p?o.push({scanDate:c+"-"+u+"-"+d,count:p.count}):(o.push({scanDate:c+"-"+u+"-"+d,count:0}),console.log(c+"-"+u+"-"+d)),s.setDate(s.getDate()+1)}i.fire(o)},c.getBeginDate=function(){return u},c.setBeginDate=function(e){u=e},c.getEndDate=function(){return d},c.setEndDate=function(e){d=e},c.getListBeginDate=function(){return p},c.setListBeginDate=function(e){p=e},c.getListEndDate=function(){return m},c.setListEndDate=function(e){m=e},c.getChartId=function(){return s},c.setChartId=function(e){s=e},c.registerloadCodeScanDev=function(e){i.register(e)},c.unregisterloadCodeScanDev=function(e){i.unregister(e)};var u=o.dateRange(),d=(new Date).format("yyyy-MM-dd"),p=o.dateRange(),m=(new Date).format("yyyy-MM-dd");return c}])}(angular),function(e){"use strict";e.module("qrCode").factory("QRCodeSvc",["$http","basDataSvc","platformModalSvc","nswGlobals","$q",function(e,t,a,n,r){var o={requireAppId:!0,uri:"qrCodeMana/qrCode",item:{"default":{groupid:-100,replyType:"txt",reply:!1,type:"forever",style:"normal"},afterCreated:function(e){e.appId=n.getValue("appId")},prepareRemove:function(e,t){t.params.appId=n.getValue("appId"),t.params.ids=t.params.id}},list:{listUri:"qrCodeMana/list",enablePaging:!0,enableSearch:!0,pageSize:10,selectionMode:"multi"}},i=t.createInstance(o),s="forever",l=!0;return i.showArtcileLib=function(){a.showModal({controller:"articleLibCtrl",templateUrl:globals.basAppRoute+"materials/templates/articles-lib.html",size:"lg",options:{selected:{id:i.selected.key}}}).then(function(e){return e})},i.getQrUrl=function(){var t=r.defer(),a={method:"get",url:globals.basAppRoot+"qrCodeMana/getQrCodeUrl",params:{type:i.getUrlType(),appId:n.getValue("appId")}};return e(a).then(function(e){return e.data.isSuccess?t.resolve(e.data.data):t.reject(e.data.data),t.promise})},i.uploadQrCode=function(t){var a=r.defer(),n={method:"post",url:"/wx/file/local/uploadBase64",data:{image:t}};return e(n).then(function(e){return e.data.isSuccess?a.resolve(e.data.data):a.reject(e.data.data),a.promise})},i.download=function(e){window.open(globals.basAppRoot+"qrCodeMana/downQrCode?url="+e)},i.removeItems=function(t){var r={method:"delete",url:globals.basAppRoot+"qrCodeMana/qrCode",params:{ids:t,appId:n.getValue("appId")}};return e(r).then(function(e){if(e.data.isSuccess){var n=i.getSearchOptions();i.getDataList().length===t.length&&n>1&&(n.pageNum--,i.loadData()),i.loadData(),a.showSuccessTip(e.data.data)}else a.showWarmingMessage(e.data.data,"删除失败");return e.data})},i.setUrlType=function(e){s=e},i.getUrlType=function(){return s},i.setIsNew=function(e){l=e},i.getIsNew=function(){return l},i}])}(angular),function(e){"use strict";e.module("qrCode").controller("qrCodeChartsAllCtrl",["$scope","qrCodeChartsAllSvc","basListCtrlSvc","qrCodeChartsSvc","$state",function(e,t,a,n,r){a.createInstance(e,t,{}),n.getChartId()&&r.go("wechat.qrCodeCharts.detail"),e.getNewList=function(a){t.setBeginDate(a.start),t.setEndDate(a.end),e.searchData()},e.downQrCodeData=function(){t.downQrCodeData()}}])}(angular),function(e){"use strict";e.module("qrCode").controller("qrCodeChartsCtrl",["$scope","$stateParams","qrCodeChartsSvc","$state","qrCodeChartsAllSvc","platformMenuDataSvc",function(e,t,a,n,r,o){e.options={},e.options.groupTypes=[{id:-100,name:"查看所有二维码"},{id:-99,name:"查看单个二维码"}],e.groupTypeSelected=function(t){t!==-99&&(a.setChartId(""),n.go("wechat.qrCodeCharts.all"),a.getChartsInfo().then(function(t){e.options.info=t,e.options.id=null})),r.loadData()},e.getId=function(t){t&&(a.setChartId(t),a.getChartsInfo(t).then(function(t){e.options.info=t,n.go("wechat.qrCodeCharts.detail")}),a.qrCodeScanDev().then(function(t){e.options.echartData=t}))},a.getChartId()?(e.options.groupType=-99,e.options.id=a.getChartId(),e.getId(a.getChartId())):(a.getChartsInfo().then(function(t){e.options.info=t}),e.options.groupType=-100);var i=function(){r.dropDownQrCodeList().then(function(t){e.qrCodeList=t.dataList})};r.registerListLoaded(i),e.downQrCodeData=function(){a.downQrCodeData()},e.$on("$destroy",function(){e.options.groupType=-100,a.setChartId(""),r.unregisterListLoaded(i)})}])}(angular),function(e){"use strict";e.module("qrCode").controller("qrCodeChartsDetailCtrl",["$scope","$state","qrCodeChartsSvc","basListCtrlSvc","platformDateSvc",function(e,t,a,n,r){n.createInstance(e,a,{}),a.getChartId()||t.go("wechat.qrCodeCharts.all"),a.qrCodeScanDev().then(function(t){e.options.echartData=t}),e.lineConfig={theme:"vintage",dataLoaded:!0},e.lineOption={tooltip:{trigger:"axis"},toolbox:{show:!0,feature:{dataZoom:{yAxisIndex:"none"},dataView:{readOnly:!1},magicType:{type:["line","bar"]},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLine:{show:!1},minInterval:1},series:[{name:"扫描次数",type:"line",data:[],symbol:"circle",itemStyle:{normal:{color:"#f08300",lineStyle:{color:"#f08300",width:1},borderColor:"#f08300"}}}]},e.options.dateRange=[{range:{end:(new Date).format("yyyy-MM-dd"),start:r.dateRange()},name:"最近7天"},{range:{end:(new Date).format("yyyy-MM-dd"),start:r.dateRange({range:15})},name:"最近15天"},{range:{end:(new Date).format("yyyy-MM-dd"),start:r.dateRange({range:30})},name:"最近30天"}],e.options.dateRangeInfo={end:(new Date).format("yyyy-MM-dd"),start:r.dateRange()},e.options.dateRangeListInfo=e.options.dateRangeInfo;var o=function(t){e.lineOption.xAxis.data=_.map(t,"scanDate"),e.lineOption.series[0].data=_.map(t,"count"),e.searchData()};e.getDateRangeList=function(t){a.setListBeginDate(t.start),a.setListEndDate(t.end),e.searchData()},a.registerloadCodeScanDev(o),e.getNewEchat=function(t){a.setBeginDate(t.start),a.setEndDate(t.end),e.options.dateRangeListInfo=t,e.getDateRangeList(t),a.qrCodeScanDev()},e.$on("$destroy",function(){a.unregisterloadCodeScanDev(o)})}])}(angular),function(e){"use strict";e.module("qrCode").controller("QRCodeCtrl",["$scope","$state","QRCodeSvc",function(e,t,a){e.tabs={},e.tabTitle="新建二维码",e.tabInfo=0;var n="",r=1;e.selectTab=function(a,o){n=o,r=a,1===a?(e.tabInfo++,_.forEach(e.tabs,function(t,a){e.tabs[a]=!1}),e.tabs[a]=!0,e.tab=a,o&&t.go("wechat.QRCode."+o)):2===a&&e.$broadcast("checkFormDirty")},e.$on("formDirtyInfo",function(o,i){i.stop&&i.dirty!==!1?(e.tabs[1]=!0,e.tab=1):(e.tabInfo++,_.forEach(e.tabs,function(t,a){e.tabs[a]=!1}),e.tabs[r]=!0,e.tab=r,n&&t.go("wechat.QRCode."+n),e.tabInfo>2&&a.createNew())}),e.goToList=function(){e.selectTab(2,"list")},e.goToDetail=function(){e.tabInfo=0,e.selectTab(1,"detail")};var o=function(t){e.tabTitle=t.id?"编辑二维码":"新建二维码"};a.registerCurrentItemChanged(o),e.$on("$destroy",function(){a.unregisterCurrentItemChanged(o)})}])}(angular),function(e){"use strict";e.module("qrCode").controller("QRCodeDetailCtrl",["$scope","nswGlobals","QRCodeSvc","basDetailCtrlSvc","memberCtgDataSvc",function(e,t,a,n,r){n.createInstance(e,a,{tip:{loading:{message:"消息发送中...!"}},notCopyCurrent:!0,listState:"wechat.QRCode.list"}),e.groupTypes=[{id:-100,name:"全部用户"},{id:-99,name:"按标签选择"}],e.options.groupTypes=[{id:"temp",name:"临时二维码"},{id:"forever",name:"永久二维码"}],e.options.qrCodeInfo={mode:0};var o=function(){e.options.groupType=e.currentItem.groupId?-99:-100,e.currentItem.groupId&&(e.currentItem.groupId=parseInt(e.currentItem.groupId)),e.currentItem&&e.currentItem.replyType?e.currentItem.appId!==t.getValue("appId")?e.create():(e.options.qrCodeUrl=e.currentItem.qrCodeUrl,"txt"===e.currentItem.replyType?e.currentItem.content=e.currentItem.replyContent:"pic"===e.currentItem.replyType?e.currentItem.fileId=e.currentItem.replyContent:e.currentItem.mediaId=e.currentItem.replyContent):e.create(),e.currentItem.$$new&&a.getQrUrl().then(function(t){e.currentItem.url=t.url,e.currentItem.scene_id=t.scene_id})};e.groupTypeSelected=function(t){t===-100?(e.options.groupType=-100,e.currentItem.groupId=null):e.options.groupType=-99},e.imgSelected=function(){e.currentItem.hasOwnProperty("mediaId")&&e.omitAttr(e.currentItem,"mediaId"),e.currentItem.hasOwnProperty("content")&&delete e.currentItem.content},e.articleSelected=function(){e.currentItem.hasOwnProperty("fileId")&&delete e.currentItem.fileId,e.currentItem.hasOwnProperty("content")&&delete e.currentItem.content},e.textChanged=function(){e.currentItem.hasOwnProperty("mediaId")&&delete e.currentItem.mediaId,e.currentItem.hasOwnProperty("fileId")&&delete e.currentItem.fileId},e.reset=function(t){var a=e.currentItem.massType;e.create(),e.currentItem.massType=a,t.$setPristine()};var i=function(t){e.memberCatalogs=t},s=function(){e.goToList(),e.create()};e.changeType=function(t){a.setUrlType(t),a.getQrUrl().then(function(t){e.currentItem.url=t.url,e.currentItem.scene_id=t.scene_id})},e.getQrCodeUrl=function(t){e.options.qrCodeUrl=t};var l=e.reset;e.reset=function(t){"normal"!==e.currentItem.style&&$("#cancelLogo").click(),e.currentItem.style="normal",l.call(this,t)},e.saveItem=function(t,n){t.$setPristine(),e.options.qrCodeUrl!==e.currentItem.qrCodeUrl?a.uploadQrCode(e.options.qrCodeUrl).then(function(a){e.currentItem.qrCodeUrl=a,"txt"===e.currentItem.replyType?e.currentItem.replyContent=e.currentItem.content:"pic"===e.currentItem.replyType?e.currentItem.replyContent=e.currentItem.fileId:e.currentItem.replyContent=e.currentItem.mediaId,e.omitAttr(e.currentItem,"mediaId","content","fileId"),e.save(!0,t,n)}):("txt"===e.currentItem.replyType?e.currentItem.replyContent=e.currentItem.content:"pic"===e.currentItem.replyType?e.currentItem.replyContent=e.currentItem.fileId:e.currentItem.replyContent=e.currentItem.mediaId,e.omitAttr(e.currentItem,"mediaId","content","fileId"),e.save(!0,t,n))},r.getSearchOptions().isMass=!0,r.loadData(),r.registerListLoaded(i),a.registerItemCreated(s),a.registerItemUpdated(s),e.$on("$destroy",function(){r.unregisterListLoaded(i),a.unregisterItemCreated(s),a.unregisterItemUpdated(s)}),o()}])}(angular),function(e){"use strict";e.module("qrCode").controller("QRCodeListCtrl",["$scope","QRCodeSvc","basListCtrlSvc","platformModalSvc","$state","qrCodeChartsSvc","platformMenuDataSvc",function(e,t,a,n,r,o,i){a.createInstance(e,t,{detailState:"wechat.QRCode.detail"}),e.searchData(),e.editItem=function(t){e.edit(t),e.goToDetail()},e.getQrUrl=function(){t.getQrUrl(e.currentItem.type)},e.removeitems=function(){n.showConfirmMessage("确定要批量删除二维码吗？","温馨提示").then(function(){t.removeItems(_.map(t.getSelectedItems(),"id")).then(function(){e.dataList.length<=t.getSelectedItems().length&&1!==e.searchOptions.pageNum&&(e.searchOptions.pageNum--,e.searchData())})})},e.download=function(e){t.download(e)},e.goChart=function(e){o.setChartId(e.id),i.selectMenu("二维码统计")},e.downloadImg=function(e){var t=window.open(e);t.document.execCommand("SaveAs ")},e.$on("$destroy",function(){r.current&&"/QRCode"===r.current.url&&e.goToDetail()})}])}(angular),function(e){"use strict";e.module("messageTemplate",["platform","member"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("/wechat/message-template","wechat/message-template/detail"),e.state("wechat.messageTemplate",{url:"/message-template",templateUrl:globals.basAppRoute+"message-template/partials/message-template.html",controller:"messageTemplateCtrl"}).state("wechat.messageTemplate.detail",{url:"/detail",templateUrl:globals.basAppRoute+"message-template/partials/message-template-detail.html",controller:"messageTemplateDetailCtrl"}).state("wechat.messageTemplate.list",{url:"/list",templateUrl:globals.basAppRoute+"message-template/partials/message-template-list.html",controller:"messageTemplateListCtrl"})}])}(angular),function(e){"use strict";e.module("messageTemplate").factory("messageTemplateSvc",["$http","basDataSvc","platformModalSvc","nswGlobals","$q",function(e,t,a,n,r){var o={requireAppId:!0,uri:"templateMsg/template",item:{"default":{job:!1},afterCreated:function(e){e.appId=n.getValue("appId")},prepareRemove:function(e,t){t.params.appId=n.getValue("appId"),t.params.ids=t.params.id}},list:{listUri:"templateMsg/list",enablePaging:!0,enableSearch:!0,pageSize:10,selectionMode:"multi",prepareMultiRemove:function(e,t){e.omitAttr(t,"appId")}}},i=t.createInstance(o);return i.toggleStatus=function(e){e.status=!e.status,i.updateItem(e,{loadingTip:"状态更新中...",displayTip:!1,showLoading:!0}).then(function(){a.showSuccessTip("状态更新成功!")},function(e){a.showWarmingMessage(e,"操作失败")})},i.cancelJob=function(t){var n=r.defer(),o={method:"post",url:globals.basAppRoot+"templateMsg/cancleJob",params:{id:t}};return e(o).then(function(e){e.data.isSuccess?(n.resolve(e.data.data),i.loadData(),a.showSuccessTip(e.data.data)):a.showWarmingMessage(e.data.data,"操作失败");
}),n.promise},i.getAllTemplate=function(){var t=r.defer(),a={method:"get",url:globals.basAppRoot+"templateMsg/getAllTemplate",params:{appId:n.getValue("appId")}};return e(a).then(function(e){e.data.isSuccess?t.resolve(e.data.data):t.reject(e.data.data)}),t.promise},i.transformKeywords=function(e,t){return t=t||{},e.replace(/(\{\{[^\}]+\}\})/gi,function(e,a){return a=a||"",a=a.replace(/\{|\}*/gi,"").split(".")[0],t[a]||""})},i.resolveTemplateKeys=function(e){var t=e.match(/\{\{[^\}]+\}\}/gi),a=[];return _.forEach(t,function(e){var t=e.replace(/\{|\}*/gi,"");if(!_.find(a,{title:t})){var n={title:t,keyValue:t.split(".")[0]};a.push(n)}}),a},i}])}(angular),function(e){"use strict";e.module("messageTemplate").controller("messageTemplateCtrl",["$scope","$state","messageTemplateSvc",function(e,t,a){e.tabs={},e.tabTitle="新建二维码",e.tabInfo=0;var n="",r=1;e.selectTab=function(a,o){n=o,r=a,1===a?(e.tabInfo++,_.forEach(e.tabs,function(t,a){e.tabs[a]=!1}),e.tabs[a]=!0,e.tab=a,o&&t.go("wechat.messageTemplate."+o)):2===a&&e.$broadcast("checkFormDirty")},e.$on("formDirtyInfo",function(o,i){i.stop&&i.dirty!==!1?(e.tabs[1]=!0,e.tab=1):(e.tabInfo++,_.forEach(e.tabs,function(t,a){e.tabs[a]=!1}),e.tabs[r]=!0,e.tab=r,n&&t.go("wechat.messageTemplate."+n),e.tabInfo>2&&a.createNew())}),e.goToList=function(){e.selectTab(2,"list")},e.goToDetail=function(){e.tabInfo=0,e.selectTab(1,"detail")};var o=function(t){e.tabTitle=t.id?"编辑模板消息":"新建模板消息"};a.registerCurrentItemChanged(o),e.$on("$destroy",function(){a.unregisterCurrentItemChanged(o)})}])}(angular),function(e){"use strict";e.module("messageTemplate").controller("messageTemplateDetailCtrl",["$scope","nswGlobals","messageTemplateSvc","basDetailCtrlSvc","memberCtgDataSvc",function(e,t,a,n,r){n.createInstance(e,a,{tip:{loading:{message:"消息发送中...!"}},notCopyCurrent:!0,listState:"wechat.messageTemplate.list"}),e.groupTypes=[{id:-100,name:"全部用户"},{id:-99,name:"按粉丝标签选择"}],e.options.preview=!1;var o=function(){e.currentItem?e.currentItem.appId!==t.getValue("appId")?e.create():(e.currentItem.content&&(e.options.para=a.resolveTemplateKeys(e.currentItem.content)),e.currentItem.groupId&&(e.currentItem.groupId=parseInt(e.currentItem.groupId))):e.create(),e.options.groupType=e.currentItem.groupId!==-99?-100:-99,e.options.showPreview=!1,a.getAllTemplate().then(function(t){e.options.allTemplate=t})};e.changeTemplateId=function(t){e.options.groupType=e.currentItem.groupId!==-99?-100:-99,e.currentItem.content=t.content,e.currentItem.templateId=t.template_id,e.currentItem.content&&(e.options.para=a.resolveTemplateKeys(e.currentItem.content))},e.isUrlChanged=function(){e.currentItem.url&&"#"!==e.currentItem.url||(e.currentItem.url="http://")},e.getTime=function(){e.currentItem.sendTime=(new Date).format("yyyy-MM-dd hh:mm:ss")},e.groupTypeSelected=function(t){t!==-99||e.memberCatalogs.length?e.currentItem.groupId=null:r.loadData()};var i=function(t){e.memberCatalogs=_.filter(t,function(e){return!!e.count&&1e4!==e.id})};e.saveItem=function(t,a){e.currentItem.groupId||(e.currentItem.groupId=-100),t.$setPristine(),e.save(!0,t,a),e.goToList()},e.togglePreview=function(){e.options.showPreview=!e.options.showPreview,e.options.showPreview&&(e.options.previewConent=a.transformKeywords(e.currentItem.content,e.currentItem.para))},e.updatePreview=function(){e.options.showPreview&&(e.options.previewConent=a.transformKeywords(e.currentItem.content,e.currentItem.para))},e.hasTime=function(e){return!e.search("time")},r.registerListLoaded(i),o(),e.$on("$destroy",function(){r.unregisterListLoaded(i)})}])}(angular),function(e){"use strict";e.module("messageTemplate").controller("messageTemplateListCtrl",["$scope","messageTemplateSvc","basListCtrlSvc","platformModalSvc","$state","platformMenuDataSvc",function(e,t,a,n,r,o){a.createInstance(e,t,{detailState:"wechat.messageTemplate.detail"}),e.searchData(),e.editItem=function(t){e.edit(t),e.goToDetail()},e.toggleStatus=function(e){t.toggleStatus(e)},e.cancelJob=function(e){t.cancelJob(e)},e.removeItems=function(){n.showConfirmMessage("确定要批量删除模板消息吗？","温馨提示").then(function(){t.removeItems(t.getSelectedItems())})},e.$on("$destroy",function(){r.current&&"/message-template"===r.current.url&&e.goToDetail()})}])}(angular);